<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
        <title>index</title>
        <!-- Date: 2012-03-13 -->
        <link href='css/bootstrap.css' media='screen' rel='stylesheet' />
        <link href='css/bootstrap-responsive.css' media='screen' rel='stylesheet' />
        <link href='css/style.css' media='screen' rel='stylesheet' />
        <link href='css/application.css' media='screen' rel='stylesheet' />
        <link href='css/jquery.selectbox.css' media='screen' rel='stylesheet' />
        <link href="ico/favicon.ico" rel="shortcut icon">
        <link href="ico/apple-touch-icon-144-precomposed.png" sizes="144x144" rel="apple-touch-icon-precomposed">
        <link href="ico/apple-touch-icon-114-precomposed.png" sizes="114x114" rel="apple-touch-icon-precomposed">
        <link href="ico/apple-touch-icon-72-precomposed.png" sizes="72x72" rel="apple-touch-icon-precomposed">
        <link href="ico/apple-touch-icon-57-precomposed.png" rel="apple-touch-icon-precomposed">

        <script type="text/javascript" src="../lib/require.js"></script>
        <script type="text/javascript" src="../lib/jquery-1.7.1.min.js"></script>
        <script type="text/javascript" src="../lib/jquery.knob.js"></script>
        <script type="text/javascript" src="../lib/underscore.js"></script>
        <script type="text/javascript" src="../lib/bootstrap.min.js"></script>
        <script type="text/javascript" src="../lib/bootstrap-contextmenu.js"></script>
        <script type="text/javascript" src="../lib/jstack.js"></script>
        <script type="text/javascript" src="../lib/cdmi.js"></script>
        <script type="text/javascript" src="../lib/ovf.js"></script>
        <script type="text/javascript" src="../lib/xml2json.js"></script>
        <script type="text/javascript" src="../lib/sdc.js"></script>
        <script type="text/javascript" src="../lib/backbone.js"></script>
        <script type="text/javascript" src="../lib/jquery.selectbox-0.1.3.min.js"></script>

        <script>
            window.addEventListener("load", function() {
                setTimeout(function() {
                    window.scrollTo(0, 0);
                }, 0);
            });
            function loadTemplates(urls, callback) {
                var total = urls.length;
                var amount = 0;
                for (var index in urls) {
                    var url = urls[index];

                    $.ajax({
                        url: url + "?random=" + Math.random()*99999,
                        asynx: false, // synchonous call in case code tries to use template before it's loaded
                        success: function (response) {
                            $('head').append(response);
                            amount++;
                            if (amount == total) {
                                callback();
                            }
                        }
                    });
                }
            }
            $(document).ready(function(){
                $('.bar').css({width: "0%"});
                loadTemplates([
                    'templates/auth/login.html',
                    'templates/forms/addUserToProject.html',
                    'templates/forms/updateInstance.html',
                    'templates/forms/createFlavor.html',
                    'templates/forms/updateImage.html',
                    'templates/forms/rebootInstances.html',
                    'templates/forms/changePassword.html',
                    'templates/forms/createSnapshot.html',
                    'templates/forms/createVolumeSnapshot.html',
                    'templates/forms/createVolume.html',
                    'templates/forms/editVolumeAttachments.html',
                    'templates/forms/launchImage.html',
                    'templates/forms/createContainer.html',
                    'templates/forms/installSoftware.html',
                    'templates/forms/copyObject.html',
                    'templates/forms/uploadObject.html',
                    'templates/forms/launchVDC.html',
                    'templates/forms/createVDCService.html',
                    'templates/forms/createSecurityGroup.html',
                    'templates/forms/editSecurityGroupRules.html',
                    'templates/forms/createKeypair.html',
                    'templates/forms/createProject.html',
                    'templates/forms/editProject.html',
                    'templates/forms/createUser.html',
                    'templates/forms/editUser.html',
                    'templates/forms/importKeypair.html',
                    'templates/forms/downloadKeypair.html',
                    'templates/forms/allocateIP.html',
                    'templates/forms/modifyUsers.html',
                    'templates/forms/modifyQuotas.html',
                    'templates/root/nova/accessAndSecurity.html',
                    'templates/root/nova/keypairs.html',
                    'templates/root/nova/securityGroups.html',
                    'templates/root/nova/floatingIPs.html',
                    'templates/root/nova/snapshots.html',
                    'templates/root/nova/snapshots/instanceSnapshots.html',
                    'templates/root/nova/snapshots/volumeSnapshots.html',
                    'templates/root/nova/instancesAndVolumes.html',
                    'templates/root/nova/instancesAndVolumes/instances.html',
                    'templates/root/nova/instancesAndVolumes/volumes.html',
                    'templates/root/nova/instanceDetail.html',
                    'templates/root/nova/imageDetail.html',
                    'templates/root/nova/volumeDetail.html',
                    'templates/root/nova/VDCs.html',
                    'templates/root/nova/VDC.html',
                    'templates/root/nova/VDCService.html',
                    'templates/root/nova/instanceDetail/log.html',
                    'templates/root/nova/instanceDetail/overview.html',
                    'templates/root/nova/instanceDetail/SDC.html',
                    'templates/root/nova/instanceDetail/VNC.html',
                    'templates/root/nova/instanceDetail/viewProductAttributes.html',
                    'templates/root/nova/instanceDetail/editProductAttributes.html',
                    'templates/root/objectstorage/containers.html',
                    'templates/root/objectstorage/container.html',
                    'templates/root/sys/images.html',
                    'templates/root/sys/services.html',
                    'templates/root/sys/flavors.html',
                    'templates/root/sys/projects.html',
                    'templates/root/sys/users.html',
                    'templates/root/sys/newUsers.html',
                    'templates/root/sys/usersForProject.html',
                    'templates/root/sys/quotas.html',
                    'templates/root/root.html',
                    'templates/root/table.html',
                    'templates/root/navTab.html',
                    'templates/root/topBar.html',
                    'templates/root/sideBar.html',
                    'templates/root/confirm.html',
                    'templates/root/settings.html',
                    'templates/messages.html'
                ], function(){
                    $('.bar').css({width: "30%"});
                    console.log("Templates loaded.");
                    console.log($("#createKeyPairFormTemplate"));
                    require(["libs.js"], function() {
                        $('.bar').css({width: "50%"});
                        require(["models.js"], function() {
                            $('.bar').css({width: "70%"});
                            require(["views.js"], function() {
                                $('.bar').css({width: "90%"});
                                require(["routes.js"], function() {
                                    $('.bar').css({width: "100%"});
                                    $('#initbar').hide();
                                    host = document.URL.match(/(http.?:\/\/[^\/]*)\/.*/)[1];
                                    UTILS.Auth.initialize(host + "/keystone/v2.0/", host + "/keystone-admin/v2.0/");
                                    //UTILS.Auth.initialize("http://mcu5.dit.upm.es:5000/v2.0/");
                                    var fiRouter = new OSRouter();
                                    Backbone.history.start();
                                })
                            })
                        })
                    })
                });
            });
        </script>