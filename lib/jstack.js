var JSTACK=JSTACK||{};JSTACK.VERSION="0.1";JSTACK.AUTHORS="GING";JSTACK.Comm=function(c,f){var g;g=function(c,h,e,a,b,d){var i,g;i=new XMLHttpRequest;i.open(c,h,!0);i.setRequestHeader("Content-Type","application/json");i.setRequestHeader("Accept","application/json");i.onreadystatechange=function(){if(4===i.readyState)switch(i.status){case 100:case 200:case 201:case 202:case 203:case 204:case 205:g=f;i.responseText!==f&&""!==i.responseText&&(g=JSON.parse(i.responseText));b(g);break;case 400:d("400 Bad Request");break;case 401:d("401 Unauthorized");break;case 403:d("403 Forbidden");
break;default:d(i.status+" Error")}};a!==f&&i.setRequestHeader("X-Auth-Token",a);e!==f?(c=JSON.stringify(e),i.send(c)):i.send()};return{get:function(c,h,e,a){g("GET",c,f,h,e,a)},post:function(c,h,e,a,b){g("POST",c,h,e,a,b)},put:function(c,h,e,a,b){g("PUT",c,h,e,a,b)},del:function(c,h,e,a){g("DELETE",c,f,h,e,a)}}}(JSTACK);JSTACK.Utils=function(c){var f,g;f=function(c){var h="",e,a,c=c.replace(/\r\n/g,"\n");for(e=0;e<c.length;e+=1)a=c.charCodeAt(e),128>a?h+=String.fromCharCode(a):(127<a&&2048>a?h+=String.fromCharCode(a>>6|192):(h+=String.fromCharCode(a>>12|224),h+=String.fromCharCode(a>>6&63|128)),h+=String.fromCharCode(a&63|128));return h};g=function(c){for(var h="",e=0,a=0,b=0,d=0;e<c.length;)a=c.charCodeAt(e),128>a?(h+=String.fromCharCode(a),e+=1):191<a&&224>a?(b=c.charCodeAt(e+1),h+=String.fromCharCode((a&31)<<
6|b&63),e+=2):(b=c.charCodeAt(e+1),d=c.charCodeAt(e+2),h+=String.fromCharCode((a&15)<<12|(b&63)<<6|d&63),e+=3);return h};return{encode:function(g){for(var h="",e,a,b,d,i,k,m=0,g=f(g);m<g.length;)e=g.charCodeAt(m+=1),a=g.charCodeAt(m+=1),b=g.charCodeAt(m+=1),d=e>>2,e=(e&3)<<4|a>>4,i=(a&15)<<2|b>>6,k=b&63,isNaN(a)?i=k=64:isNaN(b)&&(k=64),h=h+c.Utils.keyStr.charAt(d)+Base64.keyStr.charAt(e)+c.Utils.keyStr.charAt(i)+Base64.keyStr.charAt(k);return h},decode:function(f){for(var h="",e,a,b,d,i,k=0,f=f.replace(/[^A-Za-z0-9\+\/\=]/g,
"");k<f.length;)e=c.Utils.keyStr.indexOf(f.charAt(k+=1)),a=c.Utils.keyStr.indexOf(f.charAt(k+=1)),d=c.Utils.keyStr.indexOf(f.charAt(k+=1)),i=c.Utils.keyStr.indexOf(f.charAt(k+=1)),e=e<<2|a>>4,a=(a&15)<<4|d>>2,b=(d&3)<<6|i,h+=String.fromCharCode(e),64!==d&&(h+=String.fromCharCode(a)),64!==i&&(h+=String.fromCharCode(b));return h=g(h)}}}(JSTACK);JSTACK.Keystone=function(c,f){var g,j;j={DISCONNECTED:0,AUTHENTICATING:1,AUTHENTICATED:2,AUTHENTICATION_ERROR:3};g={url:f,currentstate:f,access:f,token:f};return{STATES:j,params:g,init:function(c,e){console.log("Admin URL"+e);g.url=c;g.adminUrl=e;g.access=f;g.token=f;g.currentstate=j.DISCONNECTED},authenticate:function(h,e,a,b,d,i){var k={},k=a!==f?{auth:{token:{id:a}}}:{auth:{passwordCredentials:{username:h,password:e}}};b!==f&&(k.auth.tenantId=b);g.currentstate=j.AUTHENTICATING;c.Comm.post(g.url+
"tokens",k,f,function(a){g.currentstate=c.Keystone.STATES.AUTHENTICATED;g.access=a.access;g.token=g.access.token.id;d!==f&&d(a)},function(a){g.currentstate=j.AUTHENTICATION_ERROR;i(a)})},gettenants:function(h){g.currentstate===c.Keystone.STATES.AUTHENTICATED&&c.Comm.get(g.url+"tenants",g.token,function(c){h!==f&&h(c)},function(c){throw Error(c);})},getservice:function(c){var e,a;if(g.currentstate!==j.AUTHENTICATED)return f;for(e in g.access.serviceCatalog)if(g.access.serviceCatalog[e]!==f&&(a=g.access.serviceCatalog[e],
c===a.type))return a;return f},getservicelist:function(){return g.currentstate!==j.AUTHENTICATED?f:g.access.serviceCatalog},createuser:function(f,e,a,b,d,i,k){g.currentstate===c.Keystone.STATES.AUTHENTICATED&&c.Comm.post(g.adminUrl+"users",{user:{name:name,password:e,tenantId:a,email:b,enabled:d}},g.token,i,k)},getusers:function(h,e,a){if(g.currentstate===c.Keystone.STATES.AUTHENTICATED){var b="",b=h!==f?g.adminUrl+"tenants/"+h+"/users":g.adminUrl+"users";c.Comm.get(b,g.token,e,a)}},getuser:function(f,
e,a){g.currentstate===c.Keystone.STATES.AUTHENTICATED&&c.Comm.get(g.adminUrl+"users/"+f,g.token,e,a)},deleteuser:function(f,e,a){g.currentstate===c.Keystone.STATES.AUTHENTICATED&&c.Comm.del(g.adminUrl+"users/"+f,g.token,e,a)},getuserroles:function(h,e,a,b){if(g.currentstate===c.Keystone.STATES.AUTHENTICATED){var d="",d=e!==f?g.adminUrl+"tenants/"+e+"/users/"+h+"/roles":g.adminUrl+"users/"+h+"/roles";c.Comm.get(d,g.token,a,b)}},adduserrole:function(h,e,a,b,d){if(g.currentstate===c.Keystone.STATES.AUTHENTICATED){var i=
"",i=a!==f?g.adminUrl+"tenants/"+a+"/users/"+h+"/roles/OS-KSADM/"+e:g.adminUrl+"users/"+h+"/roles/OS-KSADM/"+e;c.Comm.put(i,g.token,b,d)}},removeuserrole:function(h,e,a,b,d){if(g.currentstate===c.Keystone.STATES.AUTHENTICATED){var i="",i=a!==f?g.adminUrl+"tenants/"+a+"/users/"+h+"/roles/OS-KSADM/"+e:g.adminUrl+"users/"+h+"/roles/OS-KSADM/"+e;c.Comm.del(i,g.token,b,d)}},createtenant:function(f,e,a,b,d){g.currentstate===c.Keystone.STATES.AUTHENTICATED&&c.Comm.post(g.adminUrl+"tenants",{tenant:{name:f,
description:e,enabled:a}},g.token,b,d)},deletetenant:function(f,e,a){g.currentstate===c.Keystone.STATES.AUTHENTICATED&&c.Comm.del(g.adminUrl+"tenants"+f,data,g.token,e,a)}}}(JSTACK);JSTACK.Nova=function(c,f){var g,j,h,e;g=f;j="publicURL";h=function(){return c.Keystone!==f&&c.Keystone.params.currentstate===c.Keystone.STATES.AUTHENTICATED?(g=c.Keystone.getservice("compute").endpoints[0][j],!0):!1};e=function(a,b,d,i){h()&&(a=g+"/servers/"+a+"/action",c.Comm.post(a,b,c.Keystone.params.token,function(a){i!==f&&i(a)},function(a){throw Error(a);}))};return{configure:function(a){if("adminURL"===a||"internalURL"===a||"publicURL"===a)j=a},getserverlist:function(a,b,d){var i;h()&&(i=g+
"/servers",a!==f&&a&&(i+="/detail"),b&&(i+="?all_tenants="+b),c.Comm.get(i,c.Keystone.params.token,function(a){d!==f&&d(a)},function(a){throw Error(a);}))},getserverdetail:function(a,b){var d;h()&&(d=g+"/servers/"+a,c.Comm.get(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},getserverips:function(a,b,d){h()&&(a=g+"/servers/"+a+"/ips",b!==f&&(a+="/"+b),c.Comm.get(a,c.Keystone.params.token,function(a){d!==f&&d(a)},function(a){throw Error(a);}))},updateserver:function(a,
b,d){h()&&(a=g+"/servers/"+a,b!==f&&c.Comm.put(a,{server:{name:b}},c.Keystone.params.token,function(a){d!==f&&d(a)},function(a){throw Error(a);}))},createserver:function(a,b,d,i,e,j,n,l,o,p){var r=[],q;if(h()){a={server:{name:a,imageRef:b,flavorRef:d}};i!==f&&(a.server.key_name=i);e!==f&&(a.server.user_data=c.Utils.encode(e));if(j!==f){for(q in j)j[q]!==f&&(i={name:j[q]},r.push(i));a.server.security_groups=r}n===f&&(n=1);a.server.min_count=n;l===f&&(l=1);a.server.max_count=l;o!==f&&(a.server.availability_zone=
c.Utils.encode(o));c.Comm.post(g+"/servers",a,c.Keystone.params.token,function(a){p!==f&&p(a)},function(a){throw Error(a);})}},deleteserver:function(a,b){var d;h()&&(d=g+"/servers/"+a,c.Comm.del(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},changepasswordserver:function(a,b,d){b!==f&&e(a,{changePassword:{adminPass:b}},d)},rebootserverhard:function(a,b){e(a,{reboot:{type:"HARD"}},b)},rebootserversoft:function(a,b){e(a,{reboot:{type:"SOFT"}},b)},resizeserver:function(a,
b,d){e(a,{resize:{flavorRef:b}},d)},confirmresizedserver:function(a,b){e(a,{confirmResize:null},b)},revertresizedserver:function(a,b){e(a,{revertResize:null},b)},startserver:function(a,b){e(a,{"os-start":null},b)},stopserver:function(a,b){e(a,{"os-stop":null},b)},pauseserver:function(a,b){e(a,{pause:null},b)},unpauseserver:function(a,b){e(a,{unpause:null},b)},suspendserver:function(a,b){e(a,{suspend:null},b)},resumeserver:function(a,b){e(a,{resume:null},b)},createimage:function(a,b,d,c){b={createImage:{name:b}};
b.createImage.metadata={};d!==f&&(b.createImage.metadata=d);e(a,b,c)},getflavorlist:function(a,b){var d;h()&&(d=g+"/flavors",a!==f&&a&&(d+="/detail"),c.Comm.get(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},getflavordetail:function(a,b){var d;h()&&(d=g+"/flavors/"+a,c.Comm.get(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},createflavor:function(a,b,d,e,k,j,n,l,o){var p;h()&&(p=g+"/flavors",a={flavor:{name:a,ram:b,vcpus:d,disk:e,
id:k,swap:0,"OS-FLV-EXT-DATA:ephemeral":0,rxtx_factor:0}},j!==f&&(a.flavor["OS-FLV-EXT-DATA:ephemeral"]=j),n!==f&&(a.flavor.swap=n),l!==f&&(a.flavor.rxtx_factor=l),c.Comm.post(p,a,c.Keystone.params.token,function(a){o!==f&&o(a)},function(a){throw Error(a);}))},deleteflavor:function(a,b){var d;h()&&(d=g+"/flavors/"+a,c.Comm.del(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},getimagelist:function(a,b){var d;h()&&(d=g+"/images",a!==f&&a&&(d+="/detail"),c.Comm.get(d,
c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},getimagedetail:function(a,b){var d;h()&&(d=g+"/images/"+a,c.Comm.get(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},deleteimage:function(a,b){var d;h()&&(d=g+"/images/"+a,c.Comm.del(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},getkeypairlist:function(a){var b;h()&&(b=g+"/os-keypairs",c.Comm.get(b,c.Keystone.params.token,function(b){a!==f&&a(b)},
function(a){throw Error(a);}))},createkeypair:function(a,b,d){var e;h()&&(e=g+"/os-keypairs",a={keypair:{name:a}},b!==f&&(a.keypair.public_key=b),c.Comm.post(e,a,c.Keystone.params.token,function(a){d!==f&&d(a)},function(a){throw Error(a);}))},deletekeypair:function(a,b){var d;h()&&(d=g+"/os-keypairs/"+a,c.Comm.del(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},getvncconsole:function(a,b,d){if(h()){if(b===f||!b)b="novnc";e(a,{"os-getVNCConsole":{type:b}},null,d)}},
getconsoleoutput:function(a,b,d){if(h()){if(b===f||!b)b=35;e(a,{"os-getConsoleOutput":{length:b}},null,d)}},getattachedvolumes:function(a,b){var d;h()&&(d=g+"/servers/"+a+"/os-volume_attachments",c.Comm.get(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},attachvolume:function(a,b,d,e){h()&&(a=g+"/servers/"+a+"/os-volume_attachments",b===f||d===f||c.Comm.post(a,{volumeAttachment:{volumeId:b,device:d}},c.Keystone.params.token,function(a){e!==f&&e(a)},function(a){throw Error(a);
}))},detachvolume:function(a,b,d){h()&&(a=g+"/servers/"+a+"/os-volume_attachments/"+b,b!==f&&c.Comm.del(a,c.Keystone.params.token,function(a){d!==f&&d(a)},function(a){throw Error(a);}))},getattachedvolume:function(a,b,d){h()&&(a=g+"/servers/"+a+"/os-volume_attachments/"+b,b!==f&&c.Comm.get(a,c.Keystone.params.token,function(a){d!==f&&d(a)},function(a){throw Error(a);}))},getquotalist:function(a,b){var d;h()&&(d=g+"/os-quota-sets/"+a,c.Comm.get(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);
}))},updatequota:function(a,b,d,e,j,m,n,l,o,p,r,q,t,u,s){h()&&(a=g+"/os-quota-sets/"+a,b={quota_set:{instances:b,cores:d,ram:e,volumes:j,gigabytes:m,floating_ips:n,metadata_items:l,injected_files:o,injected_file_content_bytes:p,injected_file_path_bytes:r,security_groups:q,security_group_rules:t,key_pairs:u}},c.Comm.post(a,b,c.Keystone.params.token,function(a){s!==f&&s(a)},function(a){throw Error(a);}))},getdefaultquotalist:function(a,b){var d;h()&&(d=g+"/os-quota-sets/"+a+"/defaults",c.Comm.get(d,
c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},getsecuritygrouplist:function(a){var b;h()&&(b=g+"/os-security-groups",c.Comm.get(b,c.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))},createsecuritygroup:function(a,b,d){h()&&(a=g+"/os-security-groups",console.log(a),c.Comm.post(a,{security_group:{name:"name",description:"description"}},c.Keystone.params.token,function(a){d!==f&&d(a)},function(a){throw Error(a);}))},getsecuritygroupdetail:function(a,
b){var d;h()&&(d=g+"/os-security-groups/"+a,console.log(d),c.Comm.get(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},deletesecuritygroup:function(a,b){var d;h()&&(d=g+"/os-security-groups/"+a,console.log(d),c.Comm.del(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},createsecuritygrouprule:function(a,b,d,e,j,m,n){var l;h()&&(l=g+"/os-security-group-rules",a={security_group_rule:{ip_protocol:a,from_port:b,to_port:d,cidr:e,group_id:j,
parent_group_id:m}},console.log(l),c.Comm.post(l,a,c.Keystone.params.token,function(a){n!==f&&n(a)},function(a){throw Error(a);}))},deletesecuritygrouprule:function(a,b){var d;h()&&(d=g+"/os-security-groups/"+a,console.log(d),c.Comm.del(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},getsecuritygroupforserver:function(a,b){var d;h()&&(d=g+"/servers/"+a+"/os-security-groups",console.log(d),c.Comm.get(d,c.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);
}))}}}(JSTACK);JSTACK.Nova.Volume=function(c,f){var g,j,h;g=f;j="publicURL";h=function(){return c.Keystone!==f&&c.Keystone.params.currentstate===c.Keystone.STATES.AUTHENTICATED?(g=c.Keystone.getservice("volume").endpoints[0][j],!0):!1};return{configure:function(c){if("adminURL"===c||"internalURL"===c||"publicURL"===c)j=c},getvolumelist:function(e,a){var b;h()&&(b=g+"/volumes",e!==f&&e&&(b+="/detail"),c.Comm.get(b,c.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))},createvolume:function(e,
a,b,d){h()&&(e={volume:{size:e}},a!==f&&(e.volume.display_name=a),b!==f&&(e.volume.display_description=b),c.Comm.post(g+"/volumes",e,c.Keystone.params.token,function(a){d!==f&&d(a)},function(a){throw Error(a);}))},deletevolume:function(e,a){var b;h()&&(b=g+"/volumes/"+e,c.Comm.del(b,c.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))},getvolume:function(e,a){var b;h()&&(b=g+"/volumes/"+e,c.Comm.get(b,c.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);
}))},getsnapshotlist:function(e,a){var b;h()&&(b=g+"/snapshots",e!==f&&e&&(b+="/detail"),c.Comm.get(b,c.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))},createsnapshot:function(e,a,b,d){h()&&(e={snapshot:{volume_id:e,force:!0}},a!==f&&(e.snapshot.display_name=a),b!==f&&(e.snapshot.display_description=b),c.Comm.post(g+"/snapshots",e,c.Keystone.params.token,function(a){d!==f&&d(a)},function(a){throw Error(a);}))},deletesnapshot:function(e,a){var b;h()&&(b=g+"/snapshots/"+
e,c.Comm.del(b,c.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))},getsnapshot:function(e,a){var b;h()&&(b=g+"/snapshots/"+e,c.Comm.get(b,c.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))}}}(JSTACK);JSTACK.Glance=function(c,f){var g,j,h;g=f;j="publicURL";h=function(){return c.Keystone!==f&&c.Keystone.params.currentstate===c.Keystone.STATES.AUTHENTICATED?(g=c.Keystone.getservice("image").endpoints[0][j],!0):!1};return{configure:function(c){if("adminURL"===c||"internalURL"===c||"publicURL"===c)j=c},getimagelist:function(e,a){var b;h()&&(b=g+"/images",e!==f&&e&&(b+="/detail"),c.Comm.get(b,c.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))}}}(JSTACK);
