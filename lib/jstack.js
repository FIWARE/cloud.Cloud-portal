var JSTACK=JSTACK||{};JSTACK.VERSION="0.1";JSTACK.AUTHORS="GING";JSTACK.Comm=function(e,c){var g;g=function(e,f,a,b,d,h,g){var j,l,h=h||function(){},d=d||function(){};j=new XMLHttpRequest;j.open(e,f,!0);a&&j.setRequestHeader("Content-Type","application/json");j.setRequestHeader("Accept","application/json");b!==c&&j.setRequestHeader("X-Auth-Token",b);if(g)for(var m in g)j.setRequestHeader(m,g[m]);j.onerror=function(a){h({message:"Error",body:a})};j.onreadystatechange=function(){if(!n&&4===j.readyState)switch(n=!0,j.status){case 100:case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:l=
c;j.responseText!==c&&""!==j.responseText&&(l=JSON.parse(j.responseText));d(l,j.getAllResponseHeaders());break;default:h({message:j.status+" Error",body:j.responseText})}};var n=!1;if(a!==c){e=JSON.stringify(a);try{j.send(e)}catch(o){}}else try{j.send()}catch(q){}};return{get:function(e,f,a,b){g("get",e,c,f,a,b)},head:function(e,f,a,b){g("head",e,c,f,a,b)},post:function(c,f,a,b,d){g("POST",c,f,a,b,d)},put:function(c,f,a,b,d){g("PUT",c,f,a,b,d)},del:function(e,f,a,b){g("DELETE",e,c,f,a,b)}}}(JSTACK);JSTACK.Utils=function(e){var c,g;c=function(c){var f="",a,b,c=c.replace(/\r\n/g,"\n");for(a=0;a<c.length;a+=1)b=c.charCodeAt(a),128>b?f+=String.fromCharCode(b):(127<b&&2048>b?f+=String.fromCharCode(b>>6|192):(f+=String.fromCharCode(b>>12|224),f+=String.fromCharCode(b>>6&63|128)),f+=String.fromCharCode(b&63|128));return f};g=function(c){for(var f="",a=0,b=0,d=0,h=0;a<c.length;)b=c.charCodeAt(a),128>b?(f+=String.fromCharCode(b),a+=1):191<b&&224>b?(d=c.charCodeAt(a+1),f+=String.fromCharCode((b&31)<<
6|d&63),a+=2):(d=c.charCodeAt(a+1),h=c.charCodeAt(a+2),f+=String.fromCharCode((b&15)<<12|(d&63)<<6|h&63),a+=3);return f};return{encode:function(e){for(var f="",a,b,d,h,g,j,l=0,e=c(e);l<e.length;)a=e.charCodeAt(l+=1),b=e.charCodeAt(l+=1),d=e.charCodeAt(l+=1),h=a>>2,a=(a&3)<<4|b>>4,g=(b&15)<<2|d>>6,j=d&63,isNaN(b)?g=j=64:isNaN(d)&&(j=64),f=f+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j);return f},decode:function(c){for(var f="",a,b,d,h,k,j=0,c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<c.length;)a=e.Utils.keyStr.indexOf(c.charAt(j+=1)),b=e.Utils.keyStr.indexOf(c.charAt(j+=1)),h=e.Utils.keyStr.indexOf(c.charAt(j+=1)),k=e.Utils.keyStr.indexOf(c.charAt(j+=1)),a=a<<2|b>>4,b=(b&15)<<4|h>>2,d=(h&3)<<6|k,f+=String.fromCharCode(a),64!==h&&(f+=String.fromCharCode(b)),64!==k&&(f+=String.fromCharCode(d));return f=g(f)}}}(JSTACK);JSTACK.Keystone=function(e,c){var g,i;i={DISCONNECTED:0,AUTHENTICATING:1,AUTHENTICATED:2,AUTHENTICATION_ERROR:3};g={url:c,currentstate:c,access:c,token:c};return{STATES:i,params:g,init:function(e,a){console.log("Admin URL"+a);g.url=e;g.adminUrl=a;g.access=c;g.token=c;g.currentstate=i.DISCONNECTED},authenticate:function(f,a,b,d,h,k){var j={},j=b!==c?{auth:{token:{id:b}}}:{auth:{passwordCredentials:{username:f,password:a}}};d!==c&&(j.auth.tenantId=d);g.currentstate=i.AUTHENTICATING;e.Comm.post(g.url+
"tokens",j,c,function(a){g.currentstate=e.Keystone.STATES.AUTHENTICATED;g.access=a.access;g.token=g.access.token.id;h!==c&&h(a)},function(a){g.currentstate=i.AUTHENTICATION_ERROR;k(a)})},gettenants:function(f,a,b){if(g.currentstate===e.Keystone.STATES.AUTHENTICATED){var d=g.url;a&&(d=g.adminUrl);e.Comm.get(d+"tenants",g.token,function(a){f!==c&&f(a)},function(a){b!==c&&b(a)})}},getservice:function(e){var a,b;if(g.currentstate!==i.AUTHENTICATED)return c;for(a in g.access.serviceCatalog)if(g.access.serviceCatalog[a]!==
c&&(b=g.access.serviceCatalog[a],e===b.type))return b;return c},getservicelist:function(){return g.currentstate!==i.AUTHENTICATED?c:g.access.serviceCatalog},createuser:function(c,a,b,d,h,k,j){g.currentstate===e.Keystone.STATES.AUTHENTICATED&&e.Comm.post(g.adminUrl+"users",{user:{name:c,password:a,tenantId:b,email:d,enabled:h}},g.token,k,j)},edituser:function(f,a,b,d,h,k,j,i){g.currentstate===e.Keystone.STATES.AUTHENTICATED&&(a={user:{name:a,tenantId:d,email:h,enabled:k}},b!==c&&(a.user.password=b),
e.Comm.put(g.adminUrl+"users/"+f,a,g.token,j,i))},getusers:function(c,a){g.currentstate===e.Keystone.STATES.AUTHENTICATED&&e.Comm.get(g.adminUrl+"users",g.token,c,a)},getusersfortenant:function(c,a,b){g.currentstate===e.Keystone.STATES.AUTHENTICATED&&e.Comm.get(g.adminUrl+"tenants/"+c+"/users",g.token,a,b)},getuser:function(c,a,b){g.currentstate===e.Keystone.STATES.AUTHENTICATED&&e.Comm.get(g.adminUrl+"users/"+c,g.token,a,b)},deleteuser:function(c,a,b){g.currentstate===e.Keystone.STATES.AUTHENTICATED&&
e.Comm.del(g.adminUrl+"users/"+c,g.token,a,b)},getuserroles:function(f,a,b,d){if(g.currentstate===e.Keystone.STATES.AUTHENTICATED){var h="",h=a!==c?g.adminUrl+"tenants/"+a+"/users/"+f+"/roles":g.adminUrl+"users/"+f+"/roles";e.Comm.get(h,g.token,b,d)}},getroles:function(c,a){g.currentstate===e.Keystone.STATES.AUTHENTICATED&&e.Comm.get(g.adminUrl+"OS-KSADM/roles",g.token,c,a)},adduserrole:function(f,a,b,d,h){if(g.currentstate===e.Keystone.STATES.AUTHENTICATED){var k="",k=b!==c?g.adminUrl+"tenants/"+
b+"/users/"+f+"/roles/OS-KSADM/"+a:g.adminUrl+"users/"+f+"/roles/OS-KSADM/"+a;e.Comm.put(k,{},g.token,d,h)}},removeuserrole:function(f,a,b,d,h){if(g.currentstate===e.Keystone.STATES.AUTHENTICATED){var k="",k=b!==c?g.adminUrl+"tenants/"+b+"/users/"+f+"/roles/OS-KSADM/"+a:g.adminUrl+"users/"+f+"/roles/OS-KSADM/"+a;e.Comm.del(k,g.token,d,h)}},createtenant:function(c,a,b,d,h){g.currentstate===e.Keystone.STATES.AUTHENTICATED&&e.Comm.post(g.adminUrl+"tenants",{tenant:{name:c,description:a,enabled:b}},g.token,
d,h)},edittenant:function(c,a,b,d,h,k){g.currentstate===e.Keystone.STATES.AUTHENTICATED&&e.Comm.put(g.adminUrl+"tenants/"+c,{tenant:{id:c,name:a,description:b,enabled:d}},g.token,h,k)},deletetenant:function(c,a,b){g.currentstate===e.Keystone.STATES.AUTHENTICATED&&e.Comm.del(g.adminUrl+"tenants/"+c,g.token,a,b)}}}(JSTACK);JSTACK.Nova=function(e,c){var g,i,f;g={url:c,state:c,endpointType:"publicURL",service:"compute"};i=function(){if(e.Keystone!==c&&e.Keystone.params.currentstate===e.Keystone.STATES.AUTHENTICATED){var a=e.Keystone.getservice(g.service);if(a)return g.url=a.endpoints[0][g.endpointType],!0}return!1};f=function(a,b,d,h){i()&&(a=g.url+"/servers/"+a+"/action",e.Comm.post(a,b,e.Keystone.params.token,function(a){d!==c&&d(a)},function(a){h!==c&&h(a)}))};return{configure:function(a){if("adminURL"===a||"internalURL"===
a||"publicURL"===a)g.endpointType=a},params:g,getserverlist:function(a,b,d,h){var f;i()&&(f=g.url+"/servers",a!==c&&a&&(f+="/detail"),b&&(f+="?all_tenants="+b),e.Comm.get(f,e.Keystone.params.token,function(a){d!==c&&d(a)},function(a){h!==c&&h(a)}))},getserverdetail:function(a,b,d){i()&&(a=g.url+"/servers/"+a,e.Comm.get(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},getserverips:function(a,b,d,h){i()&&(a=g.url+"/servers/"+a+"/ips",b!==c&&(a+="/"+b),e.Comm.get(a,e.Keystone.params.token,
function(a){d!==c&&d(a)},function(a){h!==c&&h(a)}))},updateserver:function(a,b,d,h){i()&&(a=g.url+"/servers/"+a,b!==c&&e.Comm.put(a,{server:{name:b}},e.Keystone.params.token,function(a){d!==c&&d(a)},function(a){h!==c&&h(a)}))},createserver:function(a,b,d,h,f,j,l,m,n,o,q){var p=[],r;if(i()){a={server:{name:a,imageRef:b,flavorRef:d}};h!==c&&(a.server.key_name=h);f!==c&&(a.server.user_data=e.Utils.encode(f));if(j!==c){for(r in j)j[r]!==c&&(h={name:j[r]},p.push(h));a.server.security_groups=p}l===c&&(l=
1);a.server.min_count=l;m===c&&(m=1);a.server.max_count=m;n!==c&&(a.server.availability_zone=e.Utils.encode(n));e.Comm.post(g.url+"/servers",a,e.Keystone.params.token,function(a){o!==c&&o(a)},function(a){q!==c&&q(a)})}},deleteserver:function(a,b,d){i()&&(a=g.url+"/servers/"+a,e.Comm.del(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},changepasswordserver:function(a,b,d,h){b!==c&&f(a,{changePassword:{adminPass:b}},d,h)},rebootserverhard:function(a,b,c){f(a,{reboot:{type:"HARD"}},
b,c)},rebootserversoft:function(a,b,c){f(a,{reboot:{type:"SOFT"}},b,c)},resizeserver:function(a,b,c,h){f(a,{resize:{flavorRef:b}},c,h)},confirmresizedserver:function(a,b,c){f(a,{confirmResize:null},b,c)},revertresizedserver:function(a,b,c){f(a,{revertResize:null},b,c)},startserver:function(a,b,c){f(a,{"os-start":null},b,c)},stopserver:function(a,b,c){f(a,{"os-stop":null},b,c)},pauseserver:function(a,c,d){f(a,{pause:null},c,d)},unpauseserver:function(a,c,d){f(a,{unpause:null},c,d)},suspendserver:function(a,
c,d){f(a,{suspend:null},c,d)},resumeserver:function(a,c,d){f(a,{resume:null},c,d)},createimage:function(a,b,d,h,e){b={createImage:{name:b}};b.createImage.metadata={};d!==c&&(b.createImage.metadata=d);f(a,b,h,e)},getflavorlist:function(a,b,d){var h;i()&&(h=g.url+"/flavors",a!==c&&a&&(h+="/detail"),e.Comm.get(h,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},getflavordetail:function(a,b,d){i()&&(a=g.url+"/flavors/"+a,e.Comm.get(a,e.Keystone.params.token,function(a){b!==
c&&b(a)},function(a){d!==c&&d(a)}))},createflavor:function(a,b,d,h,f,j,l,m,n,o){var q;i()&&(q=g.url+"/flavors",a={flavor:{name:a,ram:b,vcpus:d,disk:h,id:f+"",swap:0,"OS-FLV-EXT-DATA:ephemeral":0,rxtx_factor:0}},j!==c&&(a.flavor["OS-FLV-EXT-DATA:ephemeral"]=j),l!==c&&(a.flavor.swap=l),m!==c&&(a.flavor.rxtx_factor=m),e.Comm.post(q,a,e.Keystone.params.token,function(a){n!==c&&n(a)},function(a){o!==c&&o(a)}))},deleteflavor:function(a,b,d){i()&&(a=g.url+"/flavors/"+a,e.Comm.del(a,e.Keystone.params.token,
function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},getimagelist:function(a,b,d){var h;i()&&(h=g.url+"/images",a!==c&&a&&(h+="/detail"),e.Comm.get(h+"?limit=100",e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},getimagedetail:function(a,b,d){i()&&(a=g.url+"/images/"+a,e.Comm.get(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},deleteimage:function(a,b,d){i()&&(a=g.url+"/images/"+a,e.Comm.del(a,e.Keystone.params.token,function(a){b!==c&&b(a)},
function(a){d!==c&&d(a)}))},getkeypairlist:function(a,b){var d;i()&&(d=g.url+"/os-keypairs",e.Comm.get(d,e.Keystone.params.token,function(b){a!==c&&a(b)},function(a){b!==c&&b(a)}))},createkeypair:function(a,b,d,h){var f;i()&&(f=g.url+"/os-keypairs",a={keypair:{name:a}},b!==c&&(a.keypair.public_key=b),e.Comm.post(f,a,e.Keystone.params.token,function(a){d!==c&&d(a)},function(a){h!==c&&h(a)}))},deletekeypair:function(a,b,d){i()&&(a=g.url+"/os-keypairs/"+a,e.Comm.del(a,e.Keystone.params.token,function(a){b!==
c&&b(a)},function(a){d!==c&&d(a)}))},getkeypairdetail:function(a,b,d){i()&&(a=g.url+"/os-keypairs/"+a,e.Comm.get(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},getvncconsole:function(a,b,d,h){if(i()){if(b===c||!b)b="novnc";f(a,{"os-getVNCConsole":{type:b}},d,h)}},getconsoleoutput:function(a,b,d,h){if(i()){if(b===c||!b)b=35;f(a,{"os-getConsoleOutput":{length:b}},d,h)}},getattachedvolumes:function(a,b,d){i()&&(a=g.url+"/servers/"+a+"/os-volume_attachments",e.Comm.get(a,
e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},attachvolume:function(a,b,d,h,f){i()&&(a=g.url+"/servers/"+a+"/os-volume_attachments",b===c||d===c||e.Comm.post(a,{volumeAttachment:{volumeId:b,device:d}},e.Keystone.params.token,function(a){h!==c&&h(a)},function(a){f!==c&&f(a)}))},detachvolume:function(a,b,d,h){i()&&(a=g.url+"/servers/"+a+"/os-volume_attachments/"+b,b!==c&&e.Comm.del(a,e.Keystone.params.token,function(a){d!==c&&d(a)},function(a){h!==c&&h(a)}))},getattachedvolume:function(a,
b,d,h){i()&&(a=g.url+"/servers/"+a+"/os-volume_attachments/"+b,b!==c&&e.Comm.get(a,e.Keystone.params.token,function(a){d!==c&&d(a)},function(a){h!==c&&h(a)}))},getquotalist:function(a,b,d){i()&&(a=g.url+"/os-quota-sets/"+a,e.Comm.get(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},updatequota:function(a,b,d,h,f,j,l,m,n,o,q,p,r,t,u,v){var w;if(i()&&(w=g.url+"/os-quota-sets/"+a,!(b==c&&d==c&&h==c&&f==c&&j==c&&l==c&&m==c&&n==c&&o==c&&q==c&&p==c&&r==c&&t==c))){var a={quota_set:{instances:b,
cores:d,ram:h,volumes:f,gigabytes:j,floating_ips:l,metadata_items:m,injected_files:n,injected_file_content_bytes:o,injected_file_path_bytes:q,security_groups:p,security_group_rules:r,key_pairs:t,id:a}},s;for(s in a.quota_set)a.quota_set[s]==c&&delete a.quota_set[s];e.Comm.put(w,a,e.Keystone.params.token,function(a){u!==c&&u(a)},function(a){v!==c&&v(a)})}},getdefaultquotalist:function(a,b,d){i()&&(a=g.url+"/os-quota-sets/"+a+"/defaults",e.Comm.get(a,e.Keystone.params.token,function(a){b!==c&&b(a)},
function(a){d!==c&&d(a)}))},getsecuritygrouplist:function(a,b){var d;i()&&(d=g.url+"/os-security-groups",e.Comm.get(d,e.Keystone.params.token,function(b){a!==c&&a(b)},function(a){b!==c&&b(a)}))},createsecuritygroup:function(a,b,d,f){var k;i()&&(k=g.url+"/os-security-groups",a={security_group:{name:a,description:b}},e.Comm.post(k,a,e.Keystone.params.token,function(a){console.log(d);d!==c&&d(a)},function(a){f!==c&&f(a)}))},getsecuritygroupdetail:function(a,b,d){i()&&(a=g.url+"/os-security-groups/"+
a,e.Comm.get(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},deletesecuritygroup:function(a,b,d){i()&&(a=g.url+"/os-security-groups/"+a,e.Comm.del(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},createsecuritygrouprule:function(a,b,d,f,k,j,l,m){var n;i()&&(n=g.url+"/os-security-group-rules",a={security_group_rule:{ip_protocol:a,from_port:b,to_port:d,cidr:f,group_id:k,parent_group_id:j}},e.Comm.post(n,a,e.Keystone.params.token,function(a){l!==
c&&l(a)},function(a){m!==c&&m(a)}))},deletesecuritygrouprule:function(a,b,d){i()&&(a=g.url+"/os-security-group-rules/"+a,e.Comm.del(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},getsecuritygroupforserver:function(a,b,d){i()&&(a=g.url+"/servers/"+a+"/os-security-groups",e.Comm.get(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},getfloatingIPpools:function(a,b){var d;i()&&(d=g.url+"/os-floating-ip-pools",e.Comm.get(d,e.Keystone.params.token,
function(b){a!==c&&a(b)},function(a){b(a);throw Error(a);}))},getfloatingIPs:function(a,b){var d;i()&&(d=g.url+"/os-floating-ips",e.Comm.get(d,e.Keystone.params.token,function(b){a!==c&&a(b)},function(a){b(a);throw Error(a);}))},getfloatingIPdetail:function(a,b,d){i()&&(a=g.url+"/os-floating-ips/"+a,e.Comm.get(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d(a);throw Error(a);}))},allocatefloatingIP:function(a,b,d){var f,k;i()&&(f=g.url+"/os-floating-ips",a!==c&&(k={pool:a}),e.Comm.post(f,
k,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d(a);throw Error(a);}))},associatefloatingIP:function(a,b,d,f){i()&&(a=g.url+"/servers/"+a+"/action",e.Comm.post(a,{addFloatingIp:{address:b}},e.Keystone.params.token,function(a){d!==c&&d(a)},function(a){f(a);throw Error(a);}))},disassociatefloatingIP:function(a,b,d,f){i()&&(a=g.url+"/servers/"+a+"/action",e.Comm.post(a,{removeFloatingIp:{address:b}},e.Keystone.params.token,function(a){d!==c&&d(a)},function(a){f(a);throw Error(a);}))},
releasefloatingIP:function(a,b,d){i()&&(a=g.url+"/os-floating-ips/"+a,e.Comm.del(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d(a);throw Error(a);}))}}}(JSTACK);JSTACK.Cinder=function(e,c){var g,i,f;g=c;i="publicURL";f=function(){if(e.Keystone!==c&&e.Keystone.params.currentstate===e.Keystone.STATES.AUTHENTICATED){var a=e.Keystone.getservice("volume");if(a)return g=a.endpoints[0][i],!0}return!1};return{configure:function(a){if("adminURL"===a||"internalURL"===a||"publicURL"===a)i=a},getvolumelist:function(a,b,d){var h;f()&&(h=g+"/volumes",a!==c&&a&&(h+="/detail"),e.Comm.get(h,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},createvolume:function(a,
b,d,h,i){f()&&(a={volume:{size:a}},b!==c&&(a.volume.display_name=b),d!==c&&(a.volume.display_description=d),e.Comm.post(g+"/volumes",a,e.Keystone.params.token,function(a){h!==c&&h(a)},function(a){i!==c&&i(a)}))},deletevolume:function(a,b,d){f()&&(a=g+"/volumes/"+a,e.Comm.del(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},getvolume:function(a,b,d){f()&&(a=g+"/volumes/"+a,e.Comm.get(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},getsnapshotlist:function(a,
b,d){var h;f()&&(h=g+"/snapshots",a!==c&&a&&(h+="/detail"),e.Comm.get(h,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},createsnapshot:function(a,b,d,h,i){f()&&(a={snapshot:{volume_id:a,force:!0}},b!==c&&(a.snapshot.display_name=b),d!==c&&(a.snapshot.display_description=d),e.Comm.post(g+"/snapshots",a,e.Keystone.params.token,function(a){h!==c&&h(a)},function(a){i!==c&&i(a)}))},deletesnapshot:function(a,b,d){f()&&(a=g+"/snapshots/"+a,e.Comm.del(a,e.Keystone.params.token,
function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},getsnapshot:function(a,b,d){f()&&(a=g+"/snapshots/"+a,e.Comm.get(a,e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))}}}(JSTACK);JSTACK.Glance=function(e,c){var g,i,f;g=c;i="publicURL";f=function(){return e.Keystone!==c&&e.Keystone.params.currentstate===e.Keystone.STATES.AUTHENTICATED?(g=e.Keystone.getservice("image").endpoints[0][i],!0):!1};return{configure:function(a){if("adminURL"===a||"internalURL"===a||"publicURL"===a)i=a},getimagelist:function(a,b,d){var h;f()&&(h=g+"/images",a!==c&&a&&(h+="/detail"),e.Comm.get(h+"?limit=100",e.Keystone.params.token,function(a){b!==c&&b(a)},function(a){d!==c&&d(a)}))},getimagedetail:function(a,
b,d){var h,i;f()&&(h=g+"/images/"+a,a=function(a,d){if(b!==c)if(h.match(/v1/)){var f={};d.split("\r\n").forEach(function(a){if(-1!==a.indexOf("x-image-meta")){var c=a.match(/^([\w\d\-\_]*)\: (.*)$/),a=c[2],c=c[1].split("-");f[c[c.length-1]]=a}});b(f,d)}else b(a)},i=function(a){d!==c&&d(a)},h.match(/v1/)?e.Comm.head(h,e.Keystone.params.token,a,i):e.Comm.get(h,e.Keystone.params.token,a,i))},updateimage:function(a,b,d,h,i,j,l,m){var n={};if(f()){a=g+"/images/"+a;b&&(n["x-image-meta-name"]=b);d&&(n["x-image-meta-is_public"]=
d);h&&(n["x-image-meta-min_ram"]=h);i&&(n["x-image-meta-min_disk"]=i);for(var o in j)n["x-image-meta-property-"+o]=j[o];e.Comm.put(a,c,e.Keystone.params.token,function(a){l!==c&&l(a)},function(a){m!==c&&m(a)},n)}}}}(JSTACK);JSTACK.Neutron=function(e,c){var g,i;g={url:c,state:c,endpointType:"publicURL"};i=function(){if(e.Keystone!==c&&e.Keystone.params.currentstate===e.Keystone.STATES.AUTHENTICATED){var f=e.Keystone.getservice("network");if(f)return g.url=f.endpoints[0][g.endpointType],!0}return!1};return{params:g,configure:function(c){if("adminURL"===c||"internalURL"===c||"publicURL"===c)g.endpointType=c},getnetworkslist:function(f,a){var b;i()&&(b=g.url+"v2.0/networks",e.Comm.get(b,e.Keystone.params.token,function(a){f!==
c&&f(a)},function(b){a!==c&&a(b)}))},getnetworkdetail:function(f,a,b){i()&&(f=g.url+"v2.0/networks/"+f,e.Comm.get(f,e.Keystone.params.token,function(b){a!==c&&a(b)},function(a){b!==c&&b(a)}))},createnetwork:function(f,a,b,d,h,k){var j,l;i()&&(j=g.url+"v2.0/networks",l={network:{}},f!==c&&(l.network.name=f),a!==c&&(l.network.admin_state_up=a),b!==c&&(l.network.shared=b),d!==c&&(l.network.tenant_id=d),e.Comm.post(j,l,e.Keystone.params.token,function(a){h!==c&&h(a)},function(a){k!==c&&k(a)}))},updatenetwork:function(f,
a,b,d,h){var k;i()&&(f=g.url+"v2.0/networks/"+f,k={network:{}},a!==c&&(k.network.name=a),b!==c&&(k.network.admin_state_up=b),e.Comm.put(f,k,e.Keystone.params.token,function(a){d!==c&&d(a)},function(a){h!==c&&h(a)}))},deletenetwork:function(f,a,b){i()&&(f=g.url+"v2.0/networks/"+f,e.Comm.del(f,e.Keystone.params.token,function(b){a!==c&&a(b)},function(a){b!==c&&b(a)}))},getsubnetslist:function(f,a){var b;i()&&(b=g.url+"v2.0/subnets",e.Comm.get(b,e.Keystone.params.token,function(a){f!==c&&f(a)},function(b){a!==
c&&a(b)}))},getsubnetdetail:function(f,a,b){i()&&(f=g.url+"v2.0/subnets/"+f,e.Comm.get(f,e.Keystone.params.token,function(b){a!==c&&a(b)},function(a){b!==c&&b(a)}))},createsubnet:function(f,a,b,d,h,k,j,l,m,n){var o,q=[],p=[],r=[];if(i()){j=g.url+"v2.0/subnets";f={subnet:{network_id:f,cidr:a,ip_version:4}};b!==c&&(f.subnet.name=b);h!==c&&(f.subnet.tenant_id=h);if(d!==c){for(o in d)d[o]!==c&&(b=d[o],q.push(b));f.subnet.allocation_pools=q}k!==c&&(f.subnet.gateway_ip=k);l!==c&&(f.subnet.enable_dhcp=l);
if(m!==c){for(o in m)m[o]!==c&&(d=m[o],p.push(d));f.subnet.dns_nameservers=p}if(n!==c){for(o in n)n[o]!==c&&(m=n[o],r.push(m));f.subnet.host_routes=r}e.Comm.post(j,f,e.Keystone.params.token,void 0,void 0)}},updatesubnet:function(f,a,b,d,h,k,j,l){var m,n,o=[],q=[];if(i()){f=g.url+"v2.0/subnets/"+f;m={subnet:{}};a!==c&&(m.subnet.name=a);b!==c&&(m.subnet.gateway_ip=b);d!==c&&(m.subnet.enable_dhcp=d);if(h!==c){for(n in h)h[n]!==c&&(a=h[n],o.push(a));m.subnet.dns_nameservers=o}if(k!==c){for(n in k)k[n]!==
c&&(h=k[n],q.push(h));m.subnet.host_routes=q}e.Comm.put(f,m,e.Keystone.params.token,function(a){j!==c&&j(a)},function(a){l!==c&&l(a)})}},deletesubnet:function(f,a,b){i()&&(f=g.url+"v2.0/subnets/"+f,e.Comm.del(f,e.Keystone.params.token,function(b){a!==c&&a(b)},function(a){b!==c&&b(a)}))},getportslist:function(f,a){var b;i()&&(b=g.url+"v2.0/ports",e.Comm.get(b,e.Keystone.params.token,function(a){f!==c&&f(a)},function(b){a!==c&&a(b)}))},getportdetail:function(f,a,b){i()&&(f=g.url+"v2.0/ports/"+f,e.Comm.get(f,
e.Keystone.params.token,function(b){a!==c&&a(b)},function(a){b!==c&&b(a)}))},createport:function(f,a,b,d,h,k,j,l,m,n){var o,q=[],p,r=[];if(i()){o=g.url+"v2.0/ports";f={port:{network_id:f}};k!==c&&(f.port.status=k);a!==c&&(f.port.name=a);h!==c&&(f.port.admin_state_up=h);j!==c&&(f.port.tenant_id=j);l!==c&&(f.port.mac_address=l);if(b!==c){for(p in b)b[p]!==c&&(a=b[p],r.push(a));f.port.fixed_ips=r}if(d!==c){for(p in d)d[p]!==c&&(b=d[p],q.push(b));f.port.security_groups=q}e.Comm.post(o,f,e.Keystone.params.token,
function(a){m!==c&&m(a)},function(a){n!==c&&n(a)})}},updateport:function(f,a,b,d,h,k,j,l,m,n){var o,q=[],p,r=[];if(i()){f=g.url+"v2.0/ports/"+f;o={port:{}};k!==c&&(o.port.status=k);a!==c&&(o.port.name=a);h!==c&&(o.port.admin_state_up=h);j!==c&&(o.port.tenant_id=j);l!==c&&(o.port.mac_address=l);if(b!==c){for(p in b)b[p]!==c&&(a=b[p],r.push(a));o.port.fixed_ips=r}if(d!==c){for(p in d)d[p]!==c&&(b=d[p],q.push(b));o.port.security_groups=q}e.Comm.put(f,o,e.Keystone.params.token,function(a){m!==c&&m(a)},
function(a){n!==c&&n(a)})}},deleteport:function(f,a,b){i()&&(f=g.url+"v2.0/ports/"+f,e.Comm.del(f,e.Keystone.params.token,function(b){a!==c&&a(b)},function(a){b!==c&&b(a)}))},getrouterslist:function(f,a){var b;i()&&(b=g.url+"v2.0/routers",e.Comm.get(b,e.Keystone.params.token,function(a){f!==c&&f(a)},function(b){a!==c&&a(b)}))},createrouter:function(f,a,b,d,h,k){var j,l;i()&&(j=g.url+"v2.0/routers",l={router:{external_gateway_info:{}}},b!==c&&(l.router.external_gateway_info.network_id=b),f!==c&&(l.router.name=
f),a!==c&&(l.router.admin_state_up=a),d!==c&&(l.router.tenant_id=d),e.Comm.post(j,l,e.Keystone.params.token,function(a){h!==c&&h(a)},function(a){k!==c&&k(a)}))},updaterouter:function(f,a,b,d,h,k){var j;i()&&(f=g.url+"v2.0/routers/"+f,j={router:{external_gateway_info:{}}},a!==c&&(j.router.external_gateway_info.network_id=a),b!==c&&(j.router.name=b),d!==c&&(j.router.admin_state_up=d),e.Comm.put(f,j,e.Keystone.params.token,function(a){h!==c&&h(a)},function(a){k!==c&&k(a)}))},getrouterdetail:function(f,
a,b){i()&&(f=g.url+"v2.0/routers/"+f,e.Comm.get(f,e.Keystone.params.token,function(b){a!==c&&a(b)},function(a){b!==c&&b(a)}))},deleterouter:function(f,a,b){i()&&(f=g.url+"v2.0/routers/"+f,e.Comm.del(f,e.Keystone.params.token,function(b){a!==c&&a(b)},function(a){b!==c&&b(a)}))},addinterfacetorouter:function(f,a,b,d,h){var k;i()&&(f=g.url+"v2.0/routers/"+f+"/add_router_interface",k={},a!==c&&(k.subnet_id=a),b!==c&&(k.port_id=b),e.Comm.put(f,k,e.Keystone.params.token,function(a){d!==c&&d(a)},function(a){h!==
c&&h(a)}))},removeinterfacefromrouter:function(f,a,b,d,h){var k;i()&&(k={},f=g.url+"v2.0/routers/"+f+"/remove_router_interface",b!==c&&(k.subnet_id=b),a!==c&&(k.port_id=a),e.Comm.put(f,k,e.Keystone.params.token,function(a){d!==c&&d(a)},function(a){h!==c&&h(a)}))}}}(JSTACK);
