function custom_require(e,t){var n=e.length,r=0;for(var i in e){var s=e[i];if(navigator.userAgent.indexOf("MSIE")!=-1||!0)s+="?random="+Math.round(Math.random()*99999),e[i]=s}require(e,t)}function loadTemplates(e,t){var n=e.length,r=0,i=function(e){$("head").append(e),r++,r===n&&t()};for(var s in e){var o=e[s];$.ajax({url:o+"?random="+Math.random()*99999,asynx:!1,success:i})}}var loadOS=function(){$(document).ready(function(){console.log("Initializing"),UTILS.Auth.initialize("http://130.206.80.93/keystone/v2.0/","http://130.206.80.93/keystone-admin/v2.0/"),console.log("Initialized");var e=new OSRouter;Backbone.history.start()})},loadRoutes=function(){custom_require(["js/routes/os-routes.js"],function(e){loadOS()})},loadViews=function(){custom_require(["js/views/LoginView.js","js/views/NavTabView.js","js/views/TopBarView.js","js/views/SideBarView.js","js/views/RootView.js","js/views/syspanel/OverviewView.js","js/views/syspanel/ImageView.js","js/views/syspanel/InstanceView.js","js/views/syspanel/FlavorView.js","js/views/syspanel/ProjectView.js","js/views/syspanel/ServiceView.js","js/views/syspanel/UserView.js","js/views/syspanel/QuotaView.js","js/views/nova/OverviewView.js","js/views/nova/AccessAndSecurityView.js","js/views/nova/KeypairsView.js","js/views/nova/SecurityGroupsView.js","js/views/nova/FloatingIPsView.js","js/views/nova/InstancesAndVolumesView.js","js/views/nova/VolumeDetailView.js","js/views/nova/VolumesView.js","js/views/nova/InstancesView.js","js/views/nova/SnapshotsView.js","js/views/nova/InstanceSnapshotsView.js","js/views/nova/VolumeSnapshotsView.js","js/views/nova/VDCsView.js","js/views/nova/VDCView.js","js/views/nova/VDCServiceView.js","js/views/objectstorage/ContainersView.js","js/views/objectstorage/ContainerView.js","js/views/forms/UpdateInstanceView.js","js/views/forms/CreateFlavorView.js","js/views/forms/UpdateImageView.js","js/views/forms/LaunchImageView.js","js/views/forms/ConsultImageDetailView.js","js/views/forms/ChangePasswordView.js","js/views/forms/CreateSnapshotView.js","js/views/forms/CreateVolumeSnapshotView.js","js/views/forms/CreateVolumeView.js","js/views/forms/EditVolumeAttachmentsView.js","js/views/forms/ConfirmView.js","js/views/forms/CreateContainerView.js","js/views/forms/LaunchVDCView.js","js/views/forms/CreateVDCServiceView.js","js/views/forms/CopyObjectView.js","js/views/forms/UploadObjectView.js","js/views/forms/CreateSecurityGroupView.js","js/views/forms/EditSecurityGroupRulesView.js","js/views/forms/CreateKeypairView.js","js/views/forms/ImportKeypairView.js","js/views/forms/DownloadKeypairView.js","js/views/forms/AllocateIPView.js","js/views/nova/InstanceDetailView.js","js/views/SettingsView.js","js/views/forms/MessagesView.js"],function(e){loadRoutes()})},loadModels=function(){custom_require(["js/models/FlavorModel.js","js/models/OverviewModel.js","js/models/ImageModel.js","js/models/ProjectModel.js","js/models/InstanceModel.js","js/models/VolumeModel.js","js/models/VolumeSnapshotModel.js","js/models/UserModel.js","js/models/QuotaModel.js","js/models/KeypairModel.js","js/models/LoginModel.js","js/models/ServiceModel.js","js/models/NavTabModel.js","js/models/TopBarModel.js","js/models/ContainerModel.js","js/models/VDCModel.js","js/models/VDCServiceModel.js","js/models/SecurityGroupModel.js","js/models/FloatingIPModel.js"],function(e){loadViews()})},loadUtils=function(){custom_require(["js/os-utils.js"],function(e){loadModels()})},loadLibraries=function(){custom_require(["lib/backbone.js","lib/jstack.js","lib/bootstrap.min.js","lib/jquery.selectbox-0.1.3.min.js","lib/cdmi.js"],function(e){loadUtils()})},loadTemplates=function(){custom_require(["js/load-templates.js"],function(e){loadTemplates(["templates/auth/login.html","templates/forms/updateInstance.html","templates/forms/createFlavor.html","templates/forms/updateImage.html","templates/forms/rebootInstances.html","templates/forms/changePassword.html","templates/forms/createSnapshot.html","templates/forms/createVolumeSnapshot.html","templates/forms/createVolume.html","templates/forms/editVolumeAttachments.html","templates/forms/launchImage.html","templates/forms/createContainer.html","templates/forms/copyObject.html","templates/forms/uploadObject.html","templates/forms/launchVDC.html","templates/forms/createVDCService.html","templates/forms/createSecurityGroup.html","templates/forms/editSecurityGroupRules.html","templates/forms/createKeypair.html","templates/forms/importKeypair.html","templates/forms/downloadKeypair.html","templates/forms/allocateIP.html","templates/root/nova/overview.html","templates/root/nova/accessAndSecurity.html","templates/root/nova/keypairs.html","templates/root/nova/securityGroups.html","templates/root/nova/floatingIPs.html","templates/root/nova/snapshots.html","templates/root/nova/snapshots/instanceSnapshots.html","templates/root/nova/snapshots/volumeSnapshots.html","templates/root/nova/instancesAndVolumes.html","templates/root/nova/instancesAndVolumes/instances.html","templates/root/nova/instancesAndVolumes/volumes.html","templates/root/nova/instanceDetail.html","templates/root/nova/imageDetail.html","templates/root/nova/volumeDetail.html","templates/root/nova/VDCs.html","templates/root/nova/VDC.html","templates/root/nova/VDCService.html","templates/root/objectstorage/containers.html","templates/root/objectstorage/container.html","templates/root/sys/images.html","templates/root/sys/overview.html","templates/root/sys/instances.html","templates/root/sys/services.html","templates/root/sys/flavors.html","templates/root/sys/projects.html","templates/root/sys/users.html","templates/root/sys/quotas.html","templates/root/root.html","templates/root/navTab.html","templates/root/topBar.html","templates/root/sideBar.html","templates/root/confirm.html","templates/root/settings.html","templates/messages.html"],function(){loadLibraries()})})},loadModules=function(){custom_require(["http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js","lib/underscore.js"],function(e){loadTemplates()})};loadModules(),$(document).ready(function(){UTILS.Auth.initialize("http://mcu5.dit.upm.es:5000/v2.0/");var e=new OSRouter;Backbone.history.start()});var Container=Backbone.Model.extend({_action:function(e,t){var n=this;t=t||{},t.success=function(e){n.trigger("sync",n,e,t),t.callback!==undefined&&t.callback(e)};var r=(this.sync||Backbone.sync).call(this,e,this,t);return r},copyObject:function(e,t,n,r,i){return console.log("Copy object"),i=i||{},i.currentContainer=e,i.currentObject=t,i.targetContainer=n,i.targetObject=r,this._action("copyObject",i)},uploadObject:function(e,t,n,r){return console.log("Upload object"),r=r||{},r.container=e,r.objectName=t,r.object=n,this._action("uploadObject",r)},downloadObject:function(e,t,n){return console.log("Download object"),n=n||{},n.container=e,n.object=t,this._action("downloadObject",n)},deleteObject:function(e,t){return console.log("Delete object"),t=t||{},t.container=e,this._action("deleteObject",t)},deleteObjects:function(e,t){return console.log("Delete objects"),t=t||{},t.container=e,console.log(t.container),this._action("deleteObject",t)},sync:function(e,t,n){switch(e){case"read":mySucess=function(e){var t={};return t.objects=e,n.success(t)},CDMI.Actions.getobjectlist(t.get("name"),mySucess);break;case"delete":CDMI.Actions.deletecontainer(t.get("name"),n.success),console.log(n.success);break;case"create":CDMI.Actions.createcontainer(t.get("name"),n.success);break;case"copyObject":CDMI.Actions.copyobject(n.currentContainer,n.currentObject,n.targetContainer,n.targetObject,n.success);break;case"uploadObject":CDMI.Actions.uploadobject(n.container,n.objectName,n.object,n.success);break;case"downloadObject":mySucess=function(e){var t={};return t.object=e,n.success(t)},CDMI.Actions.downloadobject(n.container,n.object,mySucess);break;case"deleteObject":if(n.name!==undefined){CDMI.Actions.deleteobject(n.container,n.name,n.success);break}for(var r in n)n.name=n[r].name,n.name!==undefined&&n.name!==""&&CDMI.Actions.deleteobject(n.container,n.name,n.success)}},parse:function(e){return e.container!==undefined?(e.container.id=e.container.name,e.container):(e.id=e.name,e)}}),Containers=Backbone.Collection.extend({model:Container,sync:function(e,t,n){e==="read"&&CDMI.Actions.getcontainerlist(n.success)},comparator:function(e){return e.get("id")},parse:function(e){return e}}),Flavor=Backbone.Model.extend({sync:function(e,t,n){switch(e){case"read":JSTACK.Nova.getflavordetail(t.get("id"),n.success);break;case"delete":JSTACK.Nova.deleteflavor(t.get("id"),n.success);break;case"create":JSTACK.Nova.createflavor(t.get("name"),t.get("memory_mb"),t.get("vcpus"),t.get("disk_gb"),t.get("flavor_id"),t.get("eph_gb"),undefined,undefined,n.success)}},parse:function(e){return e.flavor!==undefined?e.flavor:e}}),Flavors=Backbone.Collection.extend({model:Flavor,sync:function(e,t,n){e==="read"&&JSTACK.Nova.getflavorlist(!0,n.success)},comparator:function(e){return e.get("id")},parse:function(e){return e.flavors}}),FloatingIP=Backbone.Model.extend({initialize:function(){this.id=this.get("name")},sync:function(e,t,n){}}),FloatingIPs=Backbone.Collection.extend({model:FloatingIP,sync:function(e,t,n){},parse:function(e){return e}}),ImageVM=Backbone.Model.extend({sync:function(e,t,n){switch(e){case"read":JSTACK.Nova.getimagedetail(t.get("id"),n.success);break;case"delete":JSTACK.Nova.deleteimage(t.get("id"),n.success);break;case"update":JSTACK.Nova.updateimage(t.get("id"),t.get("name"),n.success)}},parse:function(e){return e.image!==undefined?e.image:e}}),Images=Backbone.Collection.extend({model:ImageVM,sync:function(e,t,n){e==="read"&&JSTACK.Nova.getimagelist(!0,n.success)},parse:function(e){return e.images}}),Instance=Backbone.Model.extend({_action:function(e,t){var n=this;t===null&&(t={}),t.success=function(e){n.trigger("sync",n,e,t),t.callback!==undefined&&t.callback(e)};var r=(this.sync||Backbone.sync).call(this,e,this,t);return r},createsnapshot:function(e){return this._action("snapshot",e)},pauseserver:function(e){return this._action("pause",e)},unpauseserver:function(e){return this._action("unpause",e)},suspendserver:function(e){return this._action("suspend",e)},resumeserver:function(e){return this._action("resume",e)},reboot:function(e,t){return t=t||{},t.soft=e,this._action("reboot",t)},resize:function(e,t){return t=t||{},t.flavor=e,this._action("resize",t)},confirmresize:function(e){return this._action("confirm-resize",e)},revertresize:function(e){return this._action("revert-resize",e)},changepassword:function(e,t){return t=t||{},t.adminPass=e,this._action("change-password",t)},createimage:function(e){return this._action("create-image",e)},vncconsole:function(e){return this._action("get-vncconsole",e)},consoleoutput:function(e){return e===undefined&&(e={}),e.length===undefined&&(e.length=35),this._action("consoleoutput",e)},attachvolume:function(e){return e===undefined&&(e={}),this._action("attachvolume",e)},detachvolume:function(e){return e===undefined&&(e={}),this._action("detachvolume",e)},attachedvolumes:function(e){return e===undefined&&(e={}),this._action("attachedvolumes",e)},sync:function(e,t,n){switch(e){case"create":JSTACK.Nova.createserver(t.get("name"),t.get("imageReg"),t.get("flavorReg"),t.get("key_name"),t.get("user_data"),t.get("security_groups"),t.get("min_count"),t.get("max_count"),t.get("availability_zone"),n.success);break;case"delete":JSTACK.Nova.deleteserver(t.get("id"),n.success);break;case"update":JSTACK.Nova.updateserver(t.get("id"),t.get("name"),n.success);break;case"read":JSTACK.Nova.getserverdetail(t.get("id"),n.success);break;case"reboot":n.soft!==undefined&&n.soft?JSTACK.Nova.rebootserversoft(t.get("id"),n.success):JSTACK.Nova.rebootserverhard(t.get("id"),n.success);break;case"resize":JSTACK.Nova.resizeserver(t.get("id"),n.flavor.id,n.success);break;case"snapshot":JSTACK.Nova.createsnapshot(t.get("id"),t.get("name"),n.success);break;case"confirm-resize":JSTACK.Nova.confirmresizedserver(t.get("id"),n.success);break;case"revert-resize":JSTACK.Nova.revertresizedserver(t.get("id"),n.success);break;case"pause":JSTACK.Nova.pauseserver(t.get("id"),n.success);break;case"unpause":JSTACK.Nova.unpauseserver(t.get("id"),n.success);break;case"suspend":JSTACK.Nova.suspendserver(t.get("id"),n.success);break;case"resume":JSTACK.Nova.resumeserver(t.get("id"),n.success);break;case"change-password":JSTACK.Nova.changepasswordserver(t.get("id"),n.adminPass,n.success);break;case"create-image":JSTACK.Nova.createimage(t.get("id"),n.success);break;case"get-vncconsole":JSTACK.Nova.getvncconsole(t.get("id"),"novnc",n.success);break;case"consoleoutput":JSTACK.Nova.getconsoleoutput(t.get("id"),n.length,n.success);break;case"attachvolume":JSTACK.Nova.attachvolume(t.get("id"),n.volume_id,n.device,n.success);break;case"detachvolume":JSTACK.Nova.detachvolume(t.get("id"),n.volume_id,n.success);break;case"attachedvolumes":JSTACK.Nova.getattachedvolumes(t.get("id"),n.success)}},parse:function(e){return e.server!==undefined?e.server:e}}),Instances=Backbone.Collection.extend({model:Instance,sync:function(e,t,n){e==="read"&&JSTACK.Nova.getserverlist(!0,this.alltenants,n.success)},parse:function(e){return e.servers}}),Keypair=Backbone.Model.extend({initialize:function(){this.id=this.get("name")},_action:function(e,t){var n=this;t==null&&(t={}),t.success=function(e){n.trigger("sync",n,e,t),t.callback!==undefined&&t.callback(e)};var r=(this.sync||Backbone.sync).call(this,e,this,t);return r},createkeypair:function(e,t,n){return console.log("Create keypair"),n=n||{},this._action("createkeypair",n)},sync:function(e,t,n){switch(e){case"create":JSTACK.Nova.createkeypair(t.get("name"),t.get("public_key"),n.success);break;case"createkeypair":console.log(t.get("name"),t.get("public_key")),mySuccess=function(e){var t={};return t.object=e,n.success(t)},JSTACK.Nova.createkeypair(t.get("name"),t.get("public_key"),mySuccess);break;case"delete":JSTACK.Nova.deletekeypair(t.get("name"),n.success)}}}),Keypairs=Backbone.Collection.extend({model:Keypair,sync:function(e,t,n){e==="read"&&JSTACK.Nova.getkeypairlist(n.success)},parse:function(e){var t=[];for(var n in e.keypairs){var r=e.keypairs[n];t.push(r.keypair)}return t}}),LoginStatus=Backbone.Model.extend({defaults:{loggedIn:!1,username:null,password:null,error_msg:null,token:"",tenant:undefined,tenants:undefined},initialize:function(){this.bind("credentials",this.onCredentialsChange,this),this.bind("change:token",this.onTokenChange,this),this.bind("error",this.onValidateError,this),this.set({"token-ts":localStorage.getItem("token-ts")}),this.set({token:localStorage.getItem("token")})},onValidateError:function(e,t){e.set({error_msg:"Username and password are mandatory."}),e.trigger("auth-error",t.msg)},onCredentialsChange:function(e,t){var n=this;if(n.get("username")!==""&&n.get("password")!=="")UTILS.Auth.authenticate(n.get("username"),n.get("password"),undefined,undefined,function(){console.log("Authenticated with credentials"),n.setToken(),n.set({username:UTILS.Auth.getName(),tenant:UTILS.Auth.getCurrentTenant()}),UTILS.Auth.getTenants(function(e){n.set({tenants:e}),n.set({loggedIn:!0})})},function(e){n.set({error_msg:e}),n.trigger("auth-error",e)});else{var r="Username and password are mandatory.";n.set({error_msg:r}),n.trigger("auth-error",r)}},onTokenChange:function(e,t){var n=e;!UTILS.Auth.isAuthenticated()&&t!==""&&(new Date).getTime()<n.get("token-ts")+864e5?UTILS.Auth.authenticate(undefined,undefined,undefined,t,function(){console.log("Authenticated with token"),n.set({username:UTILS.Auth.getName(),tenant:UTILS.Auth.getCurrentTenant()}),console.log("New tenant: "+n.attributes.tenant.name),UTILS.Auth.getTenants(function(e){n.set({tenants:e}),n.set({loggedIn:!0})})},function(e){console.log("Error authenticating with token"),n.set({error_msg:e}),n.trigger("auth-error",e)}):(console.log("Not logged In"),n.set({expired:!0}),n.trigger("auth-needed",""),n.set({loggedIn:!1}))},setToken:function(){localStorage.getItem("token")!==UTILS.Auth.getToken()&&localStorage.setItem("token-ts",(new Date).getTime()),localStorage.setItem("token",UTILS.Auth.getToken()),this.set({token:UTILS.Auth.getToken()})},isAdmin:function(){return UTILS.Auth.isAdmin()},removeToken:function(){localStorage.setItem("token",""),this.set({token:""})},setCredentials:function(e,t){console.log("Setting credentials"),this.set({username:e,password:t,error_msg:undefined}),this.trigger("credentials",this)},switchTenant:function(e){var t=this;console.log("Tenant: "+e),UTILS.Auth.switchTenant(e,function(e){t.set({username:UTILS.Auth.getName(),tenant:UTILS.Auth.getCurrentTenant()}),t.trigger("switch-tenant")})},clearAll:function(){localStorage.setItem("token",""),this.set(this.defaults)}}),NavTabModel=Backbone.Model.extend({defaults:{name:undefined,active:!1,url:undefined}}),NavTabModels=Backbone.Collection.extend({model:NavTabModel,setActive:function(e){for(var t in this.models){var n=this.models[t];n.get("name")==e?n.set({active:!0}):n.set({active:!1})}this.trigger("change:actives","Changes")},getActive:function(){for(var e in this.models){var t=this.models[e];if(t.get("active"))return t.get("name")}}}),Overview=Backbone.Model.extend({sync:function(e,t,n){switch(e){case"read":JSTACK.Nova.getimagedetail(t.get("id"),n.success);break;case"downloadSummary":JSTACK.Nova.getimagedetail(t.get("id"),n.success)}}}),Overviewes=Backbone.Collection.extend({model:Overview,sync:function(e,t,n){e==="read"&&JSTACK.Nova.getusagesummary(!0,n.success)},parse:function(e){return e.overview}}),Project=Backbone.Model.extend({sync:function(e,t,n){switch(e){case"read":JSTACK.Keystone.gettenants(t.get("id"),n.success);break;case"delete":JSTACK.Keystone.deletetenant(t.get("id"),n.success);break;case"create":JSTACK.Keystone.createtenant(t.get("id"),n.success);break;case"filter":JSTACK.Keystone.filtertenant(t.get("id"),n.success)}}}),Projects=Backbone.Collection.extend({model:Project,sync:function(e,t,n){e==="read"&&JSTACK.Keystone.gettenants(n.success)},parse:function(e){return e.tenants}}),Quota=Backbone.Model.extend({sync:function(e,t,n){}}),Quotas=Backbone.Collection.extend({model:Quota,sync:function(e,t,n){e==="read"&&JSTACK.Nova.getquotalist(n.success)},parse:function(e){return e.quota_set}}),SecurityGroup=Backbone.Model.extend({_action:function(e,t){var n=this;t==null&&(t={}),t.success=function(e){n.trigger("sync",n,e,t),t.callback!==undefined&&t.callback(e)};var r=(this.sync||Backbone.sync).call(this,e,this,t);return r},createSecurityGroupRule:function(e,t,n,r,i,s,o){return o=o||{},o.ip_protocol=e,o.from_port=t,o.to_port=n,o.cidr=r,o.group_id=i,o.parent_group_id=s,this._action("createSecurityGroupRule",o)},deleteSecurityGroupRule:function(e,t){return console.log("Delete security group rule"),t=t||{},t.secGroupRuleId=e,this._action("deleteSecurityGroupRule",t)},getSecurityGroupforServer:function(e,t){return console.log("Get security groups for server"),t=t||{},t.serverId=e,this._action("getSecurityGroupforServer",t)},sync:function(e,t,n){switch(e){case"read":JSTACK.Nova.getsecuritygroupdetail(t.get("id"),n.success);break;case"delete":JSTACK.Nova.deletesecuritygroup(t.get("id"),n.success);break;case"create":JSTACK.Nova.createsecuritygroup(t.get("name"),t.get("description"),n.success);break;case"createSecurityGroupRule":JSTACK.Nova.createsecuritygrouprule(n.ip_protocol,n.from_port,n.to_port,n.cidr,n.group_id,n.parent_group_id,n.success);break;case"deleteSecurityGroupRule":JSTACK.Nova.deletesecuritygrouprule(n.secGroupRuleId,n.success);break;case"getSecurityGroupforServer":mySuccess=function(e){var t={};return t.object=e,n.success(t)},JSTACK.Nova.getsecuritygroupforserver(n.serverId,mySuccess)}},parse:function(e){return e.security_group!==undefined?e.security_group:e}}),SecurityGroups=Backbone.Collection.extend({model:SecurityGroup,sync:function(e,t,n){e==="read"&&JSTACK.Nova.getsecuritygrouplist(n.success)},parse:function(e){return e.security_groups}}),Service=Backbone.Model.extend({sync:function(e,t,n){switch(e){case"read":JSTACK.Keystone.getservice(t.get("id"),n.success);break;case"filter":JSTACK.Keystone.filterservice(t.get("id"),n.success)}}}),Services=Backbone.Collection.extend({model:Service,sync:function(e,t,n){if(e==="read"){var r=JSTACK.Keystone.getservicelist();n.success(r)}},parse:function(e){return e}}),TopBarModel=Backbone.Model.extend({}),User=Backbone.Model.extend({sync:function(e,t,n){switch(e){case"read":JSTACK.Keystone.getuser(t.get("id"),n.success);break;case"delete":JSTACK.Keystone.deleteuser(t.get("id"),n.success);break;case"create":JSTACK.Keystone.createuser(t.get("id"),n.success);break;case"filter":JSTACK.Keystone.filteruser(t.get("id"),n.success);break;case"edit":JSTACK.Keystone.edituser(t.get("id"),n.success)}}}),Users=Backbone.Collection.extend({model:User,sync:function(e,t,n){e==="read"&&JSTACK.Keystone.getusers(!0,n.success)},parse:function(e){return e.users}}),VDC=Backbone.Model.extend({sync:function(e,t,n){switch(e){case"read":n.success({vdc:{id:"mockVDC",name:"mockVDC",vcpus:1,disk:10,ram:1,vcpu_hours:1,disk_hours:1}});break;case"delete":break;case"create":}},parse:function(e){return e.vdc!==undefined?e.vdc:e}}),VDCs=Backbone.Collection.extend({model:VDC,sync:function(e,t,n){if(e==="read"){var r=new VDC({id:"mockVDC",name:"mockVDC",vcpus:1,disk:10,ram:1,vcpu_hours:1,disk_hours:1});n.success({vdcs:[r]})}},comparator:function(e){return e.get("id")},parse:function(e){return e.vdcs}}),VDCService=Backbone.Model.extend({sync:function(e,t,n){switch(e){case"read":var r=function(e){var t=e.servers,r=[];for(var i in t)if(t.hasOwnProperty(i)){var s=new Instance(t[i]);r.push(s)}n.success({service:{id:"mockService",name:"mockService",vcpus:1,disk:10,ram:1,vcpu_hours:1,disk_hours:1,models:r}})};JSTACK.Nova.getserverlist(!0,this.alltenants,r);break;case"delete":break;case"create":}},getInstance:function(e){var t=this.get("models");for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(e===r.id)return r}},parse:function(e){return e.service!==undefined?e.service:e}}),VDCServices=Backbone.Collection.extend({model:VDCService,sync:function(e,t,n){if(e=="read"){var r=new VDCService({id:"mockService",name:"mockService",vcpus:1,disk:10,ram:1,vcpu_hours:1,disk_hours:1});n.success({services:[r]})}},comparator:function(e){return e.get("id")},parse:function(e){return e.services}}),Volume=Backbone.Model.extend({_action:function(e,t){var n=this;t===undefined&&(t={}),t.success=function(e){n.trigger("sync",n,e,t),t.callback!==undefined&&t.callback(e)};var r=(this.sync||Backbone.sync).call(this,e,this,t);return r},sync:function(e,t,n){switch(e){case"create":JSTACK.Nova.Volume.createvolume(t.get("size"),t.get("name"),t.get("description"),n.success);break;case"delete":JSTACK.Nova.Volume.deletevolume(t.get("id"),n.success);break;case"update":break;case"read":JSTACK.Nova.Volume.getvolume(t.get("id"),n.success)}},parse:function(e){return e.volume!==undefined?e.volume:e}}),Volumes=Backbone.Collection.extend({model:Volume,sync:function(e,t,n){e=="read"&&JSTACK.Nova.Volume.getvolumelist(!0,n.success)},parse:function(e){return e.volumes}}),VolumeSnapshot=Backbone.Model.extend({_action:function(e,t){var n=this;t===undefined&&(t={}),t.success=function(e){n.trigger("sync",n,e,t),t.callback!==undefined&&t.callback(e)};var r=(this.sync||Backbone.sync).call(this,e,this,t);return r},sync:function(e,t,n){switch(e){case"create":JSTACK.Nova.Volume.createsnapshot(t.get("volume_id"),t.get("name"),t.get("description"),n.success);break;case"delete":JSTACK.Nova.Volume.deletesnapshot(t.get("id"),n.success);break;case"update":break;case"read":JSTACK.Nova.Volume.getsnapshot(t.get("id"),n.success)}},parse:function(e){return e.snapshot!==undefined?e.snapshot:e}}),VolumeSnapshots=Backbone.Collection.extend({model:VolumeSnapshot,sync:function(e,t,n){e==="read"&&JSTACK.Nova.Volume.getsnapshotlist(!0,n.success)},parse:function(e){return e.snapshots}}),UTILS=UTILS||{};UTILS.VERSION="0.1",UTILS.AUTHORS="GING",UTILS.Auth=function(e,t){function r(e,t){JSTACK.Keystone.init(e,t)}function i(){return JSTACK.Keystone.params.token}function s(){return JSTACK.Keystone.params.access.user.name}function o(e){return JSTACK.Keystone.gettenants(function(t){e(t.tenants)})}function c(e,r,i,s,o,u){var a=function(e){console.log("Authenticated with tentant"),JSTACK.Keystone.params.access.serviceCatalog[0].endpoints[0].adminURL="http://130.206.80.91:8774/v2.0/"+e.access.token.tenant.id,JSTACK.Keystone.params.access.serviceCatalog[0].endpoints[0].publicURL="http://130.206.80.91:8774/v2.0/"+e.access.token.tenant.id,JSTACK.Keystone.params.access.serviceCatalog[0].endpoints[0].internalURL="http://130.206.80.91:8774/v2.0/"+e.access.token.tenant.id,o()},f=function(e){console.log("Authenticated with token"),o()},l=function(){console.log("Authenticated without tentants. Retrieving tenants...");var e=function(e){n=e.tenants,c()};JSTACK.Keystone.gettenants(e)},c=function(e){n.length>0?(e=e||n.pop(),console.log("Authenticating for tenant "+JSON.stringify(e.id)),JSTACK.Keystone.authenticate(t,t,JSTACK.Keystone.params.token,e.id,a,d)):(console.log("Error authenticating"),u("No tenant"))},h=function(){return JSTACK.Keystone.params.token},p=function(e){u(e)},d=function(){c()},v=function(){u("Bad credentials")},m;i!==t?(m=a,console.log("Authenticating with tenant")):e!==r?(m=l,console.log("Authenticating without tenant")):s!==t&&(m=l,console.log("Authenticating with token")),JSTACK.Keystone.authenticate(e,r,s,i,m,v)}var n=[],u=function(){return JSTACK.Keystone.params.access.token.tenant},a=function(){return JSTACK.Keystone.params.currentstate==JSTACK.Keystone.STATES.AUTHENTICATED},f=function(){var e=JSTACK.Keystone.params.access.user.roles;for(var t in e){var n=e[t];if(n.name=="admin")return!0}return!1},l=function(e,n,r){JSTACK.Keystone.authenticate(t,t,JSTACK.Keystone.params.token,e,n,r)};return{initialize:r,authenticate:c,getToken:i,getName:s,isAuthenticated:a,getCurrentTenant:u,getTenants:o,switchTenant:l,isAdmin:f}}(UTILS),UTILS.Render=function(e,t){function n(e,n,r,i){var s=n(r);return $(e).append(s),$(s).hide(),$(e).animate({marginLeft:"+1250px",marginRight:"-1250px"},200,function(){$(s).show(),$(e).html(s).css("marginLeft","1250px").css("marginRight","-1250px").animate({marginLeft:"-=1250px",marginRight:"+=1250px"},200,function(){i!==t&&i()})}),s}return{animateRender:n}}(UTILS),UTILS.i18n=function(e,t){function i(){_.extend(_,{itemplate:function(t){var n=_.template(t),r=function(t){var r=n(t);return r=e.i18n.translate(r),r};return r}}),localStorage.i18nlang===t&&(localStorage.i18nlang="en"),UTILS.i18n.setlang(localStorage.i18nlang),console.log("Language: "+localStorage.i18nlang)}function s(n,r){var i="locales/"+n+".json?random="+Math.random()*99999;$.ajax({url:i,success:function(s,o,u){console.log("loaded: "+i),e.i18n.params.dict=s,localStorage.i18nlang=n,r!==t&&r()},error:function(e,n,s){console.log("failed loading: "+i),r!==t&&r()},dataType:"json"})}function o(n){var r=$(n),i=r.find("*[data-i18n]");return i.each(function(s,o){o=$(i[s],n);var u=e.i18n.get(o.attr("data-i18n"));if(u!==t){var a=o.clone();o.text(u),r.find(a).replaceWith(o)}}),r}function u(e){var t=(new Date).getTime();e=o(e);var n=(new Date).getTime()-t;return e}function a(t,n,r){var i=e.i18n.get(t);r!=1&&(i=e.i18n.get(n));var s=l(i,r);return s}function f(n){var r=e.i18n.params.dict[n];return r===t&&(r=n),r}function l(e){var t=e.split("%"),n=t[0],r=/^([ds])(.*)$/;for(var i=1;i<t.length;i++){p=r.exec(t[i]);if(!p||arguments[i]===null)continue;p[1]=="d"?n+=parseInt(arguments[i],10):p[1]=="s"&&(n+=arguments[i]),n+=p[2]}return n}var n={},r={lang:"en",dict:n};return{params:r,init:i,setlang:s,translate:u,get:f,pluralise:a}}(UTILS),UTILS.i18n.init();var OSRouter=Backbone.Router.extend({rootView:undefined,tabs:new NavTabModels([{name:"Project",active:!1,url:"#nova"},{name:"Admin",active:!0,url:"#syspanel"}]),top:new TopBarModel({title:"Overview:",subtitle:""}),navs:new NavTabModels([]),next:undefined,loginModel:undefined,instancesModel:undefined,volumesModel:undefined,volumeSnapshotsModel:undefined,instanceSnapshotsModel:undefined,flavors:undefined,images:undefined,keypairsModel:undefined,projects:undefined,containers:undefined,vdcs:undefined,quotas:undefined,securityGroupsModel:undefined,floatingIPsModel:undefined,currentView:undefined,timers:[],routes:{"auth/login":"login","auth/switch/:id/":"switchTenant","auth/logout":"logout"},initialize:function(){this.loginModel=new LoginStatus,this.instancesModel=new Instances,this.volumesModel=new Volumes,this.volumeSnapshotsModel=new VolumeSnapshots,this.flavors=new Flavors,this.images=new Images,this.keypairsModel=new Keypairs,this.projects=new Projects,this.containers=new Containers,this.vdcs=new VDCs,this.quotas=new Quotas,this.securityGroupsModel=new SecurityGroups,this.floatingIPsModel=new FloatingIPs,Backbone.View.prototype.close=function(){this.unbind(),this.onClose&&this.onClose()},this.rootView=new RootView({model:this.loginModel,auth_el:"#auth",root_el:"#root"}),this.route("","init",this.wrap(this.init,this.checkAuth)),this.route("#","init",this.wrap(this.init,this.checkAuth)),this.route("syspanel","syspanel",this.wrap(this.sys_overview,this.checkAuth)),this.route("syspanel/","syspanel",this.wrap(this.sys_overview,this.checkAuth)),this.route("settings/","settings",this.wrap(this.showSettings,this.checkAuth)),this.route("nova","nova",this.wrap(this.nova_overview,this.checkAuth)),this.route("nova/","nova",this.wrap(this.nova_overview,this.checkAuth)),this.route("nova/volumes/","volumes",this.wrap(this.nova_volumes,this.checkAuth)),this.route("nova/access_and_security/","access_and_security",this.wrap(this.nova_access_and_security,this.checkAuth)),this.route("nova/access_and_security/keypairs/:name/download/","keypair_download",this.wrap(this.nova_keypair_download,this.checkAuth)),this.route("nova/images/","images",this.wrap(this.nova_images,this.checkAuth)),this.route("nova/snapshots/","snapshots",this.wrap(this.nova_snapshots,this.checkAuth)),this.route("nova/vdcs/","vdcs",this.wrap(this.nova_vdcs,this.checkAuth)),this.route("nova/vdcs/:id","vdc",this.wrap(this.nova_vdc,this.checkAuth)),this.route("nova/vdcs/:id/:idservice","vdcservice",this.wrap(this.nova_vdc_service,this.checkAuth)),this.route("nova/vdcs/:id/:idservice/:idinstance/?view=:subview","instance",this.wrap(this.nova_vdc_instance,this.checkAuth)),this.route("nova/vdcs/:id/:idservice/:idinstance","instance",this.wrap(this.nova_vdc_instance,this.checkAuth)),this.route("home/","home",this.wrap(this.init,this.checkAuth)),this.route("syspanel/images/images/","images",this.wrap(this.sys_images,this.checkAuth)),this.route("syspanel/instances/","instances",this.wrap(this.sys_instances,this.checkAuth)),this.route("syspanel/services/","services",this.wrap(this.sys_services,this.checkAuth)),this.route("syspanel/flavors/","flavors",this.wrap(this.sys_flavors,this.checkAuth)),this.route("syspanel/projects/","projects",this.wrap(this.sys_projects,this.checkAuth)),this.route("syspanel/users/","users",this.wrap(this.sys_users,this.checkAuth)),this.route("syspanel/quotas/","quotas",this.wrap(this.sys_quotas,this.checkAuth)),this.route("syspanel/flavors/create","create_flavor",this.wrap(this.create_flavor,this.checkAuth)),this.route("nova/images_and_snapshots/:id/delete","delete_image",this.wrap(this.delete_image,this.checkAuth)),this.route("nova/images_and_snapshots/:id/update","edit_image",this.wrap(this.edit_image,this.checkAuth)),this.route("nova/images_and_snapshots/:id","consult_image",this.wrap(this.consult_image,this.checkAuth)),this.route("nova/images_and_snapshots/:id/launch/","launch_image",this.wrap(this.launch_image,this.checkAuth)),this.route("nova/images_and_snapshots/:name/update","edit_image",this.wrap(this.edit_image,this.checkAuth)),this.route("nova/instances_and_volumes/instances/:id/detail?view=:subview","consult_instance",this.wrap(this.consult_instance,this.checkAuth)),this.route("nova/instances_and_volumes/instances/:id/detail","consult_instance",this.wrap(this.consult_instance,this.checkAuth)),this.route("nova/instances_and_volumes/volumes/:id/detail","consult_volume",this.wrap(this.consult_volume,this.checkAuth)),this.route("objectstorage/containers/","consult_containers",this.wrap(this.objectstorage_consult_containers,this.checkAuth)),this.route("objectstorage/containers/:name/","consult_container",this.wrap(this.objectstorage_consult_container,this.checkAuth))},wrap:function(e,t){var n=Array.prototype,r=n.slice;return function(){var n=[e].concat(r.call(arguments,0));return t.apply(this,n)}},checkAuth:function(){var e=arguments[0];this.rootView.options.next_view=Backbone.history.fragment;if(!this.loginModel.get("loggedIn")){console.log("Login needed"),window.location.href="#auth/login";return}this.timers.length===0&&(this.add_fetch(this.instancesModel,100),this.add_fetch(this.volumesModel,100),this.add_fetch(this.images,100),this.add_fetch(this.flavors,100),this.add_fetch(this.volumeSnapshotsModel,100),this.add_fetch(this.containers,100),this.add_fetch(this.vdcs,100),this.add_fetch(this.securityGroupsModel,100),this.add_fetch(this.keypairsModel,100),this.add_fetch(this.floatingIPsModel,100),this.loginModel.isAdmin()&&this.add_fetch(this.projects,100));var t=[this].concat(Array.prototype.slice.call(arguments,1));e.apply(this,t)},newContentView:function(e,t){e.currentView!==undefined&&e.currentView.close(),e.currentView=t},init:function(e){e.loginModel.isAdmin()?window.location.href="#syspanel":window.location.href="#nova"},login:function(){console.log("Rendering auth"),this.rootView.renderAuth()},logout:function(){this.loginModel.clearAll(),window.location.href="#auth/login"},switchTenant:function(e){this.loginModel.switchTenant(e),this.navigate(this.rootView.options.next_view,{trigger:!1,replace:!0})},showSettings:function(e){e.top.set({title:"Dashboard Settings"}),e.navs=new NavTabModels([{name:"User Settings",active:!0,url:"#settings/"}]),e.tabs.setActive(""),e.showRoot(e,"");var t=new SettingsView({el:"#content"});e.newContentView(e,t),t.render()},showRoot:function(e,t){e.rootView.renderRoot();var n=new NavTabView({el:"#navtab",model:e.tabs,loginModel:e.loginModel});n.render();var r=new TopBarView({el:"#topbar",model:e.top,loginModel:e.loginModel});r.render();var i=e.tabs.getActive()=="Project",s=new SideBarView({el:"#sidebar",model:e.navs,title:t,showTenants:i,loginModel:e.loginModel});s.render()},showSysRoot:function(e,t){return this.loginModel.isAdmin()?(e.top.set({title:t}),e.navs=new NavTabModels([{name:"Overview",active:!0,url:"#syspanel/"},{name:"Organizations",active:!1,url:"#syspanel/projects/"},{name:"Flavors",active:!1,url:"#syspanel/flavors/"},{name:"Users",active:!1,url:"#syspanel/users/"},{name:"Quotas",active:!1,url:"#syspanel/quotas/"}]),e.navs.setActive(t),e.tabs.setActive("Admin"),e.showRoot(e,"System Panel"),!0):(window.location.href="#nova",!1)},sys_overview:function(e){if(e.showSysRoot(e,"Overview")){var t=new Overview,n=new SysOverviewView({model:t,el:"#content"});e.newContentView(e,n),n.render()}},sys_images:function(e){if(e.showSysRoot(e,"Images")){var t=new ImagesView({model:e.images,el:"#content"});e.newContentView(e,t)}},delete_images:function(e){var t=new DeleteImagesView({model:e.images,el:"body"});t.render(),e.navigate("#syspanel/images/images/",{trigger:!1,replace:!0})},delete_image:function(e,t){var n=new ImageVM;n.set({id:t});var r=new DeleteImageView({model:n,el:"body"});r.render(),e.navigate("#syspanel/images/images/",{trigger:!1,replace:!0})},edit_image:function(e,t){var n=new ImageVM;n.set({id:t});var r=new UpdateImageView({model:n,el:"body"});e.navigate("#syspanel/images/images/",{trigger:!1,replace:!0})},consult_image:function(e,t){console.log("consult images"),e.showNovaRoot(e,"Images &amp; Snapshots");var n=new ImageVM;n.set({id:t});var r=new ConsultImageDetailView({model:n,el:"#content"});e.newContentView(e,r)},launch_image:function(e,t){var n=new ImageVM;n.set({id:t});var r=new LaunchImageView({model:n,flavors:e.flavors,keypairs:e.keypairsModel,el:"body"});e.navigate("#nova/images_and_snapshots/",{trigger:!1,replace:!0})},sys_instances:function(e){if(e.showSysRoot(e,"Instances")){e.instancesModel.unbind("change"),e.instancesModel.alltenants=!0;var t=new InstanceView({model:e.instancesModel,projects:e.projects,flavors:e.flavors,el:"#content"});e.newContentView(e,t)}},sys_services:function(e){if(e.showSysRoot(e,"Services")){var t=new Services,n=new ServiceView({model:t,el:"#content"});e.newContentView(e,n),n.render()}},sys_flavors:function(e){if(e.showSysRoot(e,"Flavors")){e.flavors.unbind("change");var t=new FlavorView({model:e.flavors,el:"#content"});e.newContentView(e,t)}},create_flavor:function(e){var t=new Flavor,n=new CreateFlavorView({model:t,el:"body"});n.render(),e.navigate("#syspanel/flavors/",{trigger:!1,replace:!0})},sys_projects:function(e){if(e.showSysRoot(e,"Organizations")){var t=new ProjectView({model:e.projects,el:"#content"});e.newContentView(e,t)}},sys_users:function(e){if(e.showSysRoot(e,"Users")){var t=new Users,n=new UserView({model:t,el:"#content"});e.newContentView(e,n),n.render()}},sys_quotas:function(e){if(e.showSysRoot(e,"Quotas")){var t=new QuotaView({model:e.quotas,el:"#content"});e.newContentView(e,t),t.render()}},showNovaRoot:function(e,t){e.top.set({title:t}),e.navs=new NavTabModels([{name:"Compute",type:"title"},{name:"Overview",active:!0,url:"#nova/"},{name:"Virtual Data Centers",active:!1,url:"#nova/vdcs/"},{name:"Images",active:!1,url:"#nova/images/"},{name:"Volumes",active:!1,url:"#nova/volumes/"},{name:"Access &amp; Security",active:!1,url:"#nova/access_and_security/"},{name:"Snapshots",active:!1,url:"#nova/snapshots/"},{name:"Storage",type:"title"},{name:"Containers",active:!1,url:"#objectstorage/containers/"}]),e.navs.setActive(t),e.tabs.setActive("Project"),e.showRoot(e,"Organization")},nova_overview:function(e){e.showNovaRoot(e,"Overview");var t=new NovaOverviewView({el:"#content"});e.newContentView(e,t),t.render()},nova_access_and_security:function(e){e.showNovaRoot(e,"Access &amp; Security");var t=new AccessAndSecurityView({el:"#content",model:e.keypairsModel,floatingIPsModel:e.floatingIPsModel,securityGroupsModel:e.securityGroupsModel});e.newContentView(e,t)},nova_keypair_download:function(e,t){e.showNovaRoot(e,"Download Keypair");var n=new Keypair;n.set({name:t});var r=new DownloadKeypairView({el:"#content",model:n});e.newContentView(e,r),r.render()},nova_images:function(e){e.showNovaRoot(e,"Images");var t=new ImagesView({model:e.images,volumeSnapshotsModel:e.volumeSnapshotsModel,instancesModel:e.instancesModel,volumesModel:e.volumesModel,flavors:e.flavors,keypairs:e.keypairsModel,el:"#content"});e.newContentView(e,t)},nova_snapshots:function(e){e.showNovaRoot(e,"Snapshots");var t=new NovaSnapshotsView({images:e.images,volumeSnapshotsModel:e.volumeSnapshotsModel,instancesModel:e.instancesModel,volumesModel:e.volumesModel,flavors:e.flavors,keypairs:e.keypairsModel,el:"#content"});e.newContentView(e,t)},nova_vdcs:function(e){e.showNovaRoot(e,"Virtual Data Centers");var t=new VDCsView({model:e.vdcs,el:"#content"});e.newContentView(e,t)},nova_vdc:function(e,t){e.showNovaRoot(e,"Virtual Data Centers");var n=new VDCServices({vdc:t}),r=new VDCView({model:n,vdc:t,el:"#content",flavors:e.flavors,images:e.images,keypairs:e.keypairsModel});e.newContentView(e,r)},nova_vdc_service:function(e,t,n){e.showNovaRoot(e,"Virtual Data Centers");var r=new VDCService({id:n}),i=new VDCServiceView({model:r,flavors:e.flavors,vdc:t,el:"#content"});e.newContentView(e,i)},nova_vdc_instance:function(e,t,n,r,i,s){e.showNovaRoot(e,"Virtual Data Centers");var o=new Instance;o.set({id:r}),i=i||"overview";var u=new InstanceDetailView({model:o,subview:i,subsubview:s,vdc:t,service:n,el:"#content"});e.newContentView(e,u)},nova_volumes:function(e){e.showNovaRoot(e,"Volumes");var t=new NovaVolumesView({model:e.volumesModel,volumeSnapshotsModel:e.volumeSnapshotModel,instancesModel:e.instancesModel,flavors:e.flavors,el:"#content"});e.newContentView(e,t)},objectstorage_consult_containers:function(e){e.showNovaRoot(e,"Containers"),e.containers.unbind("change"),console.log();var t=new ObjectStorageContainersView({model:e.containers,el:"#content"});e.newContentView(e,t)},objectstorage_consult_container:function(e,t){e.showNovaRoot(e,"Containers");var n=new Container;n.set({name:t});var r=new ObjectStorageContainerView({model:n,containers:e.containers,el:"#content"});e.newContentView(e,r)},consult_volume:function(e,t){e.showNovaRoot(e,"Volumes");var n=new Volume;n.set({id:t});var r=new VolumeDetailView({model:n,el:"#content"});e.newContentView(e,r)},clear_fetch:function(){var e=this;for(var t in this.timers){var n=this.timers[t];clearInterval(n)}this.timers=[]},add_fetch:function(e,t){e.fetch();var n=setInterval(function(){e.fetch()},t*1e3);this.timers.push(n)}}),AllocateIPView=Backbone.View.extend({_template:_.itemplate($("#allocateIPFormTemplate").html()),events:{"click #cancelCreateBtn":"close","click #close":"close","click #createBtn":"create","click .modal-backdrop":"close"},render:function(){return $(this.el).append(this._template({model:this.model})),$(".modal:last").modal(),this},close:function(e){$("#create_keypair").remove(),$(".modal-backdrop").remove(),this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()},create:function(e){self=this;var t=$("input[name=name]").val(),n;for(var r in self.model.models)if(self.model.models[r].attributes.name===t){n=new MessagesView({el:"#content",state:"Error",title:"Keypair "+t+" already exists. Please try again."}),n.render();return}var i=new Keypair;i.set({name:t}),mySuccess=function(e){var t=e.keypair.private_key,n,r;n=new Blob([t],{type:"application/x-pem-file"}),r=window.URL.createObjectURL(n),window.open(r)},JSTACK.Nova.createkeypair(t,undefined,mySuccess),window.location.href="#nova/access_and_security/keypairs/"+t+"/download/",n=new MessagesView({el:"#content",state:"Success",title:"Keypair "+t+" created."}),n.render(),self.close()}}),ChangePasswordView=Backbone.View.extend({_template:_.itemplate($("#changePasswordFormTemplate").html()),events:{"click #cancelBtn":"close","click #close":"close","click #updateBtn":"update","click .modal-backdrop":"close"},initialize:function(){},onClose:function(){this.undelegateEvents(),this.unbind()},render:function(){if($("#change_password").html()!=null)return;return $(this.el).append(this._template({model:this.model})),$(".modal:last").modal(),this},close:function(e){this.model.unbind("change",this.render,this),$("#change_password").remove(),$(".modal-backdrop").remove(),this.onClose()},update:function(e){var t=$("input[name=instance_password]").val();this.model.changepassword(t);var n=new MessagesView({el:"#content",state:"Success",title:"Password changed."});n.render(),this.close()}}),ConfirmView=Backbone.View.extend({_template:_.itemplate($("#confirmTemplate").html()),initialize:function(){this.delegateEvents({"click #confirm_btn":"onAccept","click #cancelBtn":"close","click #closeModalConfirm":"close","click .modal-backdrop":"close"}),this.options.title=this.options.title||"Are you sure?",this.options.message=this.options.message||"Please confirm your selection. This action cannot be undone.",this.options.btn_message=this.options.btn_message||"Confirm"},onClose:function(){this.options.style===""&&this.options.style===undefined&&(this.undelegateEvents(),this.unbind())},render:function(){return $("#confirm").html()!=null&&($("#confirm").remove(),$(".modal-backdrop").remove()),$(this.el).append(this._template({title:this.options.title,message:this.options.message,btn_message:this.options.btn_message,style:this.options.style})),this.options.style!==""&&this.options.style!==undefined?($(".modal:last").modal(),$(".modal-backdrop:last").css("z-index","105010")):$(".modal:last").modal(),this},onAccept:function(e){this.options.onAccept(),this.close()},close:function(e){$("#confirm").remove(),this.options.style===""&&this.options.style===undefined&&(this.undelegateEvents(),$(".modal-backdrop").remove(),this.onClose())}}),ConsultImageDetailView=Backbone.View.extend({_template:_.itemplate($("#consultImageDetailFormTemplate").html()),initialize:function(){this.model.bind("change",this.render,this),this.model.fetch()},render:function(){return $("#instance_details").html()==null?UTILS.Render.animateRender(this.el,this._template,{model:this.model}):$(this.el).html(this._template({model:this.model})),this}}),CopyObjectView=Backbone.View.extend({_template:_.itemplate($("#copyObjectFormTemplate").html()),events:{"click #submit":"onSubmit","click #cancelBtn":"close","click #close":"close","click .modal-backdrop":"close"},close:function(e){$("#create_container").remove(),$(".modal-backdrop").remove(),this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()},render:function(){return $("#create_container").html()!=null&&($("#create_container").remove(),$(".modal-backdrop").remove()),$(this.el).append(this._template({title:this.options.title,container:this.containerName,model:this.options})),$(".modal:last").modal(),this},onSubmit:function(e){e.preventDefault();var t=this,n,r,i,s,o;if(this.$("input[name=objName]").val()===undefined){o=new MessagesView({el:"#content",state:"Error",title:"Wrong input values for container. Please try again."}),o.render();return}n=this.model.get("name"),r=this.options.title,i=this.$("#container_switcher option:selected").val(),e.target.value===undefined||e.target.value===""?s=this.$("input[name=objName]").val():s=e.target.value,o=new MessagesView({el:"#content",state:"Success",title:"Object "+s+" copied to conatainer "+i}),o.render(),t.model.copyObject(n,r,i,s)}}),CreateContainerView=Backbone.View.extend({_template:_.itemplate($("#createContainerFormTemplate").html()),events:{"click #submit":"onSubmit","click #cancelBtn":"close","click #close":"close","click .modal-backdrop":"close"},close:function(e){$("#create_container").remove(),$(".modal-backdrop").remove(),this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()},render:function(){return $("#create_container").html()!=null&&($("#create_container").remove(),$(".modal-backdrop").remove()),$(this.el).append(this._template({model:this.model})),$(".modal:last").modal(),this},onSubmit:function(e){e.preventDefault();var t,n;if(this.$("input[name=name]").val()===""||this.$("input[name=name]").val()===undefined){t=new MessagesView({el:"#content",state:"Error",title:"Wrong input values for container. Please try again."}),t.render(),this.close();return}for(n in this.model.models)if(this.$("input[name=name]").val()===this.model.models[n].get("id")){t=new MessagesView({el:"#content",state:"Error",title:"Container with the same name already exists."}),t.render(),this.close();return}var r=new Container;r.set({name:this.$("input[name=name]").val()}),r.save(),t=new MessagesView({el:"#content",state:"Success",title:"Container "+r.get("name")+" created."}),t.render(),this.close(),this.close()}}),CreateFlavorView=Backbone.View.extend({_template:_.itemplate($("#createFlavorFormTemplate").html()),events:{"click #submit":"onSubmit","click #cancelBtn":"close","click #close":"close"},initialize:function(){this.model.bind("change",this.render,this)},close:function(e){this.model.unbind("change",this.render,this),$("#create_flavor").remove(),$(".modal-backdrop").remove(),this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()},render:function(){for(var e=0;e<this.model.length;e++);return $("#create_flavor").html()!=null&&($("#create_flavor").remove(),$(".modal-backdrop").remove()),$(this.el).append(this._template({model:this.model})),$(".modal:last").modal(),this},onSubmit:function(e){e.preventDefault();var t;if(this.$("input[name=flavor_id]").val()===""||this.$("input[name=name]").val()===""||this.$("input[name=vcpus]").val()===""||this.$("input[name=memory_mb]").val()===""||this.$("input[name=disk_gb]").val()===""||this.$("input[name=eph_gb]").val()===""||this.$("input[name=flavor_id]").val()<=0||this.$("input[name=vcpus]").val()<=0||this.$("input[name=memory_mb]").val()<=0||this.$("input[name=disk_gb]").val()<=0||this.$("input[name=eph_gb]").val()<=0||this.$("input[name=flavor_id]").val()%1!==0||this.$("input[name=vcpus]").val()%1!==0||this.$("input[name=memory_mb]").val()%1!==0||this.$("input[name=disk_gb]").val()%1!==0||this.$("input[name=eph_gb]").val()%1!==0)console.log($("input[name=flavor_id]")),console.log($("input[name=name]")),console.log($("input[name=vcpus]")),console.log($("input[name=memory_mb]")),console.log($("input[name=disk_gb]")),console.log($("input[name=eph_gb]")),t=new MessagesView({el:"#content",state:"Error",title:"Wrong input values for flavor. Please try again."}),t.render();else{var n=new Flavor;n.set({flavor_id:this.$("input[name=flavor_id]").val()}),n.set({name:this.$("input[name=name]").val()}),n.set({vcpus:this.$("input[name=vcpus]").val()}),n.set({memory_mb:this.$("input[name=memory_mb]").val()}),n.set({disk_gb:this.$("input[name=disk_gb]").val()}),n.set({eph_gb:this.$("input[name=eph_gb]").val()}),n.save(),t=new MessagesView({el:"#content",state:"Success",title:"Flavor "+n.get("name")+" created."}),t.render()}this.close()}}),CreateKeypairView=Backbone.View.extend({_template:_.itemplate($("#createKeypairFormTemplate").html()),events:{"click #cancelCreateBtn":"close","click #close":"close","click #createBtn":"create","click .modal-backdrop":"close","click #name":"showTooltipName"},render:function(){return $(this.el).append(this._template({model:this.model})),$(".modal:last").modal(),$(".createKeypair").attr("download",".pem"),this},close:function(e){$("#create_keypair").remove(),$(".modal-backdrop").remove(),this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()},showTooltipName:function(){$("#name").tooltip("show")},create:function(e){e.preventDefault(),self=this;var t=/^[a-z0-9_\-]{1,87}$/,n=$("input[name=name]").val(),r,i;r=t.test(n)?!0:!1;if(r){for(var s in self.model.models)if(self.model.models[s].attributes.name===n){i=new MessagesView({el:"#content",state:"Error",title:"Keypair "+n+" already exists. Please try again."}),i.render();return}window.location.href="#nova/access_and_security/keypairs/"+n+"/download/"}else i=new MessagesView({el:"#content",state:"Error",title:"Wrong values for Keypair. Please try again."}),i.render();self.close()}}),CreateSecurityGroupView=Backbone.View.extend({_template:_.itemplate($("#createSecurityGroupFormTemplate").html()),events:{"click #cancelBtn":"close","click #close":"close","click #createBtn":"createSecurityGroup","click .modal-backdrop":"close","click #name":"showTooltipName"},render:function(){return $(this.el).append(this._template({securityGroupsModel:this.options.securityGroupsModel})),$(".modal:last").modal(),this},close:function(e){this.options.securityGroupsModel.unbind("change",this.render,this),$("#create_security_group").remove(),$(".modal-backdrop").remove(),this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()},showTooltipName:function(){$("#name").tooltip("show")},createSecurityGroup:function(e){e.preventDefault(),self=this;var t=/^[a-z0-9_\-]{1,87}$/,n=$("input[name=name]").val(),r=$("input[name=description]").val(),i,s,o;i=t.test(n)?!0:!1,s=r!==""&&r!==undefined?!0:!1,console.log(i),console.log(s);if(i&&s){for(var u in self.options.securityGroupsModel.models)if(self.options.securityGroupsModel.models[u].attributes.name===n){o=new MessagesView({el:"#content",state:"Error",title:"Security Group "+n+" already exists. Please try again."}),o.render();return}var a=new SecurityGroup;a.set({name:n,description:r}),a.save(),o=new MessagesView({el:"#content",state:"Success",title:"Security group "+n+" created."}),o.render()}else o=new MessagesView({el:"#content",state:"Error",title:"Wrong values for Security Group. Please try again."}),o.render();self.close()}}),CreateSnapshotView=Backbone.View.extend({_template:_.itemplate($("#createSnapshotFormTemplate").html()),events:{"click #cancelBtn":"close","click #close":"close","click #updateBtn":"update","click .modal-backdrop":"close"},initialize:function(){},render:function(){if($("#create_snapshot").html()!=null)return;return $(this.el).append(this._template({model:this.model})),$(".modal:last").modal(),this},close:function(e){this.model.unbind("change",this.render,this),$("#create_snapshot").remove(),$(".modal-backdrop").remove()},update:function(e){var t=$("input[name=snapshot_name]").val();this.model.createsnapshot(t);var n=new MessagesView({el:"#content",state:"Success",title:"Snapshot "+t+" created."});n.render(),this.close()}}),CreateVDCServiceView=Backbone.View.extend({_template:_.itemplate($("#createVDCServiceFormTemplate").html()),instances:new Instances,events:{"click #submit":"onSubmit","click #cancelBtn":"close","click #close-service":"close","click .modal-backdrop":"close","click #addInstance":"addInstance"},initialize:function(){this.instances=new Instances,console.log(this.instances)},addInstance:function(){var e=this;console.log("Showing Instance Creation");var t=new LaunchImageView({el:"body",model:{},images:this.options.images,flavors:this.options.flavors,keypairs:this.options.keypairs,addInstance:function(t){e.instances.add(t),e.renderSecond()}});t.render()},close:function(e,t){e.preventDefault(),console.log("Removing Create VDC"),$("#create_service").remove(),$(".modal-backdrop").remove(),this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()},renderSecond:function(){$("#create_service").remove(),$(this.el).append(this._template({instances:this.instances,flavors:this.options.flavors}))},render:function(){return $("#create_service").html()!==null&&($("#create_service").remove(),$(".modal-backdrop").remove()),$(this.el).append(this._template({instances:this.instances,flavors:this.options.flavors})),$("#create_service").modal(),this},onSubmit:function(e){var t;e.preventDefault(),this.close();if(this.$("input[name=name]").val()===""){t=new MessagesView({el:"#content",state:"Error",title:"Wrong input values for service. Please try again."}),t.render();return}var n=new VDCService;n.set({name:this.$("input[name=name]").val()}),t=new MessagesView({el:"#content",state:"Success",title:"Service "+n.get("name")+" created."}),t.render()}}),CreateVolumeSnapshotView=Backbone.View.extend({_template:_.itemplate($("#createVolumeSnapshotFormTemplate").html()),events:{"click #cancelBtn":"close","click #close":"close","click #createBtn":"create","click .modal-backdrop":"close"},onClose:function(){this.undelegateEvents(),this.unbind()},initialize:function(){},render:function(){if($("#create_volume_modal").html()!=null)return;return $(this.el).append(this._template()),$(".modal:last").modal(),this},close:function(e){$("#create_volume_snapshot_modal").remove(),$(".modal-backdrop").remove(),this.onClose()},create:function(e){var t=$("input[name=name]").val(),n=$("textarea[name=description]").val(),r=new VolumeSnapshot;r.set({volume_id:this.model.id,name:t,description:n}),r.save();var i=new MessagesView({el:"#content",state:"Success",title:"Volume snapshot "+t+" created."});i.render(),this.close()}}),CreateVolumeView=Backbone.View.extend({_template:_.itemplate($("#createVolumeFormTemplate").html()),events:{"click #cancelBtn":"close","click #close":"close","click #createBtn":"create","click .modal-backdrop":"close"},onClose:function(){this.undelegateEvents(),this.unbind()},initialize:function(){},render:function(){if($("#create_volume_modal").html()!=null)return;return $(this.el).append(this._template()),$(".modal:last").modal(),this},close:function(e){$("#create_volume_modal").remove(),$(".modal-backdrop").remove(),this.onClose()},create:function(e){var t=$("input[name=name]").val(),n=$("textarea[name=description]").val(),r=$("input[name=size]").val();this.model=new Volume,this.model.set({name:t,description:n,size:r}),this.model.save();var i=new MessagesView({el:"#content",state:"Success",title:"Volume "+t+" created."});i.render(),this.close()}}),DownloadKeypairView=Backbone.View.extend({_template:_.itemplate($("#downloadKeypairFormTemplate").html()),initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.render,this)},events:{"click #cancelCreateBtn":"close","click #close":"close"},render:function(){return $(this.el).append(this._template({model:this.model})),$(".modal:last").modal(),this.createKeypair(),this},createKeypair:function(e){var t=this.model.attributes.name,n=function(e){var n=e.keypair.private_key;console.log(e.keypair.public_key);var r,i;r=new Blob([n],{type:"application/x-pem-file"}),i=window.URL.createObjectURL(r),window.open(i,"Save Keypair","width=0,height=0"),$(".downloadKeypair").append("Download Keypair"),$(".downloadKeypair").attr("href",i),$(".downloadKeypair").attr("download",t+".pem");var s=new MessagesView({el:"#content",state:"Success",title:"Keypair "+t+" created."});s.render()};JSTACK.Nova.createkeypair(t,undefined,n)},close:function(e){this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()}}),EditSecurityGroupRulesView=Backbone.View.extend({_template:_.itemplate($("#editSecurityGroupRulesFormTemplate").html()),events:{"click #closeModal":"close","click #deleteRuleBtn":"deleteRule","click #deleteRulesBtn":"deleteRules","click .close":"close","click #createRuleBtn":"createRule","click .modal-backdrop":"close","click #from_port":"showTooltipFromPort","click #to_port":"showTooltipToPort","click #cidr":"showTooltipCidr","change .secGroupSelect":"dissapearCIDR","change .IPProtocolSelect":"changeInputs","change .checkbox_sec_group_rule":"enableDisableDeleteButton"},render:function(){return $(this.el).append(this._template({securityGroupsModel:this.options.securityGroupsModel})),$(".modal:last").modal(),this},close:function(e){$("#edit_security_group_rule").remove(),this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()},showTooltipFromPort:function(){$("#from_port").tooltip("show")},showTooltipToPort:function(){$("#to_port").tooltip("show")},showTooltipCidr:function(){$("#cidr").tooltip("show")},dissapearCIDR:function(e){$(".secGroupSelect :selected").val()!=="CIDR"?$(".cidrSelect").hide():$(".cidrSelect:hidden")&&$(".cidrSelect").show()},changeInputs:function(e){$(".IPProtocolSelect :selected").val()=="ICMP"?($("label[for='from_port']").text("Type"),$("label[for='to_port']").text("Code")):($("label[for='from_port']").text("From Port"),$("label[for='to_port']").text("To Port"))},deleteRule:function(e){self=this;var t=e.target.value,n;for(var r in this.options.securityGroupsModel.securityGroup.attributes.rules)if(this.options.securityGroupsModel.securityGroup.attributes.rules[r].id==e.target.value){var i=this.options.securityGroupsModel.securityGroup.attributes.rules[r];n=i}var s=new ConfirmView({el:"body",title:"Delete Security Group Rule",btn_message:"Delete Security Group Rule",style:"top: 80px; display: block; z-index: 10501010;",onAccept:function(){self.options.securityGroupsModel.securityGroup.deleteSecurityGroupRule(t);var e=new MessagesView({el:"#content",state:"Success",title:"Security Group Rule deleted."});e.render()}});s.render()},deleteRules:function(e){var t=this,n=new ConfirmView({el:"body",title:"Delete Security Group Rules",btn_message:"Delete Security Group Rules",style:"top: 80px; display: block; z-index: 10501010;",onAccept:function(){$(".checkbox_sec_group_rule:checked").each(function(){var e=$(this).val();for(var n in t.options.securityGroupsModel.securityGroup.attributes.rules)if(t.options.securityGroupsModel.securityGroup.attributes.rules[n].id==e)var r=t.options.securityGroupsModel.securityGroup.attributes.rules[n];var i=new MessagesView({el:"#content",state:"Success",title:"Security Group Rules deleted."});t.options.securityGroupsModel.securityGroup.deleteSecurityGroupRule(e),i.render()})}});n.render()},createRule:function(e){e.preventDefault(),self=this;var t,n,r,i=/^([0-255]){1,3}(\.){1}([0-255]){1,3}(\.){1}([0-255]){1,3}(\.){1}([0-255]){1,3}(\/){1}([0-24]){1,2}$/,s=/^([1-65535]){1,5}$/,o=/^([\-1-255]){1,3}$/,u=e.target.value,a=$(".IPProtocolSelect :selected").val(),f=$("input[name=fromPort]").val(),l=$("input[name=toPort]").val(),c=$(".secGroupSelect :selected").val(),h=$("input[name=cidr]").val(),p;t=i.test(h)?!0:!1,n=s.test(f)?!0:!1,r=s.test(l)?!0:!1,console.log("ipProtocol "+a),console.log("fromPort "+f),console.log("toPort "+l),console.log("cidr "+h),console.log("securityGroupId "+c),console.log("parentGroupId "+u),t&&n&&r?($(".secGroupSelect :selected").val()!=="CIDR"?self.options.securityGroupsModel.securityGroup.createSecurityGroupRule(a,f,l,"",c,u):self.options.securityGroupsModel.securityGroup.createSecurityGroupRule(a,f,l,h,undefined,u),p=new MessagesView({el:"#content",state:"Success",title:"Security group rule created."}),p.render()):(p=new MessagesView({el:"#content",state:"Error",title:"Wrong input values for Security Group Rule. Please try again."}),p.render()),this.close()},enableDisableDeleteButton:function(e){$(".checkbox_sec_group_rule:checked").size()>0?$("#deleteRulesBtn").attr("disabled",!1):$("#deleteRulesBtn").attr("disabled",!0)}}),EditVolumeAttachmentsView=Backbone.View.extend({_template:_.itemplate($("#editVolumeAttachmentsFormTemplate").html()),events:{"click .cancelBtn":"close","click .close":"close","click .attachBtn":"attach","click .detachBtn":"detach","click .checkbox_attachments":"enableDisableDettachButton","click .modal-backdrop":"close","click #attachments__action_detach":"detachGroup"},onClose:function(){this.undelegateEvents(),this.unbind()},initialize:function(){},render:function(){if($("#create_volume_modal").html()!=null)return;return $(this.el).append(this._template({model:this.model,instancesModel:this.options.instances})),$(".modal:last").modal(),this},close:function(e){$("#attach_volume_modal").remove(),$(".modal-backdrop").remove(),this.onClose()},detach:function(e){var t=e.target.value;console.log("Detaching "+t);var n=new ConfirmView({el:"body",title:"Detach Volume",btn_message:"Detach Volume",style:"top: 80px; display: block; z-index: 10501010;",onAccept:function(){this.options.instances.get(t).detachvolume({volume_id:this.model.id});var e=new MessagesView({el:"#content",state:"Success",title:"Volume "+name+" detached."});e.render()}});n.render()},attach:function(e){var t=$("select[id=id_instance]").val(),n=$("input[name=device]").val();this.options.instances.get(t).attachvolume({volume_id:this.model.id,device:n});var r=new MessagesView({el:"#content",state:"Success",title:"Volume "+name+" attached."});r.render(),this.close()},detachGroup:function(e){var t=this,n=$(".checkbox_attachments:checked");this.close();var r=new ConfirmView({el:"body",title:"Detach Volumes",btn_message:"Detach Volumes",style:"top: 80px; display: block; z-index: 10501010;",onAccept:function(){n.each(function(){var e=$(this).val(),n=t.options.instances.get(e);t.options.instances.get(e).detachvolume({volume_id:t.model.id});var r=new MessagesView({el:"#content",state:"Success",title:"Volumes "+n.get("name")+" detached."});r.render()})}});r.render()},enableDisableDettachButton:function(){$(".checkbox_attachments:checked").size()>0?$("#attachments__action_detach").attr("disabled",!1):$("#attachments__action_detach").attr("disabled",!0)}}),ImportKeypairView=Backbone.View.extend({_template:_.itemplate($("#importKeypairFormTemplate").html()),events:{"click #cancelImportBtn":"close","click #close":"close","click #importBtn":"importKeypair","click .modal-backdrop":"close"},render:function(){return $(this.el).append(this._template({model:this.model})),$(".modal:last").modal(),this},close:function(e){$("#import_keypair").remove(),$(".modal-backdrop").remove(),this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()},importKeypair:function(e){self=this;var t=$("input[name=name]").val(),n=$("input[name=public_key]").val(),r=new Keypair,i;for(var s in self.model.models)if(self.model.models[s].attributes.name===t){i=new MessagesView({el:"#content",state:"Error",title:"Keypair "+t+" already exists. Please try again."}),i.render();return}r.set({name:t,public_key:n}),r.save(),i=new MessagesView({el:"#content",state:"Success",title:"Keypair "+t+" imported."}),i.render(),this.close()}}),LaunchImageView=Backbone.View.extend({_template:_.itemplate($("#launchImageTemplate").html()),events:{"click #cancelBtn-image":"close","click #close-image":"close","click .modal-backdrop":"close","click .btn-launch-image":"launch"},initialize:function(){this.options.keypairs.fetch()},render:function(){var e=this.options.flavors;if($("#launch_image").html()!=null)return;return $(this.el).append(this._template({model:this.model.models,flavors:e,keypairs:this.options.keypairs})),$("#launch_image").modal(),this},onClose:function(){this.undelegateEvents(),this.unbind()},close:function(e){e!==undefined&&e.preventDefault(),console.log("Removing launch image"),$("#launch_image").remove(),$(".modal-backdrop:last").remove(),this.onClose(),this.model.unbond!==undefined&&this.model.unbind("reset",this.render,this)},launch:function(e){var t=new Instance,n=$("input[name=instance_name]").val(),r=this.model.id,i,s,o,u;$("#id_flavor option:selected").each(function(){var e=$(this).val();e!==""&&(i=e)}),$("#id_keypair option:selected").each(function(){var e=$(this).val();e!==""&&(s=e)});var a=$("textarea[name=user_data]").val(),f=$("input[name=count]").val(),l=$("input[name=count]").val();t.set({name:n}),t.set({imageReg:r}),t.set({flavorReg:i}),t.set({key_name:s}),t.set({user_data:a}),t.set({security_groups:o}),t.set({min_count:f}),t.set({max_count:l}),t.set({availability_zone:u}),t.save(),this.close()}}),LaunchVDCView=Backbone.View.extend({_template:_.itemplate($("#launchVDCTemplate").html()),events:{"click #cancelBtn":"close","click #close":"close","click .modal-backdrop":"close","click .btn-accept":"launch","click #myTab a":"show","click .btn-next":"showNext","click .btn-prev":"showPrevious"},initialize:function(){},showPrevious:function(){this.showTab($($("#myTab li[class=active]").prev("#myTab li").children()[0]))},showNext:function(){this.showTab($($("#myTab li[class=active]").next("#myTab li").children()[0]))},show:function(e){e.preventDefault(),this.showTab($(e.target))},showTab:function(e){e.tab("show"),$("#myTab li[class=active]").html()===$("#myTab li:last").html()?$(".btn-next").hide():$(".btn-next").show(),$("#myTab li[class=active]").html()===$("#myTab li:first").html()?$(".btn-prev").hide():$(".btn-prev").show()},render:function(){if($("#launch_vdc").html()!=null)return;return $(this.el).append(this._template({})),$(".btn-prev").hide(),$(".modal:last").modal(),this},onClose:function(){this.undelegateEvents(),this.unbind()},close:function(e){$("#launch_vdc").remove(),$(".modal-backdrop").remove(),this.onClose()},launch:function(e){var t=new VDC;t.save();var n=new MessagesView({el:"#content",state:"Success",title:"Virtual Data Center "+t.get("name")+" launched."});n.render(),this.close()}}),MessagesView=Backbone.View.extend({_template:_.template($("#messagesTemplate").html()),initialize:function(){this.options.state=this.options.state||"Success"},close:function(){$(".messages").remove()},render:function(){var e=this;return $(this.el).before(this._template({title:this.options.title,state:this.options.state})),$(".messages").fadeOut(4e3,function(){e.close()}),this}}),UpdateImageView=Backbone.View.extend({_template:_.itemplate($("#updateImageFormTemplate").html()),initialize:function(){this.model.bind("change",this.render,this),this.model.fetch()},events:{"click #image_update":"onUpdateImage","click #cancelBtn":"close","click #close":"close","click .modal-backdrop":"close"},render:function(){return $("#update_image").html()!=null&&($("#update_image").remove(),$(".modal-backdrop").remove()),$(this.el).append(this._template({model:this.model})),$(".modal:last").modal(),this},onUpdateImage:function(e){e.preventDefault(),this.model.set({name:this.$("input[name=name]").val()}),this.model.save();var t=new MessagesView({el:"#content",state:"Success",title:"Image "+this.model.get("name")+" updated."});t.render(),this.close(),$("#update_image").remove(),$(".modal-backdrop").remove()},close:function(e){this.model.unbind("change",this.render,this),$("#update_image").remove(),$(".modal-backdrop").remove(),this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()}}),UpdateInstanceView=Backbone.View.extend({_template:_.itemplate($("#updateInstanceFormTemplate").html()),events:{"click #cancelBtn":"close","click #close":"close","click #updateBtn":"update","click .modal-backdrop":"close"},initialize:function(){this.model.bind("change",this.render,this),this.model.fetch()},onClose:function(){this.undelegateEvents(),this.unbind()},render:function(){if($("#update_instance").html()!=null)return;return $(this.el).append(this._template({model:this.model})),$(".modal:last").modal(),this},close:function(e){this.model.unbind("change",this.render,this),$("#update_instance").remove(),$(".modal-backdrop").remove(),this.onClose()},update:function(e){this.model.set({name:this.$("input[name=name]").val()});var t=$("input[name=name]").val();this.model.save();var n=new MessagesView({el:"#content",state:"Success",title:"Instance "+t+" updated."});n.render(),this.close()}}),UploadObjectView=Backbone.View.extend({_template:_.itemplate($("#uploadObjectFormTemplate").html()),events:{"click #submit":"onSubmit","click #cancelBtn":"close","click #close":"close","click .modal-backdrop":"close"},close:function(e){$("#upload_object").remove(),$(".modal-backdrop").remove(),this.onClose()},onClose:function(){this.undelegateEvents(),this.unbind()},render:function(){return $("#upload_object").html()!=null&&($("#upload_object").remove(),$(".modal-backdrop").remove()),$(this.el).append(this._template({model:this.model})),$(".modal:last").modal(),this},onSubmit:function(e){e.preventDefault();var t=this,n,r,i,s;if(this.$("input[name=objName]").val()===""){s=new MessagesView({el:"#content",state:"Error",title:"Wrong input values for container. Please try again."}),s.render(),this.close();return}n=t.model.get("name"),r=t.$("input[name=objName]").val(),i=document.getElementById("id_object_file").files[0],t.model.uploadObject(n,r,i),s=new MessagesView({el:"#content",state:"Success",title:"Object "+r+" uploaded."}),s.render(),this.close()}}),LoginView=Backbone.View.extend({_template:_.itemplate($("#not_logged_in").html()),initialize:function(){console.log("Init Login view"),this.model.bind("change:loggedIn",this.onLogin,this),this.model.bind("auth-error",this.renderonerror,this),this.model.bind("auth-needed",this.render,this),this.onLogin()},events:{"click #home_loginbtn":"onCredentialsSubmit","click .close":"onCloseErrorMsg"},onCredentialsSubmit:function(e){e.preventDefault(),this.model.setCredentials(this.$("input[name=username]").val(),this.$("input[name=password]").val())},onCloseErrorMsg:function(e){this.model.set({error_msg:null}),this.renderonerror()},onLogin:function(){console.log("Checking"),this.model.get("loggedIn")&&(this.options.next_view!==undefined?window.location.href="#"+this.options.next_view:window.location.href="#syspanel")},render:function(){console.log("Rendering login");var e=this;return $(this.el).fadeOut("slow",function(){$("#root").css("display","none"),$(e.el).empty().html(e._template(e.model)),$(e.el).fadeIn("slow")}),this},renderonerror:function(){return $("#root").css("display","none"),$(this.el).empty().html(this._template(this.model)),this}}),NavTabView=Backbone.View.extend({_template:_.itemplate($("#navTabTemplate").html()),initialize:function(){this.model.bind("change:actives",this.render,this)},render:function(){var e=this;return $(e.el).empty().html(e._template({models:e.model.models,showAdmin:this.options.loginModel.isAdmin(),tenants:this.options.tenants,tenant:this.options.tenant})),this}}),AccessAndSecurityView=Backbone.View.extend({_template:_.itemplate($("#novaAccessAndSecurityTemplate").html()),keypairsView:undefined,securityGroupsView:undefined,floatingIPsView:undefined,initialize:function(){this.render(),this.floatingIPsView=new NovaFloatingIPsView({floatingIPsModel:this.options.floatingIPsModel,el:"#floating_ips"}),this.secuirtyGroupsView=new NovaSecurityGroupsView({securityGroupsModel:this.options.securityGroupsModel,el:"#security_groups"}),this.keyparisView=new NovaKeypairsView({model:this.model,el:"#keypairs"})},close:function(e){this.options.securityGroupsModel.unbind("change",this.render,this),this.options.floatingIPsModel.unbind("change",this.render,this),this.model.unbind("change",this.render,this),$("#floating_ips").remove(),$("#security_groups").remove(),$("#keypairs").remove(),this.undelegateEvents(),this.unbind()},onClose:function(){this.keyparisView.close(),this.secuirtyGroupsView.close(),this.floatingIPsView.close(),this.undelegateEvents(),this.unbind()},render:function(){var e=this;UTILS.Render.animateRender(this.el,this._template)}}),NovaFloatingIPsView=Backbone.View.extend({_template:_.itemplate($("#novaFloatingIPsTemplate").html()),initialize:function(){this.options.floatingIPsModel.unbind("reset"),this.options.floatingIPsModel.bind("reset",this.render,this),this.renderFirst()},events:{"click #release_floating_IPs":"releaseFloatingIPs","click #release_floating_IP":"releaseFloatingIP","click .btn-allocate":"allocateIP"},releaseFloatingIPs:function(e){var t=new ConfirmView({el:"body",title:"Release Floating IP",btn_message:"Release Floating IPs",onAccept:function(){var e=new MessagesView({el:"#content",state:"Success",title:"Floating IPs "+sec_group.name+" released."});e.render()}});t.render()},releaseFloatingIP:function(e){},allocateIP:function(e){console.log("allocate IP");var t=new AllocateIPView({el:"body",model:this.model});t.render()},enableDisableDeleteButton:function(){$(".checkbox_floating_ips_:checked").size()>0?$("#ips_delete").attr("disabled",!1):$("#ips_delete").attr("disabled",!0)},renderFirst:function(){this.undelegateEvents();var e=this;UTILS.Render.animateRender(this.el,this._template,{floatingIPsModel:this.options.floatingIPsModel},function(){e.enableDisableDeleteButton(),e.delegateEvents(e.events)})},render:function(){var e,t,n;this.undelegateEvents(),$(".messages").html()!=null&&$(".messages").remove();if($("#floating_ips").html()!=null){var r=this._template({floatingIPsModels:this.options.floatingIPsModel.models}),i=[];for(e in this.options.floatingIPsModel.models)t=this.options.floatingIPsModel.models[e].id,$("#checkbox_floating_ips_"+t).is(":checked")&&i.push(t);$(this.el).html(r);for(e in i)t=i[e],n=$("#checkbox_floating_ips_"+t),n.html()!=null&&n.prop("checked",!0);this.enableDisableDeleteButton()}return this.delegateEvents(this.events),this}}),InstanceDetailView=Backbone.View.extend({_template:_.itemplate($("#instanceDetailTemplate").html()),flavorResp:!1,imageResp:!1,vncResp:!1,logResp:!1,initialize:function(){var e=this;this.delegateEvents({"click #overviewBtn":"showOverview","click #instance_vnc":"showVNC","click #instance_logs":"showLogs","click #instance_software":"showSoftware","click #installed_software":"showInstalledSoftware","click #new_software":"showNewSoftware"}),this.model.bind("change",this.onInstanceDetail,this),this.model.fetch();var t={};t.callback=function(t){e.options.vncUrl=t.console.url,e.vncResp=!0,e.checkAll()},this.model.vncconsole(t);var n={};n.callback=function(t){e.options.logs=t.output,e.logResp=!0,e.checkAll()},this.model.consoleoutput(n)},showOverview:function(){$("#instance_details__overview").addClass("active"),$("#instance_details__vnc").removeClass("active"),$("#instance_details__log").removeClass("active"),$("#instance_details__software").removeClass("active"),$("#instance_details__installed_software").removeClass("active"),$("#instance_details__new_software").removeClass("active"),$("#overview").addClass("active"),$("#vnc").removeClass("active"),$("#log").removeClass("active"),$("#software").removeClass("active"),$("#installed_software").removeClass("active"),$("#new_software").removeClass("active")},showVNC:function(){$("#instance_details__overview").removeClass("active"),$("#instance_details__log").removeClass("active"),$("#instance_details__vnc").addClass("active"),$("#instance_details__software").removeClass("active"),$("#instance_details__installed_software").removeClass("active"),$("#instance_details__new_software").removeClass("active"),$("#overview").removeClass("active"),$("#log").removeClass("active"),$("#vnc").addClass("active"),$("#software").removeClass("active"),$("#installed_software").removeClass("active"),$("#new_software").removeClass("active")},showLogs:function(){$("#instance_details__overview").removeClass("active"),$("#instance_details__vnc").removeClass("active"),$("#instance_details__log").addClass("active"),$("#instance_details__software").removeClass("active"),$("#instance_details__installed_software").removeClass("active"),$("#instance_details__new_software").removeClass("active"),$("#overview").removeClass("active"),$("#vnc").removeClass("active"),$("#log").addClass("active"),$("#software").removeClass("active")},showSoftware:function(){this.options.subsubview="installed_software",$("#instance_details__overview").removeClass("active"),$("#instance_details__vnc").removeClass("active"),$("#instance_details__log").removeClass("active"),$("#instance_details__software").addClass("active"),$("#overview").removeClass("active"),$("#vnc").removeClass("active"),$("#log").removeClass("active"),$("#software").addClass("active"),$("#installed_software").addClass("active"),$("#new_software").removeClass("active"),this.showInstalledSoftware()},showInstalledSoftware:function(){$("#installed_software").addClass("active"),$("#instance_details__installed_software").addClass("active"),$("#new_software").removeClass("active"),$("#instance_details__new_software").removeClass("active")},showNewSoftware:function(){$("#installed_software").removeClass("active"),$("#instance_details__installed_software").removeClass("active"),$("#new_software").addClass("active"),$("#instance_details__new_software").addClass("active")},onClose:function(){this.undelegateEvents(),this.unbind()},close:function(e){this.undelegateEvents(),$("#instance_details__overview").removeClass("active"),$("#instance_details__log").removeClass("active"),$("#instance_details__vnc").removeClass("active"),$("#instance_details__software").removeClass("active"),$("#instance_details__installed_software").removeClass("active"),$("#instance_details__new_software").removeClass("active"),$("#overview").removeClass("active"),$("#log").removeClass("active"),$("#vnc").removeClass("active"),$("#software").removeClass("active"),$("#installed_software").removeClass("active"),$("#new_software").removeClass("active"),this.onClose()},onInstanceDetail:function(){var e=this;this.options.flavor=new Flavor,this.options.flavor.set({id:this.model.get("flavor").id}),this.options.flavor.bind("change",function(){e.flavorResp=!0,e.checkAll()},this),this.options.image=new ImageVM,this.options.image.set({id:this.model.get("image").id}),this.options.image.bind("change",function(){e.imageResp=!0,e.checkAll()},this),this.options.image.fetch(),this.options.flavor.fetch(),this.checkAll()},checkAll:function(){var e=this;this.flavorResp&&this.imageResp&&this.render()},render:function(){var e=this;return $("#consult_instance").html()==null?(mySuccess=function(t){UTILS.Render.animateRender(e.el,e._template,{rules:t.security_groups[0].rules,vdc:e.options.vdc,service:e.options.service,model:e.model,flavor:e.options.flavor,image:e.options.image,logs:e.options.logs,vncUrl:e.options.vncUrl,subview:e.options.subview,subsubview:e.options.subsubview})},JSTACK.Nova.getsecuritygroupforserver(e.model.id,mySuccess)):(mySuccess=function(e){$(this.el).html(this._template({rules:e.security_groups[0].rules,vdc:this.options.vdc,service:this.options.service,model:this.model,flavor:this.options.flavor,image:this.options.image,logs:this.options.logs,vncUrl:this.options.vncUrl,subview:this.options.subview,subsubview:this.options.subsubview}))},JSTACK.Nova.getsecuritygroupforserver(this.model.id,mySuccess)),this.options.subview=="log"?this.showLogs():this.options.subview=="vnc"?this.showVNC():this.options.subview=="software"&&this.showSoftware(),this.options.subsubview=="installed_software"?this.showInstalledSoftware():this.options.subsubview=="new_software"&&this.showNewSoftware(),$("#instance_vnc").unbind(),$("#instance_logs").unbind(),$("#installed_software").unbind(),$("#new_software").unbind(),$("#instance_software").unbind(),$("#instance_vnc").bind("click",this.showVNC),$("#instance_logs").bind("click",this.showLogs),$("#instance_software").bind("click",this.showSoftware),$("#installed_software").bind("click",this.showInstalledSoftware),$("#new_software").bind("click",this.showNewSoftware),this}}),InstancesAndVolumesView=Backbone.View.extend({_template:_.itemplate($("#novaInstancesAndVolumesTemplate").html()),instancesView:undefined,volumesView:undefined,initialize:function(){this.render(),this.instancesView=new NovaInstancesView({model:this.options.instancesModel,flavors:this.options.flavors,el:"#instances"}),this.volumesView=new NovaVolumesView({model:this.options.volumesModel,volumeSnapshotsModel:this.options.volumeSnapshotModel,instances:this.options.instancesModel,el:"#volumes"})},onClose:function(){this.instancesView.onClose(),this.volumesView.onClose(),this.undelegateEvents(),this.unbind()},render:function(){var e=this;UTILS.Render.animateRender(this.el,this._template)}}),NovaInstanceSnapshotsView=Backbone.View.extend({_template:_.itemplate($("#novaInstanceSnapshotsTemplate").html()),dropdownId:undefined,initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.render,this),this.renderFirst()},events:{"change .checkbox_images":"enableDisableDeleteButtonImages","click .btn-delete-group-images":"onDeleteGroupImages","click .btn-edit-images":"onEditImages","click .btn-launch-images":"onLaunchImages","change .checkbox_instances":"enableDisableDeleteButtonInstances","click .btn-delete-group-instances":"onDeleteGroupInstances","click .btn-delete-instances":"onDeleteInstances","click .btn-edit-instances":"onEditInstances","click .btn-launch-instances":"onLaunchInstances"},onClose:function(){this.undelegateEvents(),this.unbind()},enableDisableDeleteButtonImages:function(){$(".checkbox_images:checked").size()>0?$("#images_delete").attr("disabled",!1):$("#images_delete").attr("disabled",!0)},onDeleteGroupImages:function(){var e=this,t=new ConfirmView({el:"body",title:"Delete Images",btn_message:"Delete Images",onAccept:function(){$(".checkbox_images:checked").each(function(){var t=$(this).val(),n=e.model.get(t);n.destroy();var r=new MessagesView({el:"#content",state:"Success",title:"Images "+n.get("name")+" deleted."});r.render()})}});t.render()},onLaunchImages:function(e){var t=this.model.get(e.target.value),n=new LaunchImageView({model:t,flavors:this.options.flavors,keypairs:this.options.keypairs,el:"body"});n.render()},onEditImages:function(e){var t=this.model.get(e.target.value),n=new UpdateImageView({model:t,el:"body"});n.render()},enableDisableDeleteButtonInstances:function(){$(".checkbox_instances:checked").size()>0?$("#instance_delete").attr("disabled",!1):$("#instance_delete").attr("disabled",!0)},onDeleteInstances:function(e){var t=this,n=this.model.get(e.target.value),r=t.model.get(n),i=new ConfirmView({el:"body",title:"Delete Instance Snapshot",btn_message:"Delete Instance Snapshot",onAccept:function(){r.destroy();var e=new MessagesView({el:"#content",state:"Success",title:"Instance snapshot "+r.get("name")+" deleted."});e.render()}});i.render()},onDeleteGroupInstances:function(){var e=this,t=new ConfirmView({el:"body",title:"Delete Instance Snapshots",btn_message:"Delete Instance Snapshots",onAccept:function(){$(".checkbox_instances:checked").each(function(){var t=$(this).val(),n=e.model.get(t);n.destroy();var r=new MessagesView({el:"#content",state:"Success",title:"Instance snapshot "+n.get("name")+" deleted."});r.render()})}});t.render()},onLaunchInstances:function(e){var t=this.model.get(e.target.value),n=new LaunchImageView({model:t,flavors:this.options.flavors,keypairs:this.options.keypairs,el:"body"});n.render()},onEditInstances:function(e){var t=this.model.get(e.target.value),n=new UpdateImageView({model:t,el:"body"});n.render()},renderFirst:function(){UTILS.Render.animateRender(this.el,this._template,this.model),this.undelegateEvents(),this.delegateEvents(this.events)},render:function(){this.undelegateEvents(),this.delegateEvents(this.events);if($("#images").html()!=null){var e=this._template(this.model),t=[],n=[],r=[],i=[],s,o,u,a,f;for(s in this.model.models)o=this.model.models[s].id,$("#checkbox_images_"+o).is(":checked")&&t.push(o),$("#dropdown_images_"+o).hasClass("open")&&n.push(o);for(s in this.model.models)u=this.model.models[s].id,$("#checkbox_instances_"+u).is(":checked")&&r.push(u),$("#dropdown_instances_"+u).hasClass("open")&&i.push(u);$(this.el).html(e);for(s in t)o=t[s],a=$("#checkbox_images_"+o),a.html()!=null&&a.prop("checked",!0);for(s in n)o=n[s],f=$("#dropdown_images_"+o),f.html()!=null&&f.addClass("open");for(s in r)u=r[s],a=$("#checkbox_instances_"+u),a.html()!=null&&a.prop("checked",!0);for(s in i)u=i[s],f=$("#dropdown_instances_"+u),f.html()!=null&&f.addClass("open")}return this.enableDisableDeleteButtonImages(),this.enableDisableDeleteButtonInstances(),this}}),NovaInstancesView=Backbone.View.extend({_template:_.itemplate($("#novaInstancesTemplate").html()),dropdownId:undefined,initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.render,this),this.renderFirst()},events:{"change .checkbox_instances":"enableDisableTerminateButton","click .btn-edit-instances":"onEditInstance","click .btn-snapshot":"onSnapshot","click .btn-pause":"onPause","click .btn-unpause":"onUnpause","click .btn-suspend":"onSuspend","click .btn-resume":"onResume","click .btn-password":"onChangePassword","click .btn-reboot":"onReboot","click .btn-terminate":"onTerminate","click .btn-terminate-group":"onTerminateGroup"},onClose:function(){this.undelegateEvents(),this.unbind()},onEditInstance:function(e){var t=e.target.value,n=new UpdateInstanceView({el:"body",model:this.model.get(t)});n.render()},onSnapshot:function(e){var t=e.target.value,n=new CreateSnapshotView({el:"body",model:this.model.get(t)});n.render()},onPause:function(e){var t=e.target.value,n=this.model.get(t);n.pauseserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" paused."});r.render()},onUnpause:function(e){var t=e.target.value,n=this.model.get(t);n.unpauseserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" unpaused."});r.render()},onSuspend:function(e){var t=e.target.value,n=this.model.get(t);n.suspendserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" suspended."});r.render()},onResume:function(e){var t=e.target.value,n=this.model.get(t);n.resumeserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" resumed."});r.render()},onChangePassword:function(e){var t=e.target.value,n=new ChangePasswordView({el:"body",model:this.model.get(t)});n.render()},onReboot:function(e){var t=e.target.value,n=this.model.get(t),r=new ConfirmView({el:"body",title:"Reboot Instance",btn_message:"Reboot Instance",onAccept:function(){n.reboot(!1);var e=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" rebooted."});e.render()}});r.render()},onTerminate:function(e){var t=e.target.value,n=this.model.get(t),r=new ConfirmView({el:"body",title:"Terminate Instance",btn_message:"Terminate Instance",onAccept:function(){n.destroy();var e=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" terminated."});e.render()}});r.render()},onTerminateGroup:function(e){var t=this,n=new ConfirmView({el:"body",title:"Terminate Instances",btn_message:"Terminate Instances",onAccept:function(){$(".checkbox:checked").each(function(){var e=$(this).val(),n=t.model.get(e);n.destroy();var r=new MessagesView({el:"#content",state:"Success",title:"Instances "+n.get("name")+" terminated."});r.render()})}});n.render()},enableDisableTerminateButton:function(){$(".checkbox_instances:checked").size()>0?$("#instances_terminate").attr("disabled",!1):$("#instances_terminate").attr("disabled",!0)},renderFirst:function(){$(this.el).html(this._template({models:this.model.models,flavors:this.options.flavors})),this.undelegateEvents(),this.delegateEvents(this.events)},render:function(){this.undelegateEvents(),this.delegateEvents(this.events);if($(this.el).html()!=null){var e=this._template({models:this.model.models,flavors:this.options.flavors}),t=[],n=[],r,i,s,o;for(r in this.model.models)i=this.model.models[r].id,$("#checkbox_"+i).is(":checked")&&t.push(i),$("#dropdown_"+i).hasClass("open")&&n.push(i);$(this.el).html(e);for(r in t)i=t[r],s=$("#checkbox_"+i),s.html()!=null&&s.prop("checked",!0);for(r in n)i=n[r],o=$("#dropdown_"+i),o.html()!=null&&o.addClass("open")}return this.enableDisableTerminateButton(),this}}),NovaKeypairsView=Backbone.View.extend({_template:_.itemplate($("#novaKeypairsTemplate").html()),initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.render,this),this.renderFirst()},events:{"change .checkbox_keypairs":"enableDisableDeleteButton","click #delete_keypair":"deleteKeypair","click #delete_keypairs":"deleteKeypairs","click .btn-create":"createKeypair","click .btn-import":"importKeypair"},deleteKeypair:function(e){var t=this.model.get(e.target.value),n=new ConfirmView({el:"body",title:"Delete Keypair",btn_message:"Delete Keypair",onAccept:function(){t.destroy();var n=new MessagesView({el:"#content",state:"Success",title:"Keypair "+e.target.value+" deleted."});n.render()}});n.render()},deleteKeypairs:function(e){var t=this,n=new ConfirmView({el:"body",title:"Delete Keypairs",btn_message:"Delete Keypairs",onAccept:function(){$(".checkbox_keypairs:checked").each(function(){var e=$(this).val(),n=t.model.get(e);n.destroy();var r=new MessagesView({el:"#content",state:"Success",title:"Keypairs "+e+" deleted."});r.render()})}});n.render()},createKeypair:function(){var e=new CreateKeypairView({el:"body",model:this.model});e.render()},importKeypair:function(){var e=new ImportKeypairView({el:"body",model:this.model});e.render()},enableDisableDeleteButton:function(){$(".checkbox_keypairs:checked").size()>0?$("#delete_keypairs").attr("disabled",!1):$("#delete_keypairs").attr("disabled",!0)},renderFirst:function(){this.undelegateEvents();var e=this;UTILS.Render.animateRender(this.el,this._template,{models:this.model.models},function(){e.enableDisableDeleteButton(),e.delegateEvents(e.events)})},render:function(){this.undelegateEvents(),$(".messages").html()!=null&&$(".messages").remove();if($("#keypairs").html()!=null){var e=this._template({models:this.model.models}),t=[],n,r,i;for(n in this.model.models)r=this.model.models[n].id,$("#checkbox_keypairs_"+r).is(":checked")&&t.push(r);$(this.el).html(e);for(n in t)r=t[n],i=$("#checkbox_keypairs_"+r),i.html()!=null&&i.prop("checked",!0);this.enableDisableDeleteButton()}return this.delegateEvents(this.events),this}}),NovaOverviewView=Backbone.View.extend({_template:_.itemplate($("#novaOverviewTemplate").html()),initialize:function(){},render:function(){return UTILS.Render.animateRender(this.el,this._template,this.model,function(){$("#option_id").selectbox(),$("#option_id2").selectbox()}),this}}),NovaSecurityGroupsView=Backbone.View.extend({_template:_.itemplate($("#novaSecurityGroupsTemplate").html()),initialize:function(){this.options.securityGroupsModel.unbind("reset"),this.options.securityGroupsModel.bind("reset",this.render,this),this.renderFirst()},events:{"change .checkbox_sec_groups":"enableDisableDeleteButton","click .btn-create-sec-group":"createSecurityGroup","click .btn-edit":"editSecurityGroupRules","click #sec_groups_delete":"deleteSecurityGroups","click #sec_delete":"deleteSecurityGroup"},onClose:function(){this.undelegateEvents(),this.unbind()},createSecurityGroup:function(e){var t=new CreateSecurityGroupView({el:"body",securityGroupsModel:this.options.securityGroupsModel});t.render()},editSecurityGroupRules:function(e){var t;for(var n in this.options.securityGroupsModel.models)this.options.securityGroupsModel.models[n].id==e.target.value&&(t=this.options.securityGroupsModel.models[n]);this.options.securityGroup=t;var r=new EditSecurityGroupRulesView({el:"body",securityGroupsModel:this.options});r.render()},deleteSecurityGroup:function(e){var t;for(var n in this.options.securityGroupsModel.models)if(this.options.securityGroupsModel.models[n].id==e.target.value){var r=this.options.securityGroupsModel.models[n];t=r}var i=new ConfirmView({el:"body",title:"Delete Security Group",btn_message:"Delete Security Group",onAccept:function(){t.destroy();var e=new MessagesView({el:"#content",state:"Success",title:"Security Group "+t.attributes.name+" deleted."});e.render()}});i.render()},deleteSecurityGroups:function(e){var t,n=this,r=new ConfirmView({el:"body",title:"Delete Security Groups",btn_message:"Delete Security Groups",onAccept:function(){$(".checkbox_sec_groups:checked").each(function(){var e=$(this).val();for(var r in n.options.securityGroupsModel.models)if(n.options.securityGroupsModel.models[r].id==e){var i=n.options.securityGroupsModel.models[r];t=i}t.destroy();var s=new MessagesView({el:"#content",state:"Success",title:"Security Groups "+t.attributes.name+" deleted."});s.render()})}});r.render()},enableDisableDeleteButton:function(e){$(".checkbox_sec_groups:checked").size()>0?$("#sec_groups_delete").attr("disabled",!1):$("#sec_groups_delete").attr("disabled",!0)},renderFirst:function(){this.undelegateEvents();var e=this;UTILS.Render.animateRender(this.el,this._template,{securityGroupsModel:this.options.securityGroupsModel},function(){e.enableDisableDeleteButton(),e.delegateEvents(e.events)})},render:function(){this.undelegateEvents(),$(".messages").html()!=null&&$(".messages").remove();if($("#security_groups").html()!=null){var e=this._template({securityGroupsModel:this.options.securityGroupsModel}),t=[],n,r,i;for(n in this.options.securityGroupsModel.models)r=this.options.securityGroupsModel.models[n].id,$("#checkbox_sec_groups_"+r).is(":checked")&&t.push(r);$(this.el).html(e);for(n in t)r=t[n],i=$("#checkbox_sec_groups_"+r),i.html()!=null&&i.prop("checked",!0);this.enableDisableDeleteButton()}return this.delegateEvents(this.events),this}}),NovaSnapshotsView=Backbone.View.extend({_template:_.itemplate($("#novaSnapshotsTemplate").html()),instanceSnapshotsView:undefined,volumeSnapshotsView:undefined,initialize:function(){console.log(this.options.images),this.render(),this.instanceSnapshotsView=new NovaInstanceSnapshotsView({model:this.options.images,flavors:this.options.flavors,keypairs:this.options.keypairs,el:"#instance_snapshots"}),this.volumeSnapshotsView=new NovaVolumeSnapshotsView({model:this.options.volumeSnapshotsModel,instancesModel:this.options.instancesModel,volumesModel:this.options.volumesModel,flavors:this.options.flavors,el:"#volume_snapshots"})},onClose:function(){this.instanceSnapshotsView.onClose(),this.volumeSnapshotsView.onClose(),this.undelegateEvents(),this.unbind()},render:function(){var e=this;UTILS.Render.animateRender(this.el,this._template)}}),VDCServiceView=Backbone.View.extend({_template:_.itemplate($("#novaVDCServiceTemplate").html()),dropdownId:undefined,initialize:function(){var e=this;this.model.unbind("change"),this.model.bind("change",this.render,this),this.model.fetch(),this.timer=setInterval(function(){e.model.fetch()},4e3)},events:{"change .checkbox_instances":"enableDisableTerminateButton","click .btn-edit-instances":"onEditInstance","click .btn-snapshot":"onSnapshot","click .btn-pause":"onPause","click .btn-unpause":"onUnpause","click .btn-suspend":"onSuspend","click .btn-resume":"onResume","click .btn-password":"onChangePassword","click .btn-reboot":"onReboot","click .btn-terminate":"onTerminate","click .btn-terminate-group":"onTerminateGroup"},onClose:function(){this.undelegateEvents(),this.unbind(),this.model.unbind("change")},onEditInstance:function(e){var t=e.target.value,n=new UpdateInstanceView({el:"body",model:this.model.getInstance(t)});n.render()},onSnapshot:function(e){var t=e.target.value,n=new CreateSnapshotView({el:"body",model:this.model.getInstance(t)});n.render()},onPause:function(e){var t=e.target.value,n=this.model.getInstance(t);n.pauseserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" paused."});r.render()},onUnpause:function(e){var t=e.target.value,n=this.model.getInstance(t);n.unpauseserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" unpaused."});r.render()},onSuspend:function(e){var t=e.target.value,n=this.model.getInstance(t);n.suspendserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" suspended."});r.render()},onResume:function(e){var t=e.target.value,n=this.model.getInstance(t);n.resumeserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" resumed."});r.render()},onChangePassword:function(e){var t=e.target.value,n=new ChangePasswordView({el:"body",model:this.model.getInstance(t)});n.render()},onReboot:function(e){var t=e.target.value,n=this.model.getInstance(t),r=new ConfirmView({el:"body",title:"Reboot Instance",btn_message:"Reboot Instance",onAccept:function(){n.reboot(!1);var e=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" rebooted."});e.render()}});r.render()},onTerminate:function(e){var t=e.target.value,n=this.model.getInstance(t),r=new ConfirmView({el:"body",title:"Terminate Instance",btn_message:"Terminate Instance",onAccept:function(){n.destroy();var e=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" terminated."});e.render()}});r.render()},onTerminateGroup:function(e){var t=this,n=new ConfirmView({el:"body",title:"Terminate Instances",btn_message:"Terminate Instances",onAccept:function(){$(".checkbox:checked").each(function(){var e=$(this).val(),n=t.model.getInstance(e);n.destroy();var r=new MessagesView({el:"#content",state:"Success",title:"Instances "+n.get("name")+" terminated."});r.render()})}});n.render()},enableDisableTerminateButton:function(){$(".checkbox_instances:checked").size()>0?$("#instances_terminate").attr("disabled",!1):$("#instances_terminate").attr("disabled",!0)},renderFirst:function(){UTILS.Render.animateRender(this.el,this._template,{models:this.model.get("models"),vdc:this.options.vdc,service:this.model.get("name"),flavors:this.options.flavors}),this.undelegateEvents(),this.delegateEvents(this.events)},renderSecond:function(){this.undelegateEvents(),this.delegateEvents(this.events);if($(this.el).html()!=null){var e=this._template({models:this.model.get("models"),vdc:this.options.vdc,service:this.model.get("name"),flavors:this.options.flavors}),t=[],n=[],r,i,s,o;for(r in this.model.get("models"))i=this.model.get("models")[r].id,$("#checkbox_"+i).is(":checked")&&t.push(i),$("#dropdown_"+i).hasClass("open")&&n.push(i);$(this.el).html(e);for(r in t)i=t[r],s=$("#checkbox_"+i),s.html()!=null&&s.prop("checked",!0);for(r in n)i=n[r],o=$("#dropdown_"+i),o.html()!=null&&o.addClass("open")}return this.enableDisableTerminateButton(),this},render:function(){$("#vdcservice").html()===null?this.renderFirst():this.renderSecond()}}),VDCsView=Backbone.View.extend({_template:_.itemplate($("#novaVDCsTemplate").html()),dropdownId:undefined,initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.render,this),this.renderFirst()},events:{"click .btn-launch":"onLaunch","click .btn-edit-vdcs":"onEditVDC","click .btn-delete":"onDeleteVDC"},onLaunch:function(){var e=new LaunchVDCView({el:"body"});e.render()},onClose:function(){this.model.unbind("reset"),this.undelegateEvents(),this.unbind()},onEditVDC:function(e){var t=e.target.value},onDeleteVDC:function(e){var t=this.model.get(e.target.value),n=new ConfirmView({el:"body",title:"Delete VDC",btn_message:"Delete VDC",message:"Please confirm your selection. This action cannot be undone and will delete all Services and Instances associated to this Virtual Data Center",onAccept:function(){t.destroy();var e=new MessagesView({el:"#content",state:"Success",title:"VDC "+t.get("name")+" deleted."});e.render()}});n.render()},renderFirst:function(){UTILS.Render.animateRender(this.el,this._template,this.model),this.undelegateEvents(),this.delegateEvents(this.events)},render:function(e){this.undelegateEvents(),this.delegateEvents(this.events);if($(this.el).html()!=null){var t=this._template({models:this.model.models}),n=[],r,i,s;for(r in this.model.models)i=this.model.models[r].id,$("#dropdown_"+i).hasClass("open")&&n.push(i);$(this.el).html(t);for(r in n)i=n[r],s=$("#dropdown_"+i),s.html()!=null&&s.addClass("open")}return this}}),VDCView=Backbone.View.extend({_template:_.itemplate($("#novaVDCTemplate").html()),dropdownId:undefined,timer:undefined,initialize:function(){var e=this;this.model.unbind("reset"),this.model.bind("reset",this.render,this),this.model.fetch(),this.timer=setInterval(function(){e.model.fetch()},4e3)},events:{"click .btn-launch":"onCreateService","click .btn-edit-service":"onEditService","click .btn-delete":"onDeleteService"},onClose:function(){this.model.unbind("reset"),this.undelegateEvents(),this.unbind(),clearInterval(this.timer)},onCreateService:function(e){var t=new CreateVDCServiceView({el:"body",flavors:this.options.flavors,images:this.options.images,keypairs:this.options.keypairs});t.render()},onEditService:function(e){var t=e.target.value},onDeleteService:function(e){var t=this.model.get(e.target.value),n=new ConfirmView({el:"body",title:"Delete Service",btn_message:"Delete VDC",message:"Please confirm your selection. This action cannot be undone and will delete all Instances associated to this Service.",onAccept:function(){vdc.destroy();var e=new MessagesView({el:"#content",state:"Success",title:"Service "+t.get("name")+" deleted."});e.render()}});n.render()},renderFirst:function(){UTILS.Render.animateRender(this.el,this._template,{models:this.model.models,vdc:this.options.vdc}),this.undelegateEvents(),this.delegateEvents(this.events)},renderSecond:function(e){this.undelegateEvents(),this.delegateEvents(this.events);if($(this.el).html()!=null){var t=this._template({models:this.model.models,vdc:this.options.vdc}),n=[],r,i,s;for(r in this.model.models)i=this.model.models[r].id,$("#dropdown_"+i).hasClass("open")&&n.push(i);$(this.el).html(t);for(r in n)i=n[r],s=$("#dropdown_"+i),s.html()!=null&&s.addClass("open")}return this},render:function(){$("#vdc").html()==null?this.renderFirst():this.renderSecond()}}),VolumeDetailView=Backbone.View.extend({_template:_.itemplate($("#volumeDetailTemplate").html()),initialize:function(){this.model.bind("change",this.render,this),this.model.fetch()},render:function(){return $("#volume_details").html()==null?UTILS.Render.animateRender(this.el,this._template,{model:this.model}):$(this.el).html(this._template({model:this.model})),this}}),NovaVolumeSnapshotsView=Backbone.View.extend({_template:_.itemplate($("#novaVolumeSnapshotsTemplate").html()),dropdownId:undefined,events:{"change .checkbox":"enableDisableDeleteButton","click .btn-delete-volume":"onDelete","click .btn-delete-group":"onDeleteGroup"},initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.render,this),this.renderFirst()},onClose:function(){this.undelegateEvents(),this.unbind()},enableDisableDeleteButton:function(){$(".checkbox:checked").size()>0?$("#volume_snapshots_delete").attr("disabled",!1):$("#volume_snapshots_delete").attr("disabled",!0)},onDelete:function(e){var t=this,n=this.model.get(e.target.value),r=t.model.get(n),i=new ConfirmView({el:"body",title:"Delete Volume Snapshot",btn_message:"Delete Volume Snapshot",onAccept:function(){r.destroy();var e=new MessagesView({el:"#content",state:"Success",title:"Volume snapshot "+r.get("display_name")+" deleted."});e.render()}});i.render()},onDeleteGroup:function(){var e=this,t=new ConfirmView({el:"body",title:"Delete Volume Snapshots",btn_message:"Delete Images",onAccept:function(){$(".checkbox:checked").each(function(){var t=$(this).val(),n=e.model.get(t);n.destroy();var r=new MessagesView({el:"#content",state:"Success",title:"Volume snapshot "+n.get("display_name")+" deleted."});r.render()})}});t.render()},renderFirst:function(){this.undelegateEvents(),this.delegateEvents(this.events),$(this.el).html(this._template({models:this.model.models,instancesModel:this.options.instancesModel,volumesModel:this.options.volumesModel,flavors:this.options.flavors})),this.undelegateEvents(),this.delegateEvents(this.events)},render:function(){this.undelegateEvents(),this.delegateEvents(this.events);if($("#volume_snapshots").html()!==null){var e=this._template(this.model),t=[],n=[],r,i,s,o;for(r in this.model.models)i=this.model.models[r].id,$("#checkbox_"+i).is(":checked")&&t.push(i),$("#dropdown_"+i).hasClass("open")&&n.push(instanceId);$(this.el).html(e);for(r in t)i=t[r],s=$("#checkbox_"+i),s.html()!==null&&s.prop("checked",!0);for(r in n)i=n[r],o=$("#dropdown_"+i),o.html()!==null&&o.addClass("open")}return this.enableDisableDeleteButton(),this}}),NovaVolumesView=Backbone.View.extend({_template:_.itemplate($("#novaVolumesTemplate").html()),dropdownId:undefined,events:{"change .checkbox_volumes":"enableDisableDeleteButton","click .btn-create-volume":"onCreate","click .btn-edit-volumes":"onEdit","click .btn-delete-volume":"onDelete","click .btn-camera":"onSnapshot","click .btn-delete-group":"onDeleteGroup"},initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.render,this),this.render()},onClose:function(){this.undelegateEvents(),this.unbind(),this.model.unbind("reset")},onCreate:function(e){var t=new CreateVolumeView({el:"body"});t.render()},onSnapshot:function(e){var t=e.target.value,n=this.model.get(t),r=new CreateVolumeSnapshotView({el:"body",model:n});r.render()},onEdit:function(e){var t=e.target.getAttribute("value"),n=this.model.get(t),r=new EditVolumeAttachmentsView({el:"body",model:n,instances:this.options.instancesModel});r.render()},onDelete:function(e){var t=e.target.value,n=this.model.get(t),r=new ConfirmView({el:"body",title:"Delete Volume",btn_message:"Delete Volume",onAccept:function(){n.destroy();var e=new MessagesView({el:"#content",state:"Success",title:"Volume "+n.get("display_name")+" deleted."});e.render()}});r.render()},onDeleteGroup:function(e){var t=this,n=new ConfirmView({el:"body",title:"Delete Volume",btn_message:"Delete Volumes",onAccept:function(){$(".checkbox_volumes:checked").each(function(){var e=$(this).val(),n=t.model.get(e);n.destroy();var r=new MessagesView({el:"#content",state:"Success",title:"Volume "+n.get("display_name")+" deleted."});r.render()})}});n.render()},enableDisableDeleteButton:function(){$(".checkbox_volumes:checked").size()>0?$("#volumes_delete").attr("disabled",!1):$("#volumes_delete").attr("disabled",!0)},render:function(){$("#volumes").html()==null?this.renderFirst():this.renderSecond()},renderFirst:function(){this.undelegateEvents(),this.delegateEvents(this.events),UTILS.Render.animateRender(this.el,this._template,{models:this.model.models,volumeSnapshotsModel:this.options.volumeSnapshotModel,instances:this.options.instancesModel}),this.undelegateEvents(),this.delegateEvents(this.events)},renderSecond:function(){this.undelegateEvents(),this.delegateEvents(this.events);if($(this.el).html()!=null){var e=this._template({models:this.model.models,volumeSnapshotsModel:this.options.volumeSnapshotModel,flavors:this.options.flavors}),t=[],n=[],r,i,s;for(r in this.model.models)i=this.model.models[r].id,$("#checkbox_"+i).is(":checked")&&t.push(i),$("#dropdown_"+i).hasClass("open")&&n.push(i);$(this.el).html(e);for(r in t)i=t[r],s=$("#checkbox_"+i),s.html()!=null&&s.prop("checked",!0);for(r in n)i=n[r],drop=$("#dropdown_"+i),drop.html()!=null&&drop.addClass("open")}return this.enableDisableDeleteButton(),this}}),ObjectStorageContainersView=Backbone.View.extend({_template:_.itemplate($("#objectstorageContainersTemplate").html()),initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.render,this),this.renderFirst()},events:{"change .checkbox_containers":"enableDisableDeleteButton","change .checkbox_all":"checkAll","click #containers__action_create":"onCreateContainer","click .btn-upload":"onUploadObject","click .btn-delete":"onDelete","click .btn-delete-group":"onDeleteGroup"},onCreateContainer:function(e){var t=new CreateContainerView({el:"body",model:this.model});t.render()},onUploadObject:function(e){var t=this,n=t.model.get(e.target.value),r=new UploadObjectView({el:"body",model:n});r.render()},onClose:function(){this.undelegateEvents(),this.unbind()},onDelete:function(e){var t=e.target.value,n=this,r,i=new ConfirmView({el:"body",title:"Confirm Delete Container",btn_message:"Delete Container",onAccept:function(){r=n.model.get(t);if(r.get("count")>0){console.log(r);var e=new MessagesView({el:"#content",state:"Error",title:"Unable to delete non-empty container "+r.get("id")});e.render();return}r.destroy();var i=new MessagesView({el:"#content",state:"Success",title:"Container "+r.get("id")+" deleted."});i.render()}});i.render()},onDeleteGroup:function(e){var t=this,n,r=new ConfirmView({el:"body",title:"Delete Containers",btn_message:"Delete Containers",onAccept:function(){$(".checkbox_containers:checked").each(function(){var e=$(this).val();n=t.model.get(e);if(n.get("count")>0){var r=new MessagesView({el:"#content",state:"Conflict",title:"Container "+n.get("id")+" contains objects."});r.render();return}n.destroy();var i=new MessagesView({el:"#content",state:"Success",title:"Container "+n.get("name")+" deleted."});i.render()})}});r.render()},checkAll:function(){$(".checkbox_all:checked").size()>0?($(".checkbox_containers").attr("checked","checked"),this.enableDisableDeleteButton()):($(".checkbox_containers").attr("checked",!1),this.enableDisableDeleteButton())},enableDisableDeleteButton:function(){$(".checkbox_containers:checked").size()>0?$("#containers_terminate").attr("disabled",!1):$("#containers_terminate").attr("disabled",!0)},renderFirst:function(){var e=this;UTILS.Render.animateRender(this.el,this._template,{models:this.model.models}),this.enableDisableDeleteButton()},render:function(){$(".messages").html()!=null&&$(".messages").remove();if($("#containers").html()!=null){var e=this._template(this.model),t=[],n,r,i;for(n in this.model.models)r=this.model.models[n].id,$("#checkbox_"+r).is(":checked")&&t.push(r);$(this.el).html(e);for(n in t)r=t[n],i=$("#checkbox_"+r),i.html()!=null&&i.prop("checked",!0);this.enableDisableDeleteButton()}return this}}),ObjectStorageContainerView=Backbone.View.extend({_template:_.itemplate($("#objectstorageContainerTemplate").html()),initialize:function(){this.model.unbind("reset"),this.model.bind("change",this.renderFirst,this),this.model.bind("reset",this.render,this),this.model.fetch()},events:{"change .checkbox_objects":"enableDisableDeleteButton","change .checkbox_all":"checkAll","click .btn-upload":"onUploadObject","click .btn-copy":"onCopyObject","click .btn-download":"onDownloadObject","click .btn-delete":"onDelete","click #objects_delete":"onDeleteGroup"},onDownloadObject:function(){var e,t,n,r,i;e=this,t=$(".btn-download").attr("href"),n=t.split("/"),cont=n[n.length-2],obj=n[n.length-1],mySucess=function(e){var t,n,r;n=new Blob([e],{type:"application/cdmi-object"}),r=window.URL.createObjectURL(n),window.open(r)},CDMI.Actions.downloadobject(cont,obj,mySucess)},onUploadObject:function(e){var t=new UploadObjectView({el:"body",model:this.model});t.render()},onCopyObject:function(e){this.options.title=e.target.value;var t=this.options.model.get("name"),n=new CopyObjectView({el:"body",model:this.model,title:this.options.title,container:t,containers:this.options.containers.models});n.render()},onClose:function(){this.undelegateEvents(),this.unbind()},onDelete:function(e){var t,n,r=this;for(var i in this.model.get("objects"))if(this.model.get("objects")[i].name===e.target.value)var s=this.model.get("objects")[i];n=this.model.get("name");var o=new ConfirmView({el:"body",title:"Confirm Delete Object",btn_message:"Delete Object",onAccept:function(){r.model.deleteObject(n,t);var e=new MessagesView({el:"#content",state:"Success",title:"Object "+t.name+" deleted."});e.render()}});o.render()},onDeleteGroup:function(e){var t=this,n,r=[],i=new ConfirmView({el:"body",title:"Delete Objects",btn_message:"Delete Objects",onAccept:function(){var e=[];$(".checkbox_objects:checked").each(function(){var n=$(this).val(),r=t.model.get("objects")[n];e.push(r);var i=new MessagesView({el:"#content",state:"Success",title:"Object "+r.name+" deleted."});i.render()}),r=e,n=t.model.get("name"),t.model.deleteObjects(n,r)}});i.render()},checkAll:function(){$(".checkbox_all:checked").size()>0?($(".checkbox_objects").attr("checked","checked"),this.enableDisableDeleteButton()):($(".checkbox_objects").attr("checked",!1),this.enableDisableDeleteButton())},enableDisableDeleteButton:function(){$(".checkbox_objects:checked").size()>0?$("#objects_delete").attr("disabled",!1):$("#objects_delete").attr("disabled",!0)},render:function(){$(".messages").html()!=null&&$(".messages").remove();if($("#objects").html()!=null){var e=this._template(this.model),t=[],n,r,i;for(r in this.model.models)n=this.model.models[r].id,$("#checkbox_"+n).is(":checked")&&t.push(n);$(this.el).html(e);for(r in t)n=t[r],i=$("#checkbox_"+n),i.html()!=null&&i.prop("checked",!0);this.enableDisableDeleteButton()}return this.delegateEvents(this.events),this},renderFirst:function(){var e=this;UTILS.Render.animateRender(this.el,this._template,{model:this.model,models:this.model.get("objects")})}}),RootView=Backbone.View.extend({_roottemplate:_.itemplate($("#rootTemplate").html()),_authtemplate:_.itemplate($("#not_logged_in").html()),initialize:function(){$(this.options.auth_el).empty().html(this._authtemplate(this.model)).css("display","None"),$(this.options.root_el).empty().html(this._roottemplate()).css("display","None"),this.model.bind("change:loggedIn",this.onLogin,this),this.model.bind("auth-error",this.renderAuthonerror,this),this.onLogin()},onCredentialsSubmit:function(e){e.preventDefault(),this.model.setCredentials(this.$("input[name=username]").val(),this.$("input[name=password]").val())},onCloseErrorMsg:function(e){this.model.set({error_msg:null}),this.renderAuthonerror()},onLogin:function(){this.model.get("loggedIn")&&(this.options.next_view!==undefined?window.location.href="#"+this.options.next_view:window.location.href="#syspanel")},renderAuth:function(){var e=this;e.$el=$(e.options.auth_el),e.delegateEvents({"click #home_loginbtn":"onCredentialsSubmit","click .close":"onCloseErrorMsg"}),console.log(e.model.get("token"),e.model.get("error_msg"),e.model.get("expired"));if(e.model.get("token")!==""&&e.model.get("error_msg")==null&&e.model.get("expired")!==!0)return;return console.log("Conditions passed"),$(e.options.root_el).css("display")!=="None"&&$(e.options.root_el).fadeOut(),$(e.options.auth_el).fadeIn(),this},renderRoot:function(){var e=this;return e.$el=$(e.options.auth_el),e.delegateEvents({}),$(e.options.auth_el).css("display")!=="None"&&$(e.options.auth_el).fadeOut(),$(e.options.auth_el).fadeOut(),$(e.options.root_el).fadeIn(),this},renderAuthonerror:function(){return $(this.options.auth_el).css("display")=="none"&&$(this.options.auth_el).fadeIn(),$(this.options.auth_el).empty().html(this._authtemplate(this.model)),$("body").attr("id","splash"),this}}),SettingsView=Backbone.View.extend({_template:_.itemplate($("#settingsTemplate").html()),events:{"click #select":"changeLang"},initialize:function(){},changeLang:function(e){$("select option:selected").each(function(){var e=$(this).attr("value");UTILS.i18n.setlang(e,function(){window.location.href=""})})},render:function(){$(this.el).empty().html(this._template())}}),SideBarView=Backbone.View.extend({_template:_.itemplate($("#sideBarTemplate").html()),initialize:function(){this.model.bind("change:actives",this.render,this),this.options.loginModel.bind("switch-tenant",this.render,this)},render:function(){var e=this;$(e.el).empty().html(e._template({models:e.model.models,showTenants:e.options.showTenants,loginModel:this.options.loginModel,title:e.options.title})),$("#tenant_switcher").selectbox({onChange:function(e,t){window.location=e}})}}),FlavorView=Backbone.View.extend({_template:_.itemplate($("#flavorsTemplate").html()),initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.render,this),this.renderFirst()},events:{"change .checkbox":"enableDisableDeleteButton","click .btn-delete":"onDelete","click .btn-delete-group":"onDeleteGroup"},onClose:function(){this.undelegateEvents(),this.unbind()},enableDisableDeleteButton:function(){$(".checkbox:checked").size()>0?$("#flavors_delete").attr("disabled",!1):$("#flavors_delete").attr("disabled",!0)},onDelete:function(e){var t=e.target.value,n=this.model.get(t);console.log(n);var r=new ConfirmView({el:"body",title:"Delete Flavor",btn_message:"Delete Flavor",onAccept:function(){n.destroy();var e=new MessagesView({el:"#content",state:"Success",title:"Flavor "+n.get("name")+" deleted."});e.render()}});r.render()},onDeleteGroup:function(e){var t=this,n=new ConfirmView({el:"body",title:"Delete Flavors",btn_message:"Delete Flavor",onAccept:function(){$(".checkbox:checked").each(function(){var e=$(this).val(),n=t.model.get(e);console.log(n),n.destroy();var r=new MessagesView({el:"#content",state:"Success",title:"Flavors "+n.get("name")+" deleted."});r.render()})}});n.render()},renderFirst:function(){UTILS.Render.animateRender(this.el,this._template,this.model),this.enableDisableDeleteButton()},render:function(){$(".messages").html()!=null&&$(".messages").remove();if($("#flavors").html()!=null){var e=this._template(this.model),t=[],n,r,i;for(n in this.model.models)r=this.model.models[n].id,$("#checkbox_"+r).is(":checked")&&t.push(r);$(this.el).html(e);for(n in t)r=t[n],i=$("#checkbox_"+r),i.html()!=null&&i.prop("checked",!0);this.enableDisableDeleteButton()}return this}}),ImagesView=Backbone.View.extend({_template:_.itemplate($("#imagesTemplate").html()),initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.render,this),this.renderFirst()},events:{"change .checkbox":"enableDisableDeleteButton","click .btn-delete":"onDelete","click .btn-delete-group":"onDeleteGroup","click .btn-launch":"onLaunch"},onClose:function(){this.undelegateEvents(),this.unbind()},onLaunch:function(e){var t=e.target.value,n=this.model.get(t),r=this;console.log("Showing Instance Creation");var i=new LaunchImageView({el:"body",images:this.options.images,flavors:this.options.flavors,keypairs:this.options.keypairs,model:n});i.render()},onDelete:function(e){var t=e.target.value,n=this.model.get(t),r=new ConfirmView({el:"body",title:"Delete Image",btn_message:"Delete Image",onAccept:function(){n.destroy();var e=new MessagesView({el:"#content",state:"Success",title:"Image "+n.get("name")+" deleted."});e.render()}});r.render()},onDeleteGroup:function(e){var t=this,n=new ConfirmView({el:"body",title:"Delete Images",btn_message:"Delete Images",onAccept:function(){$(".checkbox:checked").each(function(){var e=$(this).val(),n=t.model.get(e);n.destroy();var r=new MessagesView({el:"#content",state:"Success",title:"Images "+n.get("name")+" deleted."});r.render()})}});n.render()},enableDisableDeleteButton:function(e){$(".checkbox:checked").size()>0?$("#images_delete").attr("disabled",!1):$("#images_delete").attr("disabled",!0)},renderFirst:function(){UTILS.Render.animateRender(this.el,this._template,this.model),this.enableDisableDeleteButton()},render:function(){if($("#images").html()!=null){var e=this._template(this.model),t=[],n=[],r,i,s,o;for(r in this.model.models)i=this.model.models[r].id,$("#checkbox_"+i).is(":checked")&&t.push(i),$("#dropdown_"+i).hasClass("open")&&n.push(i);$(this.el).html(e);for(r in t)i=t[r],s=$("#checkbox_"+i),s.html()!=null&&s.prop("checked",!0);for(r in n)i=n[r],o=$("#dropdown_"+i),o.html()!=null&&o.addClass("open");this.enableDisableDeleteButton()}return this}}),InstanceView=Backbone.View.extend({_template:_.itemplate($("#instancesTemplate").html()),dropdownId:undefined,initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.render,this),this.renderFirst()},events:{"change .checkbox":"enableDisableTerminateButton","click .btn-edit":"onEditInstance","click .btn-snapshot":"onSnapshot","click .btn-pause":"onPause","click .btn-unpause":"onUnpause","click .btn-suspend":"onSuspend","click .btn-resume":"onResume","click .btn-password":"onChangePassword","click .btn-reboot":"onReboot","click .btn-terminate":"onTerminate","click .btn-terminate-group":"onTerminateGroup"},onClose:function(){this.undelegateEvents(),this.unbind(),this.model.unbind("reset")},onEditInstance:function(e){var t=e.target.value,n=new UpdateInstanceView({el:"body",model:this.model.get(t)});n.render()},onSnapshot:function(e){var t=e.target.value,n=new CreateSnapshotView({el:"body",model:this.model.get(t)});n.render()},onPause:function(e){var t=e.target.value,n=this.model.get(t);n.pauseserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" paused."});r.render()},onUnpause:function(e){var t=e.target.value,n=this.model.get(t);n.unpauseserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" unpaused."});r.render()},onSuspend:function(e){var t=e.target.value,n=this.model.get(t);n.suspendserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" suspended."});r.render()},onResume:function(e){var t=e.target.value,n=this.model.get(t);n.resumeserver();var r=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" resumed."});r.render()},onChangePassword:function(e){var t=e.target.value,n=new ChangePasswordView({el:"body",model:this.model.get(t)});n.render()},onReboot:function(e){var t=e.target.value,n=this.model.get(t),r=new ConfirmView({el:"body",title:"Reboot Instance",btn_message:"Reboot Instance",onAccept:function(){n.reboot(!1);var e=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" rebooted."});e.render()}});r.render()},onTerminate:function(e){var t=e.target.value,n=this.model.get(t),r=new ConfirmView({el:"body",title:"Terminate Instance",btn_message:"Terminate Instance",onAccept:function(){n.destroy();var e=new MessagesView({el:"#content",state:"Success",title:"Instance "+n.get("name")+" terminated."});e.render()}});r.render()},onTerminateGroup:function(e){var t=this,n=new ConfirmView({el:"body",title:"Terminate Instances",btn_message:"Terminate Instances",onAccept:function(){$(".checkbox:checked").each(function(){var e=$(this).val(),n=t.model.get(e);n.destroy();var r=new MessagesView({el:"#content",state:"Success",title:"Instances "+n.get("name")+" terminated."});r.render()})}});n.render()},enableDisableTerminateButton:function(){$(".checkbox:checked").size()>0?$("#instances_terminate").attr("disabled",!1):$("#instances_terminate").attr("disabled",!0)},renderFirst:function(){UTILS.Render.animateRender(this.el,this._template,{models:this.model.models,projects:this.options.projects,flavors:this.options.flavors}),this.enableDisableTerminateButton()},render:function(){if($("#instances").html()!=null){var e=this._template({models:this.model.models,projects:this.options.projects,flavors:this.options.flavors}),t=[],n=[],r,i,s,o;for(r in this.model.models)i=this.model.models[r].id,$("#checkbox_"+i).is(":checked")&&t.push(i),$("#dropdown_"+i).hasClass("open")&&n.push(i);$(this.el).html(e);for(r in t)i=t[r],s=$("#checkbox_"+i),s.html()!=null&&s.prop("checked",!0);for(r in n)i=n[r],o=$("#dropdown_"+i),o.html()!=null&&o.addClass("open");this.enableDisableTerminateButton()}return this}}),SysOverviewView=Backbone.View.extend({_template:_.itemplate($("#sysOverviewTemplate").html()),initialize:function(){},render:function(){return UTILS.Render.animateRender(this.el,this._template,this.model,function(){$("#option_id").selectbox(),$("#option_id2").selectbox()}),this}}),ProjectView=Backbone.View.extend({_template:_.itemplate($("#projectsTemplate").html()),initialize:function(){this.model.bind("reset",this.rerender,this),this.render()},onClose:function(){this.model.unbind("reset")},render:function(){return UTILS.Render.animateRender(this.el,this._template,this.model),this},rerender:function(){$("#tenants").html()!=null&&$(this.el).empty().html(this._template(this.model))}}),QuotaView=Backbone.View.extend({_template:_.itemplate($("#quotasTemplate").html()),initialize:function(){this.model.unbind("reset"),this.model.bind("reset",this.rerender,this),this.model.fetch()},rerender:function(){var e=this;UTILS.Render.animateRender(this.el,this._template,{models:this.model.models})}}),ServiceView=Backbone.View.extend({_template:_.itemplate($("#servicesTemplate").html()),initialize:function(){this.model.bind("reset",this.rerender,this),this.model.fetch()},render:function(){return UTILS.Render.animateRender(this.el,this._template,this.model),this},rerender:function(){$(this.el).empty().html(this._template(this.model))}}),UserView=Backbone.View.extend({_template:_.itemplate($("#usersTemplate").html()),initialize:function(){},render:function(){return UTILS.Render.animateRender(this.el,this._template,this.model),this},rerender:function(){$(this.el).empty().html(this._template(this.model))}}),TopBarView=Backbone.View.extend({_template:_.itemplate($("#topBarTemplate").html()),initialize:function(){this.model.bind("change:title",this.render,this),this.model.bind("change:subtitle",this.render,this),this.options.loginModel.bind("change:username",this.render,this)},render:function(){var e=this;return this.model.set({username:this.options.loginModel.get("username")}),$(e.el).empty().html(e._template(e.model)),this}});