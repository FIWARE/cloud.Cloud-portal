var Container=Backbone.Model.extend({_action:function(a,b){var c=this,b=b||{};b.success=function(a){c.trigger("sync",c,a,b);void 0!==b.callback&&b.callback(a)};return(this.sync||Backbone.sync).call(this,a,this,b)},copyObject:function(a,b,c,d,f){console.log("Copy object");f=f||{};f.currentContainer=a;f.currentObject=b;f.targetContainer=c;f.targetObject=d;return this._action("copyObject",f)},uploadObject:function(a,b,c,d){console.log("Upload object");d=d||{};d.container=a;d.objectName=b;d.object=c;
return this._action("uploadObject",d)},downloadObject:function(a,b,c){console.log("Download object");c=c||{};c.container=a;c.object=b;return this._action("downloadObject",c)},deleteObject:function(a,b){console.log("Delete object");b=b||{};b.container=a;return this._action("deleteObject",b)},deleteObjects:function(a,b){console.log("Delete objects");b=b||{};b.container=a;console.log(b.container);return this._action("deleteObject",b)},sync:function(a,b,c){switch(a){case "read":mySucess=function(a){var b=
{};b.objects=a;return c.success(b)};CDMI.Actions.getobjectlist(b.get("name"),mySucess);break;case "delete":CDMI.Actions.deletecontainer(b.get("name"),c.success);console.log(c.success);break;case "create":CDMI.Actions.createcontainer(b.get("name"),c.success);break;case "copyObject":CDMI.Actions.copyobject(c.currentContainer,c.currentObject,c.targetContainer,c.targetObject,c.success);break;case "uploadObject":CDMI.Actions.uploadobject(c.container,c.objectName,c.object,c.success);break;case "downloadObject":mySucess=
function(a){var b={};b.object=a;return c.success(b)};CDMI.Actions.downloadobject(c.container,c.object,mySucess);break;case "deleteObject":if(void 0!==c.name)CDMI.Actions.deleteobject(c.container,c.name,c.success);else for(var d in c)c.name=c[d].name,void 0!==c.name&&""!==c.name&&CDMI.Actions.deleteobject(c.container,c.name,c.success)}},parse:function(a){if(void 0!==a.container)return a.container.id=a.container.name,a.container;a.id=a.name;return a}}),Containers=Backbone.Collection.extend({model:Container,
sync:function(a,b,c){"read"===a&&CDMI.Actions.getcontainerlist(c.success)},comparator:function(a){return a.get("id")},parse:function(a){return a}});var Flavor=Backbone.Model.extend({sync:function(a,b,c){switch(a){case "read":JSTACK.Nova.getflavordetail(b.get("id"),c.success);break;case "delete":JSTACK.Nova.deleteflavor(b.get("id"),c.success);break;case "create":JSTACK.Nova.createflavor(b.get("name"),b.get("memory_mb"),b.get("vcpus"),b.get("disk_gb"),b.get("flavor_id"),b.get("eph_gb"),void 0,void 0,c.success)}},parse:function(a){return void 0!==a.flavor?a.flavor:a}}),Flavors=Backbone.Collection.extend({model:Flavor,sync:function(a,b,c){"read"===
a&&JSTACK.Nova.getflavorlist(!0,c.success)},comparator:function(a){return a.get("id")},parse:function(a){return a.flavors}});var FloatingIP=Backbone.Model.extend({initialize:function(){this.id=this.get("name")},sync:function(){}}),FloatingIPs=Backbone.Collection.extend({model:FloatingIP,sync:function(){},parse:function(a){return a}});var ImageVM=Backbone.Model.extend({sync:function(a,b,c){switch(a){case "read":JSTACK.Nova.getimagedetail(b.get("id"),c.success);break;case "delete":JSTACK.Nova.deleteimage(b.get("id"),c.success);break;case "update":JSTACK.Nova.updateimage(b.get("id"),b.get("name"),c.success)}},parse:function(a){return void 0!==a.image?a.image:a}}),Images=Backbone.Collection.extend({model:ImageVM,sync:function(a,b,c){"read"===a&&JSTACK.Nova.getimagelist(!0,c.success)},parse:function(a){return a.images}});var Instance=Backbone.Model.extend({_action:function(a,b){var c=this;null===b&&(b={});b.success=function(a){c.trigger("sync",c,a,b);void 0!==b.callback&&b.callback(a)};return(this.sync||Backbone.sync).call(this,a,this,b)},createsnapshot:function(a){return this._action("snapshot",a)},pauseserver:function(a){return this._action("pause",a)},unpauseserver:function(a){return this._action("unpause",a)},suspendserver:function(a){return this._action("suspend",a)},resumeserver:function(a){return this._action("resume",
a)},reboot:function(a,b){b=b||{};b.soft=a;return this._action("reboot",b)},resize:function(a,b){b=b||{};b.flavor=a;return this._action("resize",b)},confirmresize:function(a){return this._action("confirm-resize",a)},revertresize:function(a){return this._action("revert-resize",a)},changepassword:function(a,b){b=b||{};b.adminPass=a;return this._action("change-password",b)},createimage:function(a){return this._action("create-image",a)},vncconsole:function(a){return this._action("get-vncconsole",a)},consoleoutput:function(a){void 0===
a&&(a={});void 0===a.length&&(a.length=35);return this._action("consoleoutput",a)},attachvolume:function(a){void 0===a&&(a={});return this._action("attachvolume",a)},detachvolume:function(a){void 0===a&&(a={});return this._action("detachvolume",a)},attachedvolumes:function(a){void 0===a&&(a={});return this._action("attachedvolumes",a)},sync:function(a,b,c){switch(a){case "create":JSTACK.Nova.createserver(b.get("name"),b.get("imageReg"),b.get("flavorReg"),b.get("key_name"),b.get("user_data"),b.get("security_groups"),
b.get("min_count"),b.get("max_count"),b.get("availability_zone"),c.success);break;case "delete":JSTACK.Nova.deleteserver(b.get("id"),c.success);break;case "update":JSTACK.Nova.updateserver(b.get("id"),b.get("name"),c.success);break;case "read":JSTACK.Nova.getserverdetail(b.get("id"),c.success);break;case "reboot":void 0!==c.soft&&c.soft?JSTACK.Nova.rebootserversoft(b.get("id"),c.success):JSTACK.Nova.rebootserverhard(b.get("id"),c.success);break;case "resize":JSTACK.Nova.resizeserver(b.get("id"),c.flavor.id,
c.success);break;case "snapshot":JSTACK.Nova.createsnapshot(b.get("id"),b.get("name"),c.success);break;case "confirm-resize":JSTACK.Nova.confirmresizedserver(b.get("id"),c.success);break;case "revert-resize":JSTACK.Nova.revertresizedserver(b.get("id"),c.success);break;case "pause":JSTACK.Nova.pauseserver(b.get("id"),c.success);break;case "unpause":JSTACK.Nova.unpauseserver(b.get("id"),c.success);break;case "suspend":JSTACK.Nova.suspendserver(b.get("id"),c.success);break;case "resume":JSTACK.Nova.resumeserver(b.get("id"),
c.success);break;case "change-password":JSTACK.Nova.changepasswordserver(b.get("id"),c.adminPass,c.success);break;case "create-image":JSTACK.Nova.createimage(b.get("id"),c.success);break;case "get-vncconsole":JSTACK.Nova.getvncconsole(b.get("id"),"novnc",c.success);break;case "consoleoutput":JSTACK.Nova.getconsoleoutput(b.get("id"),c.length,c.success);break;case "attachvolume":JSTACK.Nova.attachvolume(b.get("id"),c.volume_id,c.device,c.success);break;case "detachvolume":JSTACK.Nova.detachvolume(b.get("id"),
c.volume_id,c.success);break;case "attachedvolumes":JSTACK.Nova.getattachedvolumes(b.get("id"),c.success)}},parse:function(a){return void 0!==a.server?a.server:a}}),Instances=Backbone.Collection.extend({model:Instance,sync:function(a,b,c){"read"===a&&JSTACK.Nova.getserverlist(!0,this.alltenants,c.success)},parse:function(a){return a.servers}});var Keypair=Backbone.Model.extend({initialize:function(){this.id=this.get("name")},_action:function(a,b){var c=this;null==b&&(b={});b.success=function(a){c.trigger("sync",c,a,b);void 0!==b.callback&&b.callback(a)};return(this.sync||Backbone.sync).call(this,a,this,b)},createkeypair:function(a,b,c){console.log("Create keypair");c=c||{};return this._action("createkeypair",c)},sync:function(a,b,c){switch(a){case "create":JSTACK.Nova.createkeypair(b.get("name"),b.get("public_key"),c.success);break;case "createkeypair":console.log(b.get("name"),
b.get("public_key"));mySuccess=function(a){var b={};b.object=a;return c.success(b)};JSTACK.Nova.createkeypair(b.get("name"),b.get("public_key"),mySuccess);break;case "delete":JSTACK.Nova.deletekeypair(b.get("name"),c.success)}}}),Keypairs=Backbone.Collection.extend({model:Keypair,sync:function(a,b,c){"read"===a&&JSTACK.Nova.getkeypairlist(c.success)},parse:function(a){var b=[],c;for(c in a.keypairs)b.push(a.keypairs[c].keypair);return b}});var LoginStatus=Backbone.Model.extend({defaults:{loggedIn:!1,username:null,password:null,error_msg:null,token:"",tenant:void 0,tenants:void 0},initialize:function(){this.bind("credentials",this.onCredentialsChange,this);this.bind("change:token",this.onTokenChange,this);this.bind("error",this.onValidateError,this);this.set({"token-ts":localStorage.getItem("token-ts")});this.set({token:localStorage.getItem("token")})},onValidateError:function(a,b){a.set({error_msg:"Username and password are mandatory."});
a.trigger("auth-error",b.msg)},onCredentialsChange:function(){var a=this;""!==a.get("username")&&""!==a.get("password")?UTILS.Auth.authenticate(a.get("username"),a.get("password"),void 0,void 0,function(){console.log("Authenticated with credentials");a.setToken();a.set({username:UTILS.Auth.getName(),tenant:UTILS.Auth.getCurrentTenant()});UTILS.Auth.getTenants(function(b){a.set({tenants:b});a.set({loggedIn:!0})})},function(b){a.set({error_msg:b});a.trigger("auth-error",b)}):(a.set({error_msg:"Username and password are mandatory."}),
a.trigger("auth-error","Username and password are mandatory."))},onTokenChange:function(a,b){!UTILS.Auth.isAuthenticated()&&""!==b&&(new Date).getTime()<a.get("token-ts")+864E5?UTILS.Auth.authenticate(void 0,void 0,void 0,b,function(){console.log("Authenticated with token");a.set({username:UTILS.Auth.getName(),tenant:UTILS.Auth.getCurrentTenant()});console.log("New tenant: "+a.attributes.tenant.name);UTILS.Auth.getTenants(function(b){a.set({tenants:b});a.set({loggedIn:!0})})},function(b){console.log("Error authenticating with token");
a.set({error_msg:b});a.trigger("auth-error",b)}):(console.log("Not logged In"),a.set({expired:!0}),a.trigger("auth-needed",""),a.set({loggedIn:!1}))},setToken:function(){localStorage.getItem("token")!==UTILS.Auth.getToken()&&localStorage.setItem("token-ts",(new Date).getTime());localStorage.setItem("token",UTILS.Auth.getToken());this.set({token:UTILS.Auth.getToken()})},isAdmin:function(){return UTILS.Auth.isAdmin()},removeToken:function(){localStorage.setItem("token","");this.set({token:""})},setCredentials:function(a,
b){console.log("Setting credentials");this.set({username:a,password:b,error_msg:void 0});this.trigger("credentials",this)},switchTenant:function(a){var b=this;console.log("Tenant: "+a);UTILS.Auth.switchTenant(a,function(){b.set({username:UTILS.Auth.getName(),tenant:UTILS.Auth.getCurrentTenant()});b.trigger("switch-tenant")})},clearAll:function(){localStorage.setItem("token","");this.set(this.defaults)}});var NavTabModel=Backbone.Model.extend({defaults:{name:void 0,active:!1,url:void 0}}),NavTabModels=Backbone.Collection.extend({model:NavTabModel,setActive:function(a){for(var b in this.models){var c=this.models[b];c.get("name")==a?c.set({active:!0}):c.set({active:!1})}this.trigger("change:actives","Changes")},getActive:function(){for(var a in this.models){var b=this.models[a];if(b.get("active"))return b.get("name")}}});var Overview=Backbone.Model.extend({sync:function(a,b,c){switch(a){case "read":JSTACK.Nova.getimagedetail(b.get("id"),c.success);break;case "downloadSummary":JSTACK.Nova.getimagedetail(b.get("id"),c.success)}}}),Overviewes=Backbone.Collection.extend({model:Overview,sync:function(a,b,c){"read"===a&&JSTACK.Nova.getusagesummary(!0,c.success)},parse:function(a){return a.overview}});var Project=Backbone.Model.extend({sync:function(a,b,c){switch(a){case "read":JSTACK.Keystone.gettenants(b.get("id"),c.success);break;case "delete":JSTACK.Keystone.deletetenant(b.get("id"),c.success);break;case "create":JSTACK.Keystone.createtenant(b.get("id"),c.success);break;case "filter":JSTACK.Keystone.filtertenant(b.get("id"),c.success)}}}),Projects=Backbone.Collection.extend({model:Project,sync:function(a,b,c){"read"===a&&JSTACK.Keystone.gettenants(c.success)},parse:function(a){return a.tenants}});var Quota=Backbone.Model.extend({sync:function(){}}),Quotas=Backbone.Collection.extend({model:Quota,sync:function(a,b,c){"read"===a&&JSTACK.Nova.getquotalist(c.success)},parse:function(a){return a.quota_set}});var SecurityGroup=Backbone.Model.extend({_action:function(a,b){var c=this;null==b&&(b={});b.success=function(a){c.trigger("sync",c,a,b);void 0!==b.callback&&b.callback(a)};return(this.sync||Backbone.sync).call(this,a,this,b)},createSecurityGroupRule:function(a,b,c,d,f,g,e){e=e||{};e.ip_protocol=a;e.from_port=b;e.to_port=c;e.cidr=d;e.group_id=f;e.parent_group_id=g;return this._action("createSecurityGroupRule",e)},deleteSecurityGroupRule:function(a,b){console.log("Delete security group rule");b=b||
{};b.secGroupRuleId=a;return this._action("deleteSecurityGroupRule",b)},getSecurityGroupforServer:function(a,b){console.log("Get security groups for server");b=b||{};b.serverId=a;return this._action("getSecurityGroupforServer",b)},sync:function(a,b,c){switch(a){case "read":JSTACK.Nova.getsecuritygroupdetail(b.get("id"),c.success);break;case "delete":JSTACK.Nova.deletesecuritygroup(b.get("id"),c.success);break;case "create":JSTACK.Nova.createsecuritygroup(b.get("name"),b.get("description"),c.success);
break;case "createSecurityGroupRule":JSTACK.Nova.createsecuritygrouprule(c.ip_protocol,c.from_port,c.to_port,c.cidr,c.group_id,c.parent_group_id,c.success);break;case "deleteSecurityGroupRule":JSTACK.Nova.deletesecuritygrouprule(c.secGroupRuleId,c.success);break;case "getSecurityGroupforServer":mySuccess=function(a){var b={};b.object=a;return c.success(b)},JSTACK.Nova.getsecuritygroupforserver(c.serverId,mySuccess)}},parse:function(a){return void 0!==a.security_group?a.security_group:a}}),SecurityGroups=
Backbone.Collection.extend({model:SecurityGroup,sync:function(a,b,c){"read"===a&&JSTACK.Nova.getsecuritygrouplist(c.success)},parse:function(a){return a.security_groups}});var Service=Backbone.Model.extend({sync:function(a,b,c){switch(a){case "read":JSTACK.Keystone.getservice(b.get("id"),c.success);break;case "filter":JSTACK.Keystone.filterservice(b.get("id"),c.success)}}}),Services=Backbone.Collection.extend({model:Service,sync:function(a,b,c){"read"===a&&(a=JSTACK.Keystone.getservicelist(),c.success(a))},parse:function(a){return a}});var TopBarModel=Backbone.Model.extend({});var User=Backbone.Model.extend({sync:function(a,b,c){switch(a){case "read":JSTACK.Keystone.getuser(b.get("id"),c.success);break;case "delete":JSTACK.Keystone.deleteuser(b.get("id"),c.success);break;case "create":JSTACK.Keystone.createuser(b.get("id"),c.success);break;case "filter":JSTACK.Keystone.filteruser(b.get("id"),c.success);break;case "edit":JSTACK.Keystone.edituser(b.get("id"),c.success)}}}),Users=Backbone.Collection.extend({model:User,sync:function(a,b,c){"read"===a&&JSTACK.Keystone.getusers(!0,
c.success)},parse:function(a){return a.users}});var VDC=Backbone.Model.extend({sync:function(a,b,c){switch(a){case "read":c.success({vdc:{id:"mockVDC",name:"mockVDC",vcpus:1,disk:10,ram:1,vcpu_hours:1,disk_hours:1}})}},parse:function(a){return void 0!==a.vdc?a.vdc:a}}),VDCs=Backbone.Collection.extend({model:VDC,sync:function(a,b,c){"read"===a&&(a=new VDC({id:"mockVDC",name:"mockVDC",vcpus:1,disk:10,ram:1,vcpu_hours:1,disk_hours:1}),c.success({vdcs:[a]}))},comparator:function(a){return a.get("id")},parse:function(a){return a.vdcs}});var VDCService=Backbone.Model.extend({sync:function(a,b,c){switch(a){case "read":JSTACK.Nova.getserverlist(!0,this.alltenants,function(a){var a=a.servers,b=[],g;for(g in a)if(a.hasOwnProperty(g)){var e=new Instance(a[g]);b.push(e)}c.success({service:{id:"mockService",name:"mockService",vcpus:1,disk:10,ram:1,vcpu_hours:1,disk_hours:1,models:b}})})}},getInstance:function(a){var b=this.get("models"),c;for(c in b)if(b.hasOwnProperty(c)){var d=b[c];if(a===d.id)return d}},parse:function(a){return void 0!==
a.service?a.service:a}}),VDCServices=Backbone.Collection.extend({model:VDCService,sync:function(a,b,c){"read"==a&&(a=new VDCService({id:"mockService",name:"mockService",vcpus:1,disk:10,ram:1,vcpu_hours:1,disk_hours:1}),c.success({services:[a]}))},comparator:function(a){return a.get("id")},parse:function(a){return a.services}});var Volume=Backbone.Model.extend({_action:function(a,b){var c=this;void 0===b&&(b={});b.success=function(a){c.trigger("sync",c,a,b);void 0!==b.callback&&b.callback(a)};return(this.sync||Backbone.sync).call(this,a,this,b)},sync:function(a,b,c){switch(a){case "create":JSTACK.Nova.Volume.createvolume(b.get("size"),b.get("name"),b.get("description"),c.success);break;case "delete":JSTACK.Nova.Volume.deletevolume(b.get("id"),c.success);break;case "read":JSTACK.Nova.Volume.getvolume(b.get("id"),c.success)}},
parse:function(a){return void 0!==a.volume?a.volume:a}}),Volumes=Backbone.Collection.extend({model:Volume,sync:function(a,b,c){"read"==a&&JSTACK.Nova.Volume.getvolumelist(!0,c.success)},parse:function(a){return a.volumes}});var VolumeSnapshot=Backbone.Model.extend({_action:function(a,b){var c=this;void 0===b&&(b={});b.success=function(a){c.trigger("sync",c,a,b);void 0!==b.callback&&b.callback(a)};return(this.sync||Backbone.sync).call(this,a,this,b)},sync:function(a,b,c){switch(a){case "create":JSTACK.Nova.Volume.createsnapshot(b.get("volume_id"),b.get("name"),b.get("description"),c.success);break;case "delete":JSTACK.Nova.Volume.deletesnapshot(b.get("id"),c.success);break;case "read":JSTACK.Nova.Volume.getsnapshot(b.get("id"),
c.success)}},parse:function(a){return void 0!==a.snapshot?a.snapshot:a}}),VolumeSnapshots=Backbone.Collection.extend({model:VolumeSnapshot,sync:function(a,b,c){"read"===a&&JSTACK.Nova.Volume.getsnapshotlist(!0,c.success)},parse:function(a){return a.snapshots}});
