var UTILS=UTILS||{};UTILS.VERSION="0.1";UTILS.AUTHORS="GING";
UTILS.Auth=function(f,g){var h=[];return{initialize:function(d){JSTACK.Keystone.init(d)},authenticate:function(d,a,b,c,f,e){var k=function(){console.log("Authenticated with tentant");f()},i=function(){console.log("Authenticated without tentants. Retrieving tenants...");JSTACK.Keystone.gettenants(function(a){h=a.tenants;l()})},l=function(a){0<h.length?(a=a||h.pop(),console.log("Authenticating for tenant "+JSON.stringify(a.id)),JSTACK.Keystone.authenticate(g,g,JSTACK.Keystone.params.token,a.id,k,m)):
(console.log("Error authenticating"),e("No tenant"))},m=function(){l()},j;b!=g?(j=k,console.log("Authenticating with tenant")):d!=a?(j=i,console.log("Authenticating without tenant")):c!=g&&(j=i,console.log("Authenticating with token"));JSTACK.Keystone.authenticate(d,a,c,b,j,function(){e("Bad credentials")})},getToken:function(){return JSTACK.Keystone.params.token},getName:function(){return JSTACK.Keystone.params.access.user.name},isAuthenticated:function(){return JSTACK.Keystone.params.currentstate==
JSTACK.Keystone.STATES.AUTHENTICATED},getCurrentTenant:function(){return JSTACK.Keystone.params.access.token.tenant},getTenants:function(d){return JSTACK.Keystone.gettenants(function(a){d(a.tenants)})},switchTenant:function(d,a,b){JSTACK.Keystone.authenticate(g,g,JSTACK.Keystone.params.token,d,a,b)},isAdmin:function(){var d=JSTACK.Keystone.params.access.user.roles,a;for(a in d)if("admin"==d[a].name)return!0;return!1}}}(UTILS);
UTILS.Render=function(f,g){return{animateRender:function(f,d,a,b){var c=d(a);$(f).append(c);$(c).hide();$(f).animate({marginLeft:"+1250px",marginRight:"-1250px"},200,function(){$(c).show();$(f).html(c).css("marginLeft","1250px").css("marginRight","-1250px").animate({marginLeft:"-=1250px",marginRight:"+=1250px"},200,function(){b!=g&&b()})});return c}}}(UTILS);
UTILS.i18n=function(f,g){function h(a){var b=$(a),c=b.find("*[data-i18n]");c.each(function(d,e){var e=$(c[d],a),h=f.i18n.get(e.attr("data-i18n"));if(h!=g){var i=e.clone();e.text(h);b.find(i).replaceWith(e)}});return b}function d(a){for(var b=a.split("%"),c=b[0],d=/^([ds])(.*)$/,e=1;e<b.length;e++)if((p=d.exec(b[e]))&&null!=arguments[e])"d"==p[1]?c+=parseInt(arguments[e],10):"s"==p[1]&&(c+=arguments[e]),c+=p[2];return c}return{params:{lang:"en",dict:{}},init:function(){_.extend(_,{itemplate:function(a){var b=
_.template(a);return function(a){a=b(a);return a=f.i18n.translate(a)}}});localStorage.i18nlang==g&&(localStorage.i18nlang="en");UTILS.i18n.setlang(localStorage.i18nlang);console.log("Language: "+localStorage.i18nlang)},setlang:function(a,b){var c="locales/"+a+".json?random="+99999*Math.random();$.ajax({url:c,success:function(d){console.log("loaded: "+c);f.i18n.params.dict=d;localStorage.i18nlang=a;b!=g&&b()},error:function(){console.log("failed loading: "+c);b!=g&&b()},dataType:"json"})},translate:function(a){(new Date).getTime();
a=h(a);(new Date).getTime();return a},get:function(a){var b=f.i18n.params.dict[a];b==g&&(b=a);return b},pluralise:function(a,b,c){a=f.i18n.get(a);1!=c&&(a=f.i18n.get(b));return d(a,c)}}}(UTILS);UTILS.i18n.init();
